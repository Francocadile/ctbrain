(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8526],{1002:function(e,t,n){Promise.resolve().then(n.bind(n,4889))},6463:function(e,t,n){"use strict";var a=n(1169);n.o(a,"useParams")&&n.d(t,{useParams:function(){return a.useParams}}),n.o(a,"usePathname")&&n.d(t,{usePathname:function(){return a.usePathname}}),n.o(a,"useRouter")&&n.d(t,{useRouter:function(){return a.useRouter}}),n.o(a,"useSearchParams")&&n.d(t,{useSearchParams:function(){return a.useSearchParams}})},4889:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return o}});var a=n(7437),r=n(998);function l(){let{status:e}=(0,r.useSession)();return"authenticated"!==e?null:(0,a.jsx)("button",{onClick:()=>(0,r.signOut)({callbackUrl:"/login"}),className:"fixed right-4 top-4 rounded-md border px-3 py-1 text-sm hover:bg-gray-50","aria-label":"Cerrar sesi\xf3n",children:"Salir"})}var i=n(8516);function o(e){let{children:t}=e;return(0,a.jsxs)("div",{className:"min-h-screen relative",children:[(0,a.jsx)("div",{className:"absolute left-4 top-4 z-40",children:(0,a.jsx)(i.default,{className:"min-w-[160px]"})}),(0,a.jsx)(l,{}),t]})}},8516:function(e,t,n){"use strict";n.d(t,{default:function(){return o}});var a=n(7437),r=n(2265),l=n(998),i=n(6463);function o(e){var t,n,o;let{className:u,label:s="Equipo"}=e,{data:d,status:c,update:m}=(0,l.useSession)(),f=(0,i.useRouter)(),v=(0,r.useMemo)(()=>{var e,t;return null!==(t=null==d?void 0:null===(e=d.user)||void 0===e?void 0:e.teamIds)&&void 0!==t?t:[]},[null==d?void 0:null===(t=d.user)||void 0===t?void 0:t.teamIds]),h=null!==(o=null==d?void 0:null===(n=d.user)||void 0===n?void 0:n.currentTeamId)&&void 0!==o?o:null,[p,x]=(0,r.useState)([]),[g,S]=(0,r.useState)(""),[b,j]=(0,r.useState)(!1),[y,N]=(0,r.useState)(!1),[w,P]=(0,r.useState)(null),E=v.length>0,k=(0,r.useMemo)(()=>E?[...v].sort().join("|"):"",[E,v]);if((0,r.useEffect)(()=>{if(!E){x([]),S("");return}let e=!1;return j(!0),P(null),fetch("/api/session/team",{cache:"no-store"}).then(async e=>{if(!e.ok){let t=await e.json().catch(()=>null);throw Error((null==t?void 0:t.error)||"Error ".concat(e.status))}return e.json()}).then(t=>{var n,a,r;if(e)return;let l=Array.isArray(null==t?void 0:t.teams)?t.teams.map(e=>{var t,n,a;return{id:String(null!==(t=null==e?void 0:e.id)&&void 0!==t?t:"").trim(),name:String(null!==(n=null==e?void 0:e.name)&&void 0!==n?n:"").trim()||String(null!==(a=null==e?void 0:e.id)&&void 0!==a?a:"").trim()}}).filter(e=>!!e.id):[],i=l.length>0?l:v.map(e=>({id:e,name:e}));x(i),S((null==t?void 0:t.currentTeamId)&&(null===(n=i.find(e=>e.id===t.currentTeamId))||void 0===n?void 0:n.id)||h&&(null===(a=i.find(e=>e.id===h))||void 0===a?void 0:a.id)||(null===(r=i[0])||void 0===r?void 0:r.id)||"")}).catch(()=>{e||(x(v.map(e=>({id:e,name:e}))),P("No se pudieron cargar los equipos."))}).finally(()=>{e||j(!1)}),()=>{e=!0}},[k,h,E,v]),(0,r.useEffect)(()=>{h&&S(h)},[h]),"loading"===c||!E)return null;let C="https:"===window.location.protocol?"; Secure":"";async function I(e){let t=e.target.value;if(t&&t!==g){S(t),N(!0),P(null);try{document.cookie="ctb_team=".concat(encodeURIComponent(t),"; path=/; max-age=").concat(2592e3,"; SameSite=Lax").concat(C);let e=await fetch("/api/session/team",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({teamId:t})});if(!e.ok){let t=await e.json().catch(()=>null);throw Error((null==t?void 0:t.error)||"Error ".concat(e.status))}await (null==m?void 0:m()),f.refresh()}catch(e){S(g),P((null==e?void 0:e.message)||"No se pudo cambiar de equipo.")}finally{N(!1)}}}let _=["flex flex-col gap-1 text-xs",u].filter(Boolean).join(" ");return 0===p.length?null:(0,a.jsxs)("div",{className:_,children:[(0,a.jsx)("label",{className:"text-[10px] font-semibold uppercase text-gray-500",children:s}),(0,a.jsx)("select",{value:g,onChange:I,disabled:b||y,className:"w-full rounded-md border px-2 py-1.5 text-sm disabled:opacity-60",children:p.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))}),w?(0,a.jsx)("span",{className:"text-[11px] text-red-600",children:w}):null]})}}},function(e){e.O(0,[998,2971,7023,1744],function(){return e(e.s=1002)}),_N_E=e.O()}]);