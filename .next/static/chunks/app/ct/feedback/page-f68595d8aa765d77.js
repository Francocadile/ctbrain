(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2056],{8703:function(e,a,t){Promise.resolve().then(t.bind(t,4111))},6463:function(e,a,t){"use strict";var r=t(1169);t.o(r,"useParams")&&t.d(a,{useParams:function(){return r.useParams}}),t.o(r,"usePathname")&&t.d(a,{usePathname:function(){return r.usePathname}}),t.o(r,"useRouter")&&t.d(a,{useRouter:function(){return r.useRouter}}),t.o(r,"useSearchParams")&&t.d(a,{useSearchParams:function(){return r.useSearchParams}})},4111:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return o}});var r=t(7437),s=t(2265),n=t(6463),l=t(998);let d=new Intl.DateTimeFormat("es-AR",{dateStyle:"medium",timeStyle:"short"});function o(){var e;let a=(0,n.useRouter)(),{data:t,status:d}=(0,l.useSession)({required:!0,onUnauthenticated(){a.replace("/login")}}),o=null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.role,u="CT"===o||"MEDICO"===o||"ADMIN"===o,[x,m]=(0,s.useState)([]),[g,h]=(0,s.useState)("idle"),[p,y]=(0,s.useState)(null),[b,f]=(0,s.useState)("all"),[j,N]=(0,s.useState)(""),[v,w]=(0,s.useState)(""),S=async e=>{if(!u)return;h("loading"),y(null);let a=new URLSearchParams;"all"!==b&&a.set("playerId",b),j&&a.set("from",new Date("".concat(j,"T00:00:00")).toISOString()),v&&a.set("to",new Date("".concat(v,"T23:59:59")).toISOString());try{let t=a.size?"/api/feedback?".concat(a.toString()):"/api/feedback",r=await fetch(t,{cache:"no-store",signal:e});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error((null==e?void 0:e.error)||"No se pudo cargar el feedback")}let s=await r.json();m(s.data||[]),h("ready")}catch(e){if((null==e?void 0:e.name)==="AbortError")return;console.error("[feedback] fetch failed",e),h("error"),y((null==e?void 0:e.message)||"No se pudo cargar el feedback")}};return((0,s.useEffect)(()=>{if("authenticated"!==d||!u)return;let e=new AbortController;return S(e.signal),()=>e.abort()},[d,u,b,j,v]),"loading"===d)?(0,r.jsx)("div",{className:"p-6 text-sm text-gray-500",children:"Cargando…"}):u?(0,r.jsxs)("div",{className:"mx-auto flex max-w-5xl flex-col gap-6",children:[(0,r.jsxs)("header",{className:"space-y-1",children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Feedback de jugadores"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Consult\xe1 los mensajes que los jugadores enviaron al cuerpo t\xe9cnico o staff m\xe9dico."})]}),(0,r.jsx)(i,{entries:x,playerFilter:b,onPlayerChange:f,from:j,to:v,onFromChange:N,onToChange:w,onClear:()=>{f("all"),N(""),w("")},onRefresh:()=>S(),loading:"loading"===g}),p?(0,r.jsx)("div",{className:"rounded-md border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:p}):null,(0,r.jsx)(c,{entries:x,loading:"loading"===g&&!x.length})]}):(0,r.jsx)("div",{className:"mx-auto max-w-3xl rounded-lg border bg-white p-6 text-sm text-gray-600",children:"No ten\xe9s permiso para ver el feedback de los jugadores."})}function i(e){let{entries:a,playerFilter:t,onPlayerChange:n,from:l,to:d,onFromChange:o,onToChange:i,onClear:c,onRefresh:u,loading:x}=e,m=(0,s.useMemo)(()=>{let e=new Map;for(let t of a)e.has(t.playerId)||e.set(t.playerId,t.playerName);return Array.from(e.entries())},[a]);return(0,r.jsx)("section",{className:"rounded-lg border bg-white p-4 shadow-sm",children:(0,r.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[(0,r.jsxs)("label",{className:"grid gap-1 text-sm text-gray-700",children:["Jugador",(0,r.jsxs)("select",{value:t,onChange:e=>n(e.target.value),className:"rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-gray-500 focus:outline-none",children:[(0,r.jsx)("option",{value:"all",children:"Todos"}),m.map(e=>{let[a,t]=e;return(0,r.jsx)("option",{value:a,children:t},a)})]})]}),(0,r.jsxs)("label",{className:"grid gap-1 text-sm text-gray-700",children:["Desde",(0,r.jsx)("input",{type:"date",value:l,max:d||void 0,onChange:e=>o(e.target.value),className:"rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-gray-500 focus:outline-none"})]}),(0,r.jsxs)("label",{className:"grid gap-1 text-sm text-gray-700",children:["Hasta",(0,r.jsx)("input",{type:"date",value:d,min:l||void 0,onChange:e=>i(e.target.value),className:"rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-gray-500 focus:outline-none"})]}),(0,r.jsxs)("div",{className:"flex items-end gap-2",children:[(0,r.jsx)("button",{type:"button",onClick:u,disabled:x,className:"flex-1 rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm transition hover:bg-blue-500 disabled:cursor-not-allowed disabled:bg-blue-300",children:x?"Actualizando…":"Actualizar"}),(0,r.jsx)("button",{type:"button",onClick:c,disabled:x,className:"rounded-md border border-gray-300 px-3 py-2 text-sm text-gray-700 transition hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-60",children:"Limpiar"})]})]})})}function c(e){let{entries:a,loading:t}=e;return a.length?(0,r.jsx)("section",{className:"overflow-hidden rounded-lg border bg-white shadow-sm",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[(0,r.jsx)("thead",{className:"bg-gray-50 text-xs uppercase tracking-wide text-gray-500",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Jugador"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Tema"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Mensaje"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Valoraci\xf3n"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Enviado por"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Fecha"})]})}),(0,r.jsx)("tbody",{className:"divide-y divide-gray-100 bg-white",children:a.map(e=>{var a;return(0,r.jsxs)("tr",{className:"align-top",children:[(0,r.jsx)("td",{className:"px-4 py-3 font-medium text-gray-900",children:e.playerName}),(0,r.jsx)("td",{className:"px-4 py-3 text-gray-700",children:null!==(a=e.subject)&&void 0!==a?a:"—"}),(0,r.jsx)("td",{className:"px-4 py-3 text-gray-700",children:(0,r.jsx)("p",{className:"whitespace-pre-line text-sm leading-5 text-gray-700",children:e.text})}),(0,r.jsx)("td",{className:"px-4 py-3 text-gray-700",children:e.rating?"".concat(e.rating,"/5"):(0,r.jsx)("span",{className:"text-gray-400",children:"Sin dato"})}),(0,r.jsx)("td",{className:"px-4 py-3 text-gray-700",children:e.createdByName}),(0,r.jsx)("td",{className:"px-4 py-3 text-gray-600",children:function(e){try{return d.format(new Date(e))}catch(a){return e}}(e.createdAt)})]},e.id)})})]})}):(0,r.jsx)("div",{className:"rounded-lg border border-dashed bg-white p-6 text-center text-sm text-gray-500",children:t?"Cargando feedback…":"Todav\xeda no hay mensajes registrados."})}}},function(e){e.O(0,[998,2971,7023,1744],function(){return e(e.s=8703)}),_N_E=e.O()}]);