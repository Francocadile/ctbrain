(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3074],{9281:function(e,t,a){Promise.resolve().then(a.bind(a,6700))},6700:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return y},dynamic:function(){return v}});var r=a(7437),n=a(8059),l=a.n(n),s=a(2265),o=a(6463),i=a(1673);async function c(){let e=await fetch("/api/planner/labels",{cache:"no-store"});if(!e.ok)throw Error("fetch rowLabels failed");return(await e.json()).rowLabels||{}}async function d(e){if(!(await fetch("/api/planner/labels",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rowLabels:e})})).ok)throw Error("save rowLabels failed")}async function u(){if(!(await fetch("/api/planner/labels",{method:"DELETE"})).ok)throw Error("reset rowLabels failed")}async function x(){let e=await fetch("/api/planner/labels",{cache:"no-store"});return e.ok&&(await e.json()).places||[]}async function p(e){let t=e.split("\n").map(e=>e.trim()).filter(Boolean),a=await fetch("/api/planner/labels",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({places:t})});if(!a.ok)throw Error("save places failed");let r=await a.json();return window.dispatchEvent(new Event("planner-places-updated")),r.places||[]}async function m(){await p("")}var f=a(97);let h={"PRE ENTREN0":"PRE ENTREN0",FÍSICO:"F\xcdSICO","T\xc9CNICO–T\xc1CTICO":"T\xc9CNICO–T\xc1CTICO",COMPENSATORIO:"COMPENSATORIO"};function g(e){let{onAfterChange:t}=e,[a,n]=(0,s.useState)(!1),[l,o]=(0,s.useState)({}),[i,g]=(0,s.useState)(""),[b,v]=(0,s.useState)(0),[y,j]=(0,s.useState)({});async function N(){n(!0);try{let e={};for(let t of Object.keys(h)){let a=(l[t]||"").trim();a&&(e[t]=a)}await d(e),window.dispatchEvent(new Event("planner-row-labels-updated")),j({...y,...e}),o({}),null==t||t(),alert("Nombres guardados.")}catch(e){alert((null==e?void 0:e.message)||"No se pudieron guardar los nombres")}finally{n(!1)}}async function w(){if(confirm("\xbfRestaurar nombres originales?")){n(!0);try{await u(),o({}),j({}),window.dispatchEvent(new Event("planner-row-labels-updated")),null==t||t(),alert("Restaurado.")}catch(e){alert((null==e?void 0:e.message)||"No se pudo resetear")}finally{n(!1)}}}async function C(){n(!0);try{let e=await p(i);g(e.join("\n")),v(e.length),null==t||t(),alert("Lugares guardados.")}catch(e){alert((null==e?void 0:e.message)||"No se pudo guardar los lugares")}finally{n(!1)}}async function E(){if(confirm("\xbfVaciar la lista de lugares?")){n(!0);try{await m(),g(""),v(0),null==t||t(),alert("Lista vaciada.")}catch(e){alert((null==e?void 0:e.message)||"No se pudo vaciar")}finally{n(!1)}}}return(0,s.useEffect)(()=>{(async()=>{try{let e=await c();j(e||{})}catch(e){}try{let e=await x();g((e||[]).join("\n")),v(e.length)}catch(e){}})()},[]),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("section",{className:"rounded-xl border p-3",children:[(0,r.jsxs)("div",{className:"mb-2 flex items-center gap-2",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold",children:"Nombres de filas (tu preferencia)"}),(0,r.jsx)(f.Z,{text:"Escrib\xed solo si quer\xe9s cambiar el nombre visible. Se guarda en tu usuario."})]}),(0,r.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2",children:Object.keys(h).map(e=>(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsxs)("label",{className:"text-[11px] text-gray-600",children:["Actual: ",y[e]||e]}),(0,r.jsx)("input",{className:"h-9 rounded-md border px-2 text-sm",value:l[e]||"",onChange:t=>o(a=>({...a,[e]:t.target.value})),placeholder:"PRE ENTREN0"===e?"Ej: Activaci\xf3n":"F\xcdSICO"===e?"Ej: Entrada en calor":"T\xc9CNICO–T\xc1CTICO"===e?"Ej: Principal":"Ej: Post entreno"})]},e))}),(0,r.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,r.jsx)("button",{onClick:N,disabled:a,className:"px-3 py-1.5 rounded-lg bg-black text-white text-xs hover:opacity-90",children:"Guardar"}),(0,r.jsx)("button",{onClick:w,disabled:a,className:"px-3 py-1.5 rounded-lg border text-xs hover:bg-gray-50",children:"Restaurar originales"})]})]}),(0,r.jsxs)("section",{className:"rounded-xl border p-3",children:[(0,r.jsxs)("div",{className:"mb-2 flex items-center gap-2",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold",children:"Lugares"}),(0,r.jsx)(f.Z,{text:"Un lugar por l\xednea. Se usan como sugerencias en el campo 'Lugar' del Editor."}),(0,r.jsxs)("span",{className:"ml-auto text-[11px] text-gray-500",children:[b," guardados"]})]}),(0,r.jsx)("div",{className:"text-[11px] text-gray-500 mb-1",children:"Ejemplos:"}),(0,r.jsxs)("div",{className:"rounded-md border p-2 text-[12px] text-gray-600 bg-gray-50 mb-2",children:["Cancha 1",(0,r.jsx)("br",{}),"Complejo Deportivo",(0,r.jsx)("br",{}),"Gimnasio"]}),(0,r.jsx)("textarea",{className:"w-full min-h-[120px] rounded-md border p-2 text-sm",placeholder:"Escrib\xed los lugares (uno por l\xednea)…",value:i,onChange:e=>g(e.target.value)}),(0,r.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,r.jsx)("button",{onClick:C,disabled:a,className:"px-3 py-1.5 rounded-lg bg-black text-white text-xs hover:opacity-90",children:"Guardar lugares"}),(0,r.jsx)("button",{onClick:E,disabled:a,className:"px-3 py-1.5 rounded-lg border text-xs hover:bg-gray-50",children:"Vaciar lista"})]})]})]})}var b=a(4875);let v="force-dynamic";function y(){return(0,r.jsx)(s.Suspense,{fallback:(0,r.jsx)("div",{className:"p-4 text-sm text-gray-500",children:"Cargando…"}),children:(0,r.jsx)(A,{})})}let j=["PRE ENTREN0","F\xcdSICO","T\xc9CNICO–T\xc1CTICO","COMPENSATORIO"],N="NOMBRE SESI\xd3N",w=[N,"LUGAR","HORA","VIDEO"],C=e=>"[".concat("DAYFLAG",":").concat(e,"]"),E=(e,t)=>"string"==typeof e.description&&e.description.startsWith(C(t));function T(e){return(e||"").trim().replace(/\|/g,"/")}let k=[{value:"",colorClass:""},{value:"MD+1",colorClass:"bg-blue-50"},{value:"MD+2",colorClass:"bg-yellow-50"},{value:"MD-4",colorClass:"bg-red-50"},{value:"MD-3",colorClass:"bg-orange-50"},{value:"MD-2",colorClass:"bg-green-50"},{value:"MD-1",colorClass:"bg-gray-50"},{value:"MD",colorClass:"bg-amber-50"},{value:"DESCANSO",colorClass:"bg-gray-100"}],S=e=>"[".concat("MICRO",":").concat(e,"]"),O=(e,t)=>"string"==typeof e.description&&e.description.startsWith(S(t));function R(e,t){let a=new Date(e);return a.setUTCDate(a.getUTCDate()+t),a}function I(e,t){let a=new Date("".concat(e,"T00:00:00.000Z"));return a.setUTCHours("morning"===t?9:15,0,0,0),a.toISOString()}function D(e,t){return"[GRID:".concat(e,":").concat(t,"]")}function L(e,t,a){return"".concat(e,"::").concat(t,"::").concat(a)}function A(){let e=(0,o.useSearchParams)(),t=(0,o.useRouter)(),a="1"===e.get("hideHeader"),n="afternoon"===e.get("turn")?"afternoon":"morning",c="tools"===e.get("pane")?"tools":"editor",[d,u]=(0,s.useState)(n),[x,p]=(0,s.useState)(c);(0,s.useEffect)(()=>{let a=new URLSearchParams(e.toString());a.set("turn",d),"tools"===x?a.set("pane","tools"):a.delete("pane"),t.replace("?".concat(a.toString()))},[d,x]);let[m,f]=(0,s.useState)(()=>(0,i.$9)(new Date)),[h,v]=(0,s.useState)(!1),[y,A]=(0,s.useState)({}),[U,P]=(0,s.useState)(""),[M,B]=(0,s.useState)(""),[G,H]=(0,s.useState)({}),[V,W]=(0,s.useState)([]);async function Z(){try{let e=await fetch("/api/planner/labels",{cache:"no-store"}),t=await e.json();H(t.rowLabels||{}),W(t.places||[])}catch(e){H({}),W([])}}async function _(e){v(!0);try{let t=(0,i.$9)(e),a=(0,i.VA)(t),r=await (0,i.tO)({start:a});A(r.days),P(r.weekStart),B(r.weekEnd),er({})}catch(e){console.error(e),alert("No se pudo cargar la semana.")}finally{v(!1)}}function F(e){if(0===Object.keys(ea).length)return e();confirm("Ten\xe9s cambios sin guardar. \xbfDescartarlos?")&&e()}(0,s.useEffect)(()=>{Z();let e=()=>Z();return window.addEventListener("planner-row-labels-updated",e),window.addEventListener("planner-places-updated",e),()=>{window.removeEventListener("planner-row-labels-updated",e),window.removeEventListener("planner-places-updated",e)}},[]),(0,s.useEffect)(()=>{_(m)},[m]);let $=(0,s.useMemo)(()=>{if(!U)return[];let e=new Date("".concat(U,"T00:00:00.000Z"));return Array.from({length:7}).map((t,a)=>(0,i.VA)(R(e,a)))},[U]),z=e=>G[e]||e,Y=e=>y[e]||[];function J(e,t,a){return Y(e).find(e=>"string"==typeof e.description&&e.description.startsWith(D(t,a)))}function K(e,t){return Y(e).find(e=>E(e,t))}function q(e,t){var a;let r=K(e,t);return function(e){let t=(e||"").trim();if(!t)return{kind:"NONE"};let a=t.split("|").map(e=>(e||"").trim()),r=a[0];if("PARTIDO"===r){if(a.length>=4){let[,e,t,r]=a;return{kind:"PARTIDO",rivalId:e||void 0,rival:t||"",logoUrl:r||""}}if(a.length>=3){let[,e,t]=a;return{kind:"PARTIDO",rival:e||"",logoUrl:t||""}}return{kind:"PARTIDO"}}return"LIBRE"===r?{kind:"LIBRE"}:{kind:"NONE"}}(null!==(a=null==r?void 0:r.title)&&void 0!==a?a:"")}async function Q(e,t,a){let r=K(e,t),n=I(e,t),l="".concat(C(t)," | ").concat(e),s=function(e){if("PARTIDO"===e.kind){let t=(e.rivalId||"").trim(),a=T(e.rival),r=T(e.logoUrl);return"PARTIDO|".concat(t,"|").concat(a,"|").concat(r)}return"LIBRE"===e.kind?"LIBRE":""}(a);try{if("NONE"===a.kind){r&&await (0,i.SO)(r.id),await _(m);return}r?await (0,i.CT)(r.id,{title:s,description:l,date:n}):await (0,i.ed)({title:s,description:l,date:n,type:"GENERAL"}),await _(m)}catch(e){console.error(e),alert((null==e?void 0:e.message)||"No se pudo actualizar el estado del d\xeda")}}function X(e,t){return Y(e).find(e=>O(e,t))}function ee(e,t){let a=X(e,t);return function(e){var t;let a=(e||"").trim();return a&&(null===(t=k.find(e=>e.value===a))||void 0===t?void 0:t.value)||""}(null==a?void 0:a.title)}async function et(e,t,a){let r=X(e,t),n=I(e,t),l="".concat(S(t)," | ").concat(e),s=a||"";try{if(!a){r&&await (0,i.SO)(r.id),await _(m);return}r?await (0,i.CT)(r.id,{title:s,description:l,date:n}):await (0,i.ed)({title:s,description:l,date:n,type:"GENERAL"}),await _(m)}catch(e){console.error(e),alert((null==e?void 0:e.message)||"No se pudo actualizar la intensidad")}}let[ea,er]=(0,s.useState)({}),[en,el]=(0,s.useState)(!1);function es(e,t,a,r){let n=L(e,t,a);er(l=>{var s,o;let i={...l},c=J(e,t,a),d=null!==(o=null==c?void 0:null===(s=c.title)||void 0===s?void 0:s.trim())&&void 0!==o?o:"";return(r||"").trim()===d?delete i[n]:i[n]=r,i})}async function eo(){let e=Object.entries(ea);if(0!==e.length){el(!0);try{for(let[a,r]of e){let[e,n,l]=a.split("::"),s=J(e,n,l),o=I(e,n),c=D(n,l),d=(null!=r?r:"").trim();if(!d){s&&await (0,i.SO)(s.id);continue}if(s){var t;await (0,i.CT)(s.id,{title:d,description:(null===(t=s.description)||void 0===t?void 0:t.startsWith(c))?s.description:"".concat(c," | ").concat(e),date:o})}else await (0,i.ed)({title:d,description:"".concat(c," | ").concat(e),date:o,type:"GENERAL"})}await _(m)}catch(e){console.error(e),alert((null==e?void 0:e.message)||"Error al guardar cambios")}finally{el(!1)}}}function ei(e){var t;let{dayYmd:a,turn:n,row:l}=e,o=J(a,n,l),i=(null!==(t=null==o?void 0:o.title)&&void 0!==t?t:"").trim(),c=L(a,n,l),d=void 0!==ea[c]?ea[c]:i;if(l===N){let[e,t]=(0,s.useState)(d||"");return(0,s.useEffect)(()=>t(d||""),[d,c]),(0,r.jsx)("input",{className:"h-8 w-full rounded-md border px-2 text-xs",placeholder:"Nombre de sesi\xf3n (ej: Sesi\xf3n 7 TM)",value:e,onChange:e=>t(e.target.value),onBlur:()=>{let t=(e||"").trim();t!==(i||"")&&es(a,n,l,t)},onKeyDown:e=>{"Enter"===e.key&&e.target.blur()}})}if("LUGAR"===l){let[e,t]=(0,s.useState)(d||"");return(0,s.useEffect)(()=>t(d||""),[d,c]),(0,r.jsx)("input",{list:"places-datalist",className:"h-8 w-full rounded-md border px-2 text-xs",placeholder:"Lugar (texto libre o sugerencias)",value:e,onChange:e=>t(e.target.value),onBlur:()=>es(a,n,l,(e||"").trim())})}if("HORA"===l){let e=/^[0-9]{2}:[0-9]{2}$/.test(d||"")?d:"";return(0,r.jsx)("input",{type:"time",className:"h-8 w-full rounded-md border px-2 text-xs",value:e,onChange:e=>es(a,n,l,e.target.value)})}if("VIDEO"===l){let e=function(e){let t=(e||"").trim();if(!t)return{label:"",url:""};let[a,r]=t.split("|").map(e=>e.trim());return!r&&(null==a?void 0:a.startsWith("http"))?{label:"Video",url:a}:{label:a||"",url:r||""}}(d||""),[t,o]=(0,s.useState)(!(e.label||e.url)),[i,u]=(0,s.useState)(e.label),[x,p]=(0,s.useState)(e.url);return((0,s.useEffect)(()=>{u(e.label),p(e.url)},[c,d]),t)?(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)("input",{className:"h-8 w-[45%] rounded-md border px-2 text-xs",placeholder:"T\xedtulo",value:i,onChange:e=>u(e.target.value)}),(0,r.jsx)("input",{type:"url",className:"h-8 w-[55%] rounded-md border px-2 text-xs",placeholder:"https://…",value:x,onChange:e=>p(e.target.value)}),(0,r.jsx)("button",{type:"button",className:"h-8 px-2 rounded border text-[11px] hover:bg-gray-50",onClick:()=>{es(a,n,l,function(e,t){let a=(e||"").trim(),r=(t||"").trim();return a||r?!a&&r?r:"".concat(a,"|").concat(r):""}(i,x)),o(!1)},title:"Listo",children:"✓"})]}):(0,r.jsxs)("div",{className:"flex items-center justify-between gap-1",children:[e.url?(0,r.jsx)("a",{href:e.url,target:"_blank",rel:"noreferrer",className:"text-[12px] underline text-emerald-700 truncate",title:e.label||"Video",children:e.label||"Video"}):(0,r.jsx)("span",{className:"text-[12px] text-gray-500 truncate",children:e.label}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("button",{type:"button",className:"h-6 px-1.5 rounded border text-[11px] hover:bg-gray-50",onClick:()=>o(!0),title:"Editar",children:"✏️"}),(0,r.jsx)("button",{type:"button",className:"h-6 px-1.5 rounded border text-[11px] hover:bg-gray-50",onClick:()=>es(a,n,l,""),title:"Borrar",children:"❌"})]})]})}return null}function ec(e){var t;let{dayYmd:a,turn:n,row:l}=e,o=J(a,n,l),i=(0,s.useRef)(null),c=ea[L(a,n,l)],d=void 0!==c?c:null!==(t=null==o?void 0:o.title)&&void 0!==t?t:"",u=(null==o?void 0:o.id)?"/ct/sessions/".concat(o.id):"",x=q(a,n),p="LIBRE"===x.kind?(0,r.jsx)("span",{className:"text-[10px] bg-gray-100 border px-1.5 py-0.5 rounded",children:"D\xcdA LIBRE"}):"PARTIDO"===x.kind?(0,r.jsxs)("span",{className:"text-[10px] bg-amber-100 border px-1.5 py-0.5 rounded",children:["PARTIDO ",x.rival?"vs ".concat(x.rival):""]}):null;return(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{children:p}),u?(0,r.jsx)("a",{href:u,className:"text-[11px] rounded-lg border px-2 py-0.5 hover:bg-gray-50",title:"Abrir el ejercicio completo",children:"Ejercicio completo"}):null]}),(0,r.jsx)("div",{ref:i,contentEditable:!0,suppressContentEditableWarning:!0,onBlur:()=>{var e,t;es(a,n,l,null!==(t=null===(e=i.current)||void 0===e?void 0:e.innerText)&&void 0!==t?t:"")},onKeyDown:e=>{if((e.ctrlKey||e.metaKey)&&"Enter"===e.key){var t,r;e.preventDefault(),es(a,n,l,null!==(r=null===(t=i.current)||void 0===t?void 0:t.innerText)&&void 0!==r?r:"")}},className:"min-h-[90px] w-full rounded-xl border p-2 text-[13px] leading-5 outline-none focus:ring-2 focus:ring-emerald-400 whitespace-pre-wrap","data-placeholder":"Contenidos / t\xedtulos (breves)…",dangerouslySetInnerHTML:{__html:(d||"").replace(/\n/g,"<br/>")}})]})}function ed(e){let{ymd:t,turn:a}=e,n=q(t,a),[l,o]=(0,s.useState)(n.kind);(0,s.useEffect)(()=>{o(q(t,a).kind)},[U,t,a]);let i=e=>Q(t,a,e);return(0,r.jsx)("div",{className:"p-1",children:(0,r.jsxs)("select",{className:"h-7 w-[140px] rounded-md border px-1.5 text-[11px]",value:l,onChange:e=>{let t=e.target.value;return(o(t),"NONE"===t)?i({kind:"NONE"}):"LIBRE"===t?i({kind:"LIBRE"}):"PARTIDO"===t?i({kind:"PARTIDO",rival:"",logoUrl:"",rivalId:void 0}):void 0},children:[(0,r.jsx)("option",{value:"NONE",children:"Normal"}),(0,r.jsx)("option",{value:"PARTIDO",children:"Partido (MD)"}),(0,r.jsx)("option",{value:"LIBRE",children:"Descanso"})]})})}function eu(e){let{turn:t}=e;return(0,r.jsxs)("div",{className:"grid items-center border-b bg-gray-50/60",style:{gridTemplateColumns:"".concat(120,"px repeat(7, minmax(").concat(120,"px, 1fr))")},children:[(0,r.jsx)("div",{className:"px-2 py-1.5 text-[11px] font-medium text-gray-600",children:"Tipo"}),$.map(e=>(0,r.jsx)(ed,{ymd:e,turn:t},"".concat(e,"-").concat(t,"-status")))]})}function ex(e){let{ymd:t,turn:a}=e,n=q(t,a);if("PARTIDO"!==n.kind)return(0,r.jsx)("div",{className:"h-6 text-[11px] text-gray-400 italic px-1 flex items-center",children:"—"});let[l,o]=(0,s.useState)(!(n.rival||n.logoUrl)),[i,c]=(0,s.useState)(n.rival||""),[d,u]=(0,s.useState)(n.logoUrl||""),[x,p]=(0,s.useState)(n.rivalId||"");(0,s.useEffect)(()=>{let e=q(t,a);o(!(e.rival||e.logoUrl)),c(e.rival||""),u(e.logoUrl||""),p(e.rivalId||"")},[U,t,a]);let m=async()=>{await Q(t,a,{kind:"PARTIDO",rival:(i||"").trim(),logoUrl:(d||"").trim(),rivalId:(x||"").trim()||void 0}),o(!1)};if(!l){let e="/ct/sessions/by-day/".concat(t,"/").concat(a);return(0,r.jsxs)("div",{className:"flex items-center justify-between gap-1",children:[(0,r.jsxs)("div",{className:"h-6 text-[11px] px-1 flex items-center truncate gap-1",children:[d?(0,r.jsx)("img",{src:d,alt:"Logo",className:"w-[16px] h-[16px] object-contain rounded"}):null,(0,r.jsx)("span",{className:"truncate",children:i||"—"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(b.Z,{rivalId:x||void 0,rivalName:i||void 0,label:"Plan rival",className:"h-6",fallbackHref:e}),(0,r.jsx)("button",{type:"button",className:"h-6 px-1.5 rounded border text-[11px] hover:bg-gray-50",onClick:()=>o(!0),title:"Editar",children:"✏️"}),(0,r.jsx)("button",{type:"button",className:"h-6 px-1.5 rounded border text-[11px] hover:bg-gray-50",onClick:async()=>{c(""),u(""),p(""),await Q(t,a,{kind:"PARTIDO",rival:"",logoUrl:"",rivalId:void 0})},title:"Borrar",children:"❌"})]})]})}return(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)("input",{className:"h-8 w-[58%] rounded-md border px-2 text-xs",placeholder:"Rival (nombre o link /ct/rivales/:id)",value:i,onChange:e=>(function(e){c(e);let t=function(e){let t=e.match(/\/ct\/rivales\/([a-z0-9]+)(?:[/?#]|$)/i);return null==t?void 0:t[1]}(e);t&&p(t)})(e.target.value)}),(0,r.jsx)("input",{type:"url",className:"h-8 w-[34%] rounded-md border px-2 text-xs",placeholder:"Logo URL",value:d,onChange:e=>u(e.target.value)}),(0,r.jsx)("button",{type:"button",className:"h-8 px-2 rounded border text-[11px] hover:bg-gray-50",onClick:m,title:"Listo",children:"✓"})]})}function ep(e){let{turn:t}=e;return(0,r.jsxs)("div",{className:"grid items-center border-b",style:{gridTemplateColumns:"".concat(120,"px repeat(7, minmax(").concat(120,"px, 1fr))")},children:[(0,r.jsx)("div",{className:"px-2 py-1.5 text-[11px] font-medium text-gray-600",children:"Partido"}),$.map(e=>(0,r.jsx)("div",{className:"p-1",children:(0,r.jsx)(ex,{ymd:e,turn:t})},"".concat(e,"-").concat(t,"-partido")))]})}function em(e){var t;let{ymd:a,turn:n}=e,[l,o]=(0,s.useState)(ee(a,n));(0,s.useEffect)(()=>{o(ee(a,n))},[U,a,n]);let i=(null===(t=k.find(e=>e.value===l))||void 0===t?void 0:t.colorClass)||"";return(0,r.jsx)("div",{className:"p-1 ".concat(i),children:(0,r.jsx)("select",{className:"h-7 w-full rounded-md border px-1.5 text-[11px] ".concat(i),value:l,onChange:async e=>{let t=e.target.value;o(t),await et(a,n,t)},children:k.map(e=>(0,r.jsx)("option",{value:e.value,children:e.value||"—"},e.value||"none"))})})}function ef(e){let{turn:t}=e;return(0,r.jsxs)("div",{className:"grid items-center border-b",style:{gridTemplateColumns:"".concat(120,"px repeat(7, minmax(").concat(120,"px, 1fr))")},children:[(0,r.jsx)("div",{className:"px-2 py-1.5 text-[11px] font-medium text-gray-600",children:"Intensidad"}),$.map(e=>(0,r.jsx)(em,{ymd:e,turn:t},"".concat(e,"-").concat(t,"-micro")))]})}function eh(e){let{children:t}=e;return(0,r.jsx)("div",{className:"bg-emerald-50 text-emerald-900 font-semibold px-2 py-1 border-b uppercase tracking-wide text-[12px]",children:t})}let eg=Object.keys(ea).length;return(0,r.jsxs)("div",{className:"jsx-83c39fd188e7c9f3 p-3 md:p-4 space-y-3",children:[(0,r.jsx)(l(),{id:"83c39fd188e7c9f3",children:"[contenteditable][data-placeholder].jsx-83c39fd188e7c9f3:empty:before{content:attr(data-placeholder);color:#9ca3af;pointer-events:none;display:block}"}),!a&&(0,r.jsxs)("header",{className:"jsx-83c39fd188e7c9f3 flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[(0,r.jsxs)("div",{className:"jsx-83c39fd188e7c9f3",children:[(0,r.jsx)("h1",{className:"jsx-83c39fd188e7c9f3 text-lg md:text-xl font-bold",children:"Plan semanal — Editor en tabla"}),(0,r.jsxs)("p",{className:"jsx-83c39fd188e7c9f3 text-xs md:text-sm text-gray-500",children:["Semana ",U||"—"," → ",M||"—"," (Lun→Dom)"]})]}),(0,r.jsxs)("div",{className:"jsx-83c39fd188e7c9f3 flex flex-wrap items-center gap-2",children:[(0,r.jsx)("button",{onClick:()=>F(()=>f(e=>R(e,-7))),className:"jsx-83c39fd188e7c9f3 px-2.5 py-1.5 rounded-xl border hover:bg-gray-50 text-xs",children:"◀ Semana anterior"}),(0,r.jsx)("button",{onClick:()=>F(()=>f((0,i.$9)(new Date))),className:"jsx-83c39fd188e7c9f3 px-2.5 py-1.5 rounded-xl border hover:bg-gray-50 text-xs",children:"Hoy"}),(0,r.jsx)("button",{onClick:()=>F(()=>f(e=>R(e,7))),className:"jsx-83c39fd188e7c9f3 px-2.5 py-1.5 rounded-xl border hover:bg-gray-50 text-xs",children:"Semana siguiente ▶"}),(0,r.jsx)("div",{className:"jsx-83c39fd188e7c9f3 w-px h-6 bg-gray-200 mx-1"}),(0,r.jsx)("button",{onClick:eo,disabled:0===eg||en,title:eg?"".concat(eg," cambio(s) por guardar"):"Sin cambios",className:"jsx-83c39fd188e7c9f3 "+"px-3 py-1.5 rounded-xl text-xs ".concat(0===eg||en?"bg-gray-200 text-gray-500":"bg-black text-white hover:opacity-90"),children:en?"Guardando...":"Guardar cambios".concat(eg?" (".concat(eg,")"):"")})]})]}),(0,r.jsxs)("div",{className:"jsx-83c39fd188e7c9f3 flex items-center gap-2",children:[(0,r.jsx)("button",{onClick:()=>{p("editor"),u("morning")},className:"jsx-83c39fd188e7c9f3 "+"px-3 py-1.5 rounded-xl border text-xs ".concat("editor"===x&&"morning"===d?"bg-black text-white":"hover:bg-gray-50"),children:"Ma\xf1ana"}),(0,r.jsx)("button",{onClick:()=>{p("editor"),u("afternoon")},className:"jsx-83c39fd188e7c9f3 "+"px-3 py-1.5 rounded-xl border text-xs ".concat("editor"===x&&"afternoon"===d?"bg-black text-white":"hover:bg-gray-50"),children:"Tarde"}),(0,r.jsx)("button",{onClick:()=>p("tools"),title:"Herramientas","aria-label":"Herramientas",className:"jsx-83c39fd188e7c9f3 "+"px-3 py-1.5 rounded-xl border text-xs ".concat("tools"===x?"bg-black text-white":"hover:bg-gray-50"),children:"⚙️"})]}),"tools"===x?(0,r.jsx)("div",{className:"jsx-83c39fd188e7c9f3 rounded-2xl border bg-white shadow-sm p-3",children:(0,r.jsx)(g,{onAfterChange:()=>{_(m),Z()}})}):h?(0,r.jsx)("div",{className:"jsx-83c39fd188e7c9f3 text-gray-500",children:"Cargando semana…"}):(0,r.jsx)("div",{className:"jsx-83c39fd188e7c9f3 overflow-x-auto rounded-2xl border bg-white shadow-sm",children:(0,r.jsx)(function(e){let{turn:t}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"grid text-xs",style:{gridTemplateColumns:"".concat(120,"px repeat(7, minmax(").concat(120,"px, 1fr))")},children:[(0,r.jsx)("div",{className:"bg-gray-50 border-b px-2 py-1.5 font-semibold text-gray-600"}),$.map(e=>(0,r.jsxs)("div",{className:"bg-gray-50 border-b px-2 py-1.5",children:[(0,r.jsx)("div",{className:"text-[11px] font-semibold uppercase tracking-wide",children:new Date("".concat(e,"T00:00:00.000Z")).toLocaleDateString(void 0,{weekday:"short",day:"2-digit",month:"2-digit",timeZone:"UTC"})}),(0,r.jsx)("div",{className:"text-[10px] text-gray-400",children:e})]},"".concat(t,"-").concat(e)))]}),(0,r.jsx)(eh,{children:"MICROCICLO"}),(0,r.jsx)(eu,{turn:t}),(0,r.jsx)(ef,{turn:t}),(0,r.jsx)(ep,{turn:t}),(0,r.jsx)(eh,{children:"DETALLES"}),w.map(e=>(0,r.jsxs)("div",{className:"grid items-center",style:{gridTemplateColumns:"".concat(120,"px repeat(7, minmax(").concat(120,"px, 1fr))")},children:[(0,r.jsx)("div",{className:"bg-gray-50/60 border-r px-2 py-1.5 text-[11px] font-medium text-gray-600",children:e}),$.map(a=>(0,r.jsx)("div",{className:"p-1",children:(0,r.jsx)(ei,{dayYmd:a,turn:t,row:e})},"".concat(a,"-").concat(t,"-").concat(e)))]},"".concat(t,"-meta-").concat(e))),(0,r.jsxs)("div",{className:"border-t",children:[(0,r.jsxs)("div",{className:"px-2 py-1 text-[10px] text-gray-600 border-b bg-gray-50",children:["Escrib\xed el ",(0,r.jsx)("b",{children:"contenido general"})," (t\xedtulos). El detalle se edita en ",(0,r.jsx)("b",{children:"“Ejercicio completo”"}),"."]}),(0,r.jsx)("div",{className:"bg-emerald-100/70 text-emerald-900 font-semibold px-2 py-1 border-b uppercase tracking-wide text-[12px]",children:"morning"===t?"TURNO MA\xd1ANA":"TURNO TARDE"}),j.map(e=>(0,r.jsxs)("div",{className:"grid items-stretch",style:{gridTemplateColumns:"".concat(120,"px repeat(7, minmax(").concat(120,"px, 1fr))")},children:[(0,r.jsx)("div",{className:"bg-gray-50/60 border-r px-2 py-2 text-[11px] font-medium text-gray-600 whitespace-pre-line",children:z(e)}),$.map(a=>(0,r.jsx)("div",{className:"p-1",children:(0,r.jsx)(ec,{dayYmd:a,turn:t,row:e})},"".concat(a,"-").concat(t,"-").concat(e)))]},"".concat(t,"-").concat(e)))]})]})},{turn:d,className:"jsx-83c39fd188e7c9f3"})}),(0,r.jsx)("datalist",{id:"places-datalist",className:"jsx-83c39fd188e7c9f3",children:(V||[]).map(e=>(0,r.jsx)("option",{value:e,className:"jsx-83c39fd188e7c9f3"},e))})]})}},97:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var r=a(7437),n=a(2265);function l(e){let{text:t,side:a="top",className:l="",sizePx:s=16}=e,o=n.useId(),i=(()=>{switch(a){case"bottom":return"left-1/2 -translate-x-1/2 top-full mt-1";case"left":return"right-full mr-2 top-1/2 -translate-y-1/2";case"right":return"left-full ml-2 top-1/2 -translate-y-1/2";default:return"left-1/2 -translate-x-1/2 bottom-full mb-1"}})(),c="absolute w-0 h-0 border-transparent",d=Math.max(12,Math.min(22,s)),u=(()=>{switch(a){case"bottom":return(0,r.jsx)("span",{"aria-hidden":!0,className:"".concat(c," left-1/2 -translate-x-1/2 -top-[6px] border-b-white border-[6px]"),style:{borderTopWidth:0,borderLeftColor:"transparent",borderRightColor:"transparent"}});case"left":return(0,r.jsx)("span",{"aria-hidden":!0,className:"".concat(c," -right-[6px] top-1/2 -translate-y-1/2 border-l-white border-[6px]"),style:{borderTopColor:"transparent",borderBottomColor:"transparent",borderRightWidth:0}});case"right":return(0,r.jsx)("span",{"aria-hidden":!0,className:"".concat(c," -left-[6px] top-1/2 -translate-y-1/2 border-r-white border-[6px]"),style:{borderTopColor:"transparent",borderBottomColor:"transparent",borderLeftWidth:0}});default:return(0,r.jsx)("span",{"aria-hidden":!0,className:"".concat(c," left-1/2 -translate-x-1/2 -bottom-[6px] border-t-white border-[6px]"),style:{borderLeftColor:"transparent",borderRightColor:"transparent",borderBottomWidth:0}})}})();return(0,r.jsx)("span",{className:"relative inline-flex items-center align-middle ".concat(l),children:(0,r.jsxs)("span",{className:"group relative inline-flex",children:[(0,r.jsx)("button",{type:"button","aria-describedby":o,className:"inline-flex items-center justify-center rounded-full border text-[10px] leading-none select-none cursor-help text-gray-700 border-gray-300 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-black",style:{width:d,height:d},children:"?"}),(0,r.jsxs)("span",{id:o,role:"tooltip",className:"".concat("pointer-events-none absolute z-50 hidden max-w-xs rounded-md border bg-white px-2 py-1 text-xs text-gray-700 shadow-lg"," ").concat(i," group-hover:block group-focus-within:block"),children:[t,u]})]})})}},4875:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});var r=a(7437),n=a(2265),l=function(){for(var e,t,a=0,r="",n=arguments.length;a<n;a++)(e=arguments[a])&&(t=function e(t){var a,r,n="";if("string"==typeof t||"number"==typeof t)n+=t;else if("object"==typeof t){if(Array.isArray(t)){var l=t.length;for(a=0;a<l;a++)t[a]&&(r=e(t[a]))&&(n&&(n+=" "),n+=r)}else for(r in t)t[r]&&(n&&(n+=" "),n+=r)}return n}(e))&&(r&&(r+=" "),r+=t);return r};function s(e){let{rivalId:t,rivalName:a,label:s="Plan de partido",className:o,fallbackHref:i,tab:c="plan"}=e,[d,u]=(0,n.useState)(null),[x,p]=(0,n.useState)(!1),m=(a||"").trim(),f=(0,n.useMemo)(()=>{if(!t)return"";let e=c?"?tab=".concat(encodeURIComponent(c)):"";return"/ct/rivales/".concat(t).concat(e)},[t,c]);(0,n.useEffect)(()=>{let e=!1;return async function(){if(f||!m){u(null);return}try{p(!0);let t=await fetch("/api/ct/rivales/search?q=".concat(encodeURIComponent(m),"&limit=5"),{cache:"no-store"});if(!t.ok)return;let a=await t.json().catch(()=>({})),r=Array.isArray(null==a?void 0:a.data)?a.data:[],n=r.find(e=>{var t;return(null===(t=e.name)||void 0===t?void 0:t.toLowerCase())===m.toLowerCase()})||null;e||u(n||r[0]||null)}catch(t){e||u(null)}finally{e||p(!1)}}(),()=>{e=!0}},[f,m]);let h=(0,n.useMemo)(()=>{if(f)return f;if(null==d?void 0:d.id){let e=c?"?tab=".concat(encodeURIComponent(c)):"";return"/ct/rivales/".concat(d.id).concat(e)}return i||(m?"/ct/rivales?search=".concat(encodeURIComponent(m)):"/ct/rivales")},[f,d,i,m,c]);return(0,r.jsx)("a",{href:h,className:l("inline-flex items-center rounded border px-1.5 py-0.5 text-[11px] hover:bg-gray-100 whitespace-nowrap",o),title:(null==d?void 0:d.name)||m||"Plan de partido","aria-busy":x,children:s})}},1673:function(e,t,a){"use strict";function r(e){let t=e.getUTCFullYear(),a=String(e.getUTCMonth()+1).padStart(2,"0"),r=String(e.getUTCDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(r)}function n(e){let t=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())),a=t.getUTCDay()||7;return 1!==a&&t.setUTCDate(t.getUTCDate()-(a-1)),t.setUTCHours(0,0,0,0),t}async function l(e){let{start:t}=e,a=await fetch("/api/sessions?start=".concat(encodeURIComponent(t)),{cache:"no-store"}),r=await a.json();if(!a.ok)throw Error((null==r?void 0:r.error)||"No se pudo cargar la semana");return r}async function s(e){let t=await fetch("/api/sessions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await t.json();if(!t.ok)throw Error((null==a?void 0:a.error)||"Error al crear la sesi\xf3n");return a}async function o(e,t){let a=await fetch("/api/sessions/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await a.json();if(!a.ok)throw Error((null==r?void 0:r.error)||"Error al actualizar la sesi\xf3n");return r}async function i(e){let t=await fetch("/api/sessions/".concat(e),{method:"DELETE"}),a=await t.json();if(!t.ok)throw Error((null==a?void 0:a.error)||"Error al borrar la sesi\xf3n");return a}async function c(e){let t=await fetch("/api/sessions/".concat(e),{cache:"no-store"}),a=await t.json();if(!t.ok)throw Error((null==a?void 0:a.error)||"Sesi\xf3n no encontrada");return a}a.d(t,{$9:function(){return n},CT:function(){return o},SO:function(){return i},VA:function(){return r},ed:function(){return s},tO:function(){return l},y4:function(){return c}})}},function(e){e.O(0,[8931,2971,7023,1744],function(){return e(e.s=9281)}),_N_E=e.O()}]);