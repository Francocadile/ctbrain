(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2424],{4704:function(e,t,a){Promise.resolve().then(a.bind(a,4203))},6463:function(e,t,a){"use strict";var s=a(1169);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},4203:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return x},dynamic:function(){return o}});var s=a(7437),r=a(2265),n=a(6463),l=a(97),i=a(1940);let o="force-dynamic";function d(e){return e.toISOString().slice(0,10)}let c={BAJA:"Fuera de toda actividad (OUT).",REINTEGRO:"RTP: retorno progresivo con restricciones.",LIMITADA:"LIM: entrena con limitaciones.",ALTA:"Alta m\xe9dica: sin restricciones (FULL)."};function x(){return(0,s.jsx)(r.Suspense,{fallback:(0,s.jsx)("div",{className:"p-4 text-gray-500",children:"Cargando…"}),children:(0,s.jsx)(m,{})})}function m(){var e;let t=(0,n.useSearchParams)(),a=t.get("tab")||"lista",[o,x]=(0,r.useState)(a);(0,r.useEffect)(()=>{let e=new URL(window.location.href);e.searchParams.set("tab",o),window.history.replaceState({},"",e.toString())},[o]);let m=(0,r.useMemo)(()=>d(new Date),[]),[u,h]=(0,r.useState)(t.get("date")||m),[p,b]=(0,r.useState)(t.get("month")||m.slice(0,7)),{start:g,end:f}=(0,r.useMemo)(()=>{let[e,t]=p.split("-").map(Number);return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=new Date(e.getFullYear(),e.getMonth(),1),a=new Date(e.getFullYear(),e.getMonth()+1,0);return{start:d(t),end:d(a)}}(new Date(e,(t||1)-1,1))},[p]);(0,r.useEffect)(()=>{let e=new URL(window.location.href);e.searchParams.set("date",u),e.searchParams.set("month",p),window.history.replaceState({},"",e.toString())},[u,p]);let[j,y]=(0,r.useState)([]),[N,v]=(0,r.useState)(!1),[w,C]=(0,r.useState)(null),[S,L]=(0,r.useState)(""),[E,T]=(0,r.useState)(null),[M,R]=(0,r.useState)(!1),[A,D]=(0,r.useState)(null),O=(0,r.useCallback)(async()=>{v(!0),C(null);try{let e=await fetch("/api/med/clinical?date=".concat(u),{cache:"no-store"});if(!e.ok)throw Error("HTTP ".concat(e.status));let t=await e.json(),a=(Array.isArray(t)?t:[]).map(e=>{var t;return{...e,availability:function(e,t){if(t)return t;switch(e){case"ALTA":return"FULL";case"REINTEGRO":case"LIMITADA":return"MODIFIED";default:return"OUT"}}(null==e?void 0:e.status,null!==(t=null==e?void 0:e.availability)&&void 0!==t?t:null)}});y(a)}catch(e){y([]),C((null==e?void 0:e.message)||"Error")}finally{v(!1)}},[u]),P=(0,r.useCallback)(async()=>{R(!0),D(null);try{let e=await fetch("/api/med/clinical/analytics?start=".concat(g,"&end=").concat(f),{cache:"no-store"});if(!e.ok)throw Error("HTTP ".concat(e.status));let t=await e.json();T(t)}catch(e){T(null),D((null==e?void 0:e.message)||"Error")}finally{R(!1)}},[g,f]);(0,r.useEffect)(()=>{O()},[u,O]),(0,r.useEffect)(()=>{P()},[g,f,P]);let I=(0,r.useMemo)(()=>{let e=S.trim().toLowerCase();return e?j.filter(t=>(t.userName||"").toLowerCase().includes(e)||(t.bodyPart||"").toLowerCase().includes(e)||(t.mechanism||"").toLowerCase().includes(e)):j},[j,S]);function k(e){let{items:t,max:a}=e,r=null!=a?a:Math.max(1,...t.map(e=>e.count));return(0,s.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,s.jsxs)("div",{className:"grid grid-cols-[1fr_auto] items-center gap-3",children:[(0,s.jsx)("div",{className:"h-2 rounded bg-gray-100",children:(0,s.jsx)("div",{className:"h-2 rounded bg-gray-800",style:{width:"".concat(Math.min(100,e.count/r*100),"%")},title:"".concat(e.count)})}),(0,s.jsxs)("div",{className:"text-xs text-gray-700 whitespace-nowrap",children:[e.name," (",e.count,")"]})]},e.name))})}return(0,s.jsxs)("main",{className:"min-h-[70vh] px-6 py-10",children:[(0,s.jsxs)("header",{className:"mb-6 flex flex-col gap-2 md:flex-row md:items-end md:justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"Parte cl\xednico — Vista CT"}),(0,s.jsxs)("p",{className:"mt-1 text-sm text-gray-600",children:["M\xe9tricas del per\xedodo + lista diaria."," ",(0,s.jsx)(l.Z,{text:"Sem\xe1foro: Verde=Alta/Full \xb7 Amarillo=Reintegro/Limitada (Modified) \xb7 Rojo=Baja (Out)"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("label",{className:"text-sm",children:"Mes"}),(0,s.jsx)("input",{type:"month",className:"h-10 rounded-md border px-3 text-sm",value:p,onChange:e=>b(e.target.value)})]})]}),(0,s.jsx)("div",{className:"mb-4 flex w-full rounded-xl border p-1",children:["lista","metricas"].map(e=>(0,s.jsx)("button",{onClick:()=>x(e),className:"flex-1 rounded-lg px-4 py-2 text-sm font-medium transition ".concat(o===e?"bg-black text-white":"text-gray-800 hover:bg-gray-50"),children:"lista"===e?"Lista diaria":"M\xe9tricas (mes)"},e))}),"metricas"===o&&(0,s.jsx)("section",{className:"mb-6 rounded-2xl border bg-white p-5",children:M?(0,s.jsx)("div",{className:"text-gray-500",children:"Cargando m\xe9tricas…"}):A?(0,s.jsxs)("div",{className:"text-red-600",children:["Error al cargar m\xe9tricas: ",A]}):E?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"mb-4 text-xs text-gray-500",children:["Rango: ",E.range.start," → ",E.range.end]}),(0,s.jsxs)("div",{className:"grid gap-4 sm:grid-cols-4",children:[(0,s.jsxs)("div",{className:"rounded-xl border p-4",children:[(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Episodios"}),(0,s.jsx)("div",{className:"text-2xl font-bold",children:E.totals.episodes})]}),(0,s.jsxs)("div",{className:"rounded-xl border p-4",children:[(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Jugadores afectados"}),(0,s.jsx)("div",{className:"text-2xl font-bold",children:E.totals.playersAffected})]}),(0,s.jsxs)("div",{className:"rounded-xl border p-4",children:[(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Prom. d\xedas estimados"}),(0,s.jsx)("div",{className:"text-2xl font-bold",children:null!==(e=E.totals.avgEstimatedDays)&&void 0!==e?e:"—"})]}),(0,s.jsxs)("div",{className:"rounded-xl border p-4",children:[(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Estados"}),(0,s.jsxs)("div",{className:"text-sm",children:["BAJA ",E.totals.statusCounts.BAJA," \xb7 RTP"," ",E.totals.statusCounts.REINTEGRO," \xb7 LIM"," ",E.totals.statusCounts.LIMITADA," \xb7 ALTA"," ",E.totals.statusCounts.ALTA]})]})]}),(0,s.jsxs)("div",{className:"mt-6 grid gap-6 md:grid-cols-2",children:[(0,s.jsxs)("div",{className:"rounded-xl border p-4",children:[(0,s.jsx)("div",{className:"mb-3 text-sm font-semibold",children:"Top zonas"}),E.bodyPartTop.length?(0,s.jsx)(k,{items:E.bodyPartTop}):(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Sin datos"})]}),(0,s.jsxs)("div",{className:"rounded-xl border p-4",children:[(0,s.jsx)("div",{className:"mb-3 text-sm font-semibold",children:"Top mecanismos"}),E.mechanismTop.length?(0,s.jsx)(k,{items:E.mechanismTop}):(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Sin datos"})]})]}),(0,s.jsxs)("div",{className:"mt-6 rounded-xl border p-4",children:[(0,s.jsx)("div",{className:"mb-3 text-sm font-semibold",children:"Top jugadores por d\xedas fuera (estimado)"}),E.topPlayersByDaysOut.length?(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-[480px] text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b bg-gray-50",children:[(0,s.jsx)("th",{className:"px-3 py-2 text-left",children:"Jugador"}),(0,s.jsx)("th",{className:"px-3 py-2 text-right",children:"D\xedas"}),(0,s.jsx)("th",{className:"px-3 py-2 text-right",children:"Episodios"})]})}),(0,s.jsx)("tbody",{children:E.topPlayersByDaysOut.map(e=>(0,s.jsxs)("tr",{className:"border-b last:border-0",children:[(0,s.jsx)("td",{className:"px-3 py-2",children:e.name}),(0,s.jsx)("td",{className:"px-3 py-2 text-right",children:e.daysOut}),(0,s.jsx)("td",{className:"px-3 py-2 text-right",children:e.episodes})]},e.userId))})]})}):(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Sin datos"})]})]}):null}),"lista"===o&&(0,s.jsxs)("section",{className:"rounded-2xl border bg-white overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-2 border-b bg-gray-50 p-3 md:flex-row md:items-center md:justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("label",{className:"text-sm",children:"Fecha"}),(0,s.jsx)("input",{type:"date",className:"h-10 rounded-md border px-3 text-sm",value:u,onChange:e=>h(e.target.value)})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{className:"w-full md:w-80 rounded-md border px-3 py-2 text-sm",placeholder:"Buscar por jugador, zona o mecanismo…",value:S,onChange:e=>L(e.target.value)}),(0,s.jsx)("button",{onClick:O,className:"h-10 rounded-md border px-4 text-sm hover:bg-gray-50",children:"Recargar"}),(0,s.jsx)("button",{onClick:function(){let e=I.map(e=>{var t;return{Jugador:e.userName,Fecha:e.date,Estado:e.status||"",Disponibilidad:e.availability||"",Zona:e.bodyPart||"",Lateralidad:e.laterality||"",Mecanismo:e.mechanism||"",Severidad:e.severity||"",ETR:e.expectedReturn||"",CapMin:null!==(t=e.capMinutes)&&void 0!==t?t:"",NoSprint:e.noSprint?"1":"",NoCOD:e.noChangeOfDirection?"1":"",SoloGym:e.gymOnly?"1":"",NoContacto:e.noContact?"1":""}}),t=new Blob([(0,i.C)(e,["Jugador","Fecha","Estado","Disponibilidad","Zona","Lateralidad","Mecanismo","Severidad","ETR","CapMin","NoSprint","NoCOD","SoloGym","NoContacto"])],{type:"text/csv;charset=utf-8"}),a=document.createElement("a");a.href=URL.createObjectURL(t),a.download="clinical_".concat(u,".csv"),a.click(),URL.revokeObjectURL(a.href)},disabled:0===I.length,className:"h-10 rounded-md bg-black px-4 text-sm text-white disabled:opacity-50",children:"Exportar CSV"})]})]}),N?(0,s.jsx)("div",{className:"p-4 text-gray-500",children:"Cargando…"}):w?(0,s.jsxs)("div",{className:"p-4 text-red-600",children:["Error al cargar: ",w]}):0===I.length?(0,s.jsx)("div",{className:"p-4 text-gray-500 italic",children:"Sin datos"}):(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b bg-gray-50",children:[(0,s.jsx)("th",{className:"text-left px-3 py-2",children:"Jugador"}),(0,s.jsx)("th",{className:"text-left px-3 py-2",children:"Estado"}),(0,s.jsx)("th",{className:"text-left px-3 py-2",children:"Dispon."}),(0,s.jsx)("th",{className:"text-left px-3 py-2",children:"Zona"}),(0,s.jsx)("th",{className:"text-left px-3 py-2",children:"Lat."}),(0,s.jsx)("th",{className:"text-left px-3 py-2",children:"Mecanismo"}),(0,s.jsx)("th",{className:"text-left px-3 py-2",children:"Severidad"}),(0,s.jsx)("th",{className:"text-left px-3 py-2",children:"ETR"}),(0,s.jsx)("th",{className:"text-left px-3 py-2",children:"Restricciones"})]})}),(0,s.jsx)("tbody",{children:I.map(e=>(0,s.jsxs)("tr",{className:"border-b last:border-0 align-top",children:[(0,s.jsxs)("td",{className:"px-3 py-2 font-medium",children:[(0,s.jsx)("span",{className:"inline-block rounded-full border px-2 py-0.5 text-[11px] mr-2 ".concat("ALTA"===e.status||"FULL"===e.availability?"bg-green-100 text-green-700 border-green-200":"REINTEGRO"===e.status||"LIMITADA"===e.status||"MODIFIED"===e.availability?"bg-amber-100 text-amber-700 border-amber-200":"bg-red-100 text-red-700 border-red-200"),title:function(e,t){let a=c[e];return"".concat(a).concat("FULL"===t?" (FULL)":"MODIFIED"===t?" (MODIFIED)":" (OUT)")}(e.status,e.availability),children:"●"}),e.userName]}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.status}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.availability||"—"}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.bodyPart||"—"}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.laterality||"—"}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.mechanism||"—"}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.severity||"—"}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.expectedReturn||"—"}),(0,s.jsx)("td",{className:"px-3 py-2 text-xs text-gray-700",children:(0,s.jsxs)("div",{className:"space-y-0.5",children:[e.capMinutes?(0,s.jsxs)("div",{children:["Cap: ",e.capMinutes,"′"]}):null,e.noSprint?(0,s.jsx)("div",{children:"Sin sprint"}):null,e.noChangeOfDirection?(0,s.jsx)("div",{children:"Sin cambios dir."}):null,e.gymOnly?(0,s.jsx)("div",{children:"Solo gym"}):null,e.noContact?(0,s.jsx)("div",{children:"Sin contacto"}):null,e.capMinutes||e.noSprint||e.noChangeOfDirection||e.gymOnly||e.noContact?null:(0,s.jsx)("span",{className:"text-gray-400",children:"—"})]})})]},e.id))})]})})]}),(0,s.jsxs)("div",{className:"rounded-xl border bg-white p-3 text-xs text-gray-600 mt-3",children:[(0,s.jsx)("b",{children:"Nota:"})," Vista de lectura para CT. Los datos se cargan en el panel m\xe9dico."]})]})}},97:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var s=a(7437),r=a(2265);function n(e){let{text:t,side:a="top",className:n="",sizePx:l=16}=e,i=r.useId(),o=(()=>{switch(a){case"bottom":return"left-1/2 -translate-x-1/2 top-full mt-1";case"left":return"right-full mr-2 top-1/2 -translate-y-1/2";case"right":return"left-full ml-2 top-1/2 -translate-y-1/2";default:return"left-1/2 -translate-x-1/2 bottom-full mb-1"}})(),d="absolute w-0 h-0 border-transparent",c=Math.max(12,Math.min(22,l)),x=(()=>{switch(a){case"bottom":return(0,s.jsx)("span",{"aria-hidden":!0,className:"".concat(d," left-1/2 -translate-x-1/2 -top-[6px] border-b-white border-[6px]"),style:{borderTopWidth:0,borderLeftColor:"transparent",borderRightColor:"transparent"}});case"left":return(0,s.jsx)("span",{"aria-hidden":!0,className:"".concat(d," -right-[6px] top-1/2 -translate-y-1/2 border-l-white border-[6px]"),style:{borderTopColor:"transparent",borderBottomColor:"transparent",borderRightWidth:0}});case"right":return(0,s.jsx)("span",{"aria-hidden":!0,className:"".concat(d," -left-[6px] top-1/2 -translate-y-1/2 border-r-white border-[6px]"),style:{borderTopColor:"transparent",borderBottomColor:"transparent",borderLeftWidth:0}});default:return(0,s.jsx)("span",{"aria-hidden":!0,className:"".concat(d," left-1/2 -translate-x-1/2 -bottom-[6px] border-t-white border-[6px]"),style:{borderLeftColor:"transparent",borderRightColor:"transparent",borderBottomWidth:0}})}})();return(0,s.jsx)("span",{className:"relative inline-flex items-center align-middle ".concat(n),children:(0,s.jsxs)("span",{className:"group relative inline-flex",children:[(0,s.jsx)("button",{type:"button","aria-describedby":i,className:"inline-flex items-center justify-center rounded-full border text-[10px] leading-none select-none cursor-help text-gray-700 border-gray-300 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-black",style:{width:c,height:c},children:"?"}),(0,s.jsxs)("span",{id:i,role:"tooltip",className:"".concat("pointer-events-none absolute z-50 hidden max-w-xs rounded-md border bg-white px-2 py-1 text-xs text-gray-700 shadow-lg"," ").concat(o," group-hover:block group-focus-within:block"),children:[t,x]})]})})}},1940:function(e,t,a){"use strict";function s(e,t){if(!e||0===e.length)return"";let a=t&&t.length?t:Object.keys(e[0]),s=e=>{if(null==e)return"";let t=String(e);return/[",\n]/.test(t)?'"'.concat(t.replace(/"/g,'""'),'"'):t};return"\uFEFF"+a.map(s).join(",")+"\n"+e.map(e=>a.map(t=>s(e[t])).join(",")).join("\n")}a.d(t,{C:function(){return s}})}},function(e){e.O(0,[2971,7023,1744],function(){return e(e.s=4704)}),_N_E=e.O()}]);