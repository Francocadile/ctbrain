(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[174],{3016:function(e,l,t){Promise.resolve().then(t.bind(t,42))},7138:function(e,l,t){"use strict";t.d(l,{default:function(){return r.a}});var a=t(231),r=t.n(a)},6463:function(e,l,t){"use strict";var a=t(1169);t.o(a,"useParams")&&t.d(l,{useParams:function(){return a.useParams}}),t.o(a,"usePathname")&&t.d(l,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(l,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(l,{useSearchParams:function(){return a.useSearchParams}})},42:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return o}});var a=t(7437),r=t(7138),n=t(6463),s=t(2265);function i(e){let l=Number(e);return Number.isFinite(l)?l:null}function d(e){var l,t;return{id:e.id,number:null!==(l=e.number)&&void 0!==l?l:null,name:(e.name||"").trim(),position:(null!==(t=e.position)&&void 0!==t?t:null)?String(e.position).trim():null,video:e.video?{title:e.video.title?String(e.video.title).trim():null,url:e.video.url?String(e.video.url).trim():null}:null}}function o(){let{id:e}=(0,n.useParams)(),[l,t]=(0,s.useState)(null),[o,u]=(0,s.useState)(!0),[c,m]=(0,s.useState)([]),[x,p]=(0,s.useState)([]),[v,h]=(0,s.useState)(!0),[g,j]=(0,s.useState)(!1),[f,b]=(0,s.useState)(""),[y,N]=(0,s.useState)(""),[w,S]=(0,s.useState)(""),[C,k]=(0,s.useState)(""),[P,R]=(0,s.useState)(""),[E,L]=(0,s.useState)(""),[V,A]=(0,s.useState)(null),T=(0,s.useRef)(null);function _(){let e=w.trim(),l=y.trim()||C.trim()||P.trim()||E.trim();return(e||l)&&e?{number:""===y?null:i(y),name:e,position:C.trim()||null,video:P.trim()||E.trim()?{title:P.trim()||null,url:E.trim()||null}:null}:null}function U(){N(""),S(""),k(""),R(""),L("")}async function O(){h(!0);try{var l;let t=await fetch("/api/ct/rivales/".concat(e,"/squad"),{cache:"no-store"}),a=await t.json().catch(()=>({})),r=((Array.isArray(null==a?void 0:a.data)?a.data:Array.isArray(null==a?void 0:null===(l=a.data)||void 0===l?void 0:l.players)?a.data.players:[])||[]).map(e=>{var l,t,a;return{id:e.id,number:i(e.number),name:null!==(l=e.name)&&void 0!==l?l:"",position:null!==(t=e.position)&&void 0!==t?t:null,video:null!==(a=e.video)&&void 0!==a?a:null}});m(r),p(r.map(d))}finally{h(!1)}}function D(){let e=_();e&&(m(l=>[e,...l]),U())}function J(e,l){m(t=>{let a=[...t];return a[e]={...a[e],...l},a})}function M(e,l){m(t=>{var a;let r=[...t],n=null!==(a=r[e].video)&&void 0!==a?a:{};r[e]={...r[e],video:{...n,...l}};let s=r[e].video;return s.title||s.url||(r[e].video=null),r})}async function q(){j(!0);try{let l=_(),t={squad:(l?[l,...c]:c).map(e=>d(e))},a=await fetch("/api/ct/rivales/".concat(e,"/squad"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw Error(await a.text());await O(),l&&U(),alert("Plantel guardado")}catch(e){alert((null==e?void 0:e.message)||"No se pudo guardar el plantel")}finally{j(!1)}}async function B(e){return new Promise((l,t)=>{let a=new FileReader;a.onload=()=>l(String(a.result||"")),a.onerror=t,a.readAsText(e)})}function G(e){let l=e.split(/\r?\n/).map(e=>e.trim()).filter(Boolean);if(!l.length)return[];let t=l[0].split(",").map(e=>e.trim().toLowerCase()),a=e=>t.findIndex(l=>e.includes(l)),r=a(["#","number","dorsal"]),n=a(["name","jugador","player","nombre"]),s=a(["position","posicion","pos"]),d=a(["videotitle","video_title","titulo","titulo video","title"]),o=a(["videourl","video_url","url","url video","link"]),u=[];for(let e=1;e<l.length;e++){let t=l[e].split(",").map(e=>e.trim()),a=n>=0?t[n]:"";if(!a)continue;let c=r>=0?t[r]:"",m=s>=0?t[s]:"",x=d>=0?t[d]:"",p=o>=0?t[o]:"";u.push({name:a,number:""===c?null:i(c),position:m||null,video:x||p?{title:x||null,url:p||null}:null})}return u}async function F(){if(V)try{let e=await B(V),l=G(e);m(l)}catch(e){alert("No se pudo leer el CSV")}}async function I(){if(V)try{let e=await B(V),l=G(e);m(e=>[...l,...e])}catch(e){alert("No se pudo leer el CSV")}}(0,s.useEffect)(()=>{(async()=>{try{u(!0);let l=await fetch("/api/ct/rivales/".concat(e),{cache:"no-store"});if(l.ok){let e=await l.json();t(null==e?void 0:e.data)}}finally{u(!1)}})()},[e]),(0,s.useEffect)(()=>{O()},[e]);let z=(0,s.useMemo)(()=>{let e=f.trim().toLowerCase();return e?c.filter(l=>l.name.toLowerCase().includes(e)||(l.position||"").toLowerCase().includes(e)||String(l.number||"").includes(e)):c},[c,f]),H=!!_(),K=(0,s.useMemo)(()=>{let e=c.map(d),l=x.map(d);return H||JSON.stringify(e)!==JSON.stringify(l)},[c,x,H]);return(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,a.jsx)(r.default,{href:"/ct/rivales",className:"underline",children:"Rivales"}),(0,a.jsx)("span",{className:"mx-1",children:"/"}),(0,a.jsx)("span",{className:"font-medium",children:"Plantel"})]}),(0,a.jsxs)("div",{className:"flex items-end justify-between gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-bold",children:"Plantel"}),o?(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Cargando…"}):l?(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["DT: ",(0,a.jsx)("b",{children:l.coach||"—"})," \xb7 Sistema base: ",l.baseSystem||"—"]}):null]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:q,disabled:g,className:"px-3 py-1.5 rounded-xl text-xs ".concat(g?"bg-gray-200 text-gray-500":"bg-black text-white hover:opacity-90"),children:g?"Guardando…":"Guardar plantel"}),!K&&(0,a.jsx)("span",{className:"text-[11px] text-gray-500",children:"Sin cambios"})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,a.jsx)("input",{className:"rounded-md border px-2 py-1.5 text-sm w-64",placeholder:"Buscar jugador…",value:f,onChange:e=>b(e.target.value)}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsxs)("label",{className:"text-xs",children:[(0,a.jsx)("input",{ref:T,type:"file",accept:".csv,text/csv",className:"hidden",onChange:e=>{var l;return A((null===(l=e.target.files)||void 0===l?void 0:l[0])||null)}}),(0,a.jsx)("button",{onClick:()=>{var e;return null===(e=T.current)||void 0===e?void 0:e.click()},className:"px-3 py-1.5 rounded-xl border text-xs hover:bg-gray-50",children:"Seleccionar archivo"})]}),(0,a.jsx)("span",{className:"text-xs text-gray-500 min-w-[140px] truncate",children:V?V.name:"Sin archivos seleccionados"}),(0,a.jsx)("button",{onClick:F,disabled:!V,className:"px-3 py-1.5 rounded-xl text-xs ".concat(V?"border hover:bg-gray-50":"bg-gray-200 text-gray-500"),children:"Reemplazar por CSV"}),(0,a.jsx)("button",{onClick:I,disabled:!V,className:"px-3 py-1.5 rounded-xl text-xs ".concat(V?"border hover:bg-gray-50":"bg-gray-200 text-gray-500"),children:"Agregar del CSV"}),(0,a.jsx)("button",{onClick:function(){let e=new Blob([[["number","name","position","videoTitle","videoUrl"],...c.map(e=>{var l,t,a,r,n,s,i;return[null!==(a=e.number)&&void 0!==a?a:"",null!==(r=e.name)&&void 0!==r?r:"",null!==(n=e.position)&&void 0!==n?n:"",null!==(s=null===(l=e.video)||void 0===l?void 0:l.title)&&void 0!==s?s:"",null!==(i=null===(t=e.video)||void 0===t?void 0:t.url)&&void 0!==i?i:""]})].map(e=>e.map(String).join(",")).join("\n")],{type:"text/csv;charset=utf-8"}),l=URL.createObjectURL(e),t=document.createElement("a");t.href=l,t.download="plantel.csv",t.click(),URL.revokeObjectURL(l)},className:"px-3 py-1.5 rounded-xl border text-xs hover:bg-gray-50",children:"Exportar CSV"})]})]}),(0,a.jsxs)("div",{className:"rounded-xl border p-3 bg-gray-50",children:[(0,a.jsx)("div",{className:"text-[12px] font-semibold uppercase tracking-wide mb-2",children:"Alta manual de jugador (opcional)"}),(0,a.jsxs)("div",{className:"grid lg:grid-cols-5 md:grid-cols-4 gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-[11px] text-gray-500",children:"#"}),(0,a.jsx)("input",{className:"w-full rounded-md border px-2 py-1.5 text-sm",inputMode:"numeric",value:y,onChange:e=>N(e.target.value),placeholder:"Dorsal"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"text-[11px] text-gray-500",children:"Jugador *"}),(0,a.jsx)("input",{className:"w-full rounded-md border px-2 py-1.5 text-sm",value:w,onChange:e=>S(e.target.value),placeholder:"Nombre y apellido"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-[11px] text-gray-500",children:"Posici\xf3n"}),(0,a.jsx)("input",{className:"w-full rounded-md border px-2 py-1.5 text-sm",value:C,onChange:e=>k(e.target.value),placeholder:"Ej: DL"})]}),(0,a.jsxs)("div",{className:"lg:col-span-5 md:col-span-4 grid md:grid-cols-3 gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-[11px] text-gray-500",children:"T\xedtulo de video (opcional)"}),(0,a.jsx)("input",{className:"w-full rounded-md border px-2 py-1.5 text-sm",value:P,onChange:e=>R(e.target.value),placeholder:"Highlights vs…"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"text-[11px] text-gray-500",children:"URL del video"}),(0,a.jsx)("input",{className:"w-full rounded-md border px-2 py-1.5 text-sm",value:E,onChange:e=>L(e.target.value),placeholder:"https://…",onKeyDown:e=>"Enter"===e.key?(e.preventDefault(),D()):null})]})]})]}),(0,a.jsxs)("div",{className:"pt-2",children:[(0,a.jsx)("button",{onClick:D,className:"text-xs px-3 py-1.5 rounded-xl border hover:bg-white",children:"+ Agregar al plantel"}),(0,a.jsxs)("span",{className:"ml-3 text-xs text-gray-500",children:["Tambi\xe9n pod\xe9s cargar un CSV arriba y despu\xe9s ",(0,a.jsx)("b",{children:"Guardar plantel"}),"."]})]})]}),(0,a.jsx)("div",{className:"rounded-xl border overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left p-2 w-16",children:"#"}),(0,a.jsx)("th",{className:"text-left p-2 min-w-[220px]",children:"Jugador"}),(0,a.jsx)("th",{className:"text-left p-2 w-40",children:"Posici\xf3n"}),(0,a.jsx)("th",{className:"text-left p-2 min-w-[240px]",children:"Video"}),(0,a.jsx)("th",{className:"text-left p-2 min-w-[260px]",children:"Cargar / editar video"}),(0,a.jsx)("th",{className:"p-2 w-24"})]})}),(0,a.jsx)("tbody",{children:v?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:6,className:"p-3 text-gray-500",children:"Cargando…"})}):0===z.length?(0,a.jsx)("tr",{children:(0,a.jsxs)("td",{colSpan:6,className:"p-3 text-gray-500",children:["Sin jugadores. Agreg\xe1 manualmente arriba o carg\xe1 el CSV en"," ",(0,a.jsx)(r.default,{href:"/ct/rivales/".concat(e,"?tab=importar"),className:"underline",children:"Importar → CSV"}),"."]})}):z.map((e,l)=>{var t,r,n,s,d,o,u;return(0,a.jsxs)("tr",{className:"border-t align-top",children:[(0,a.jsx)("td",{className:"p-2",children:(0,a.jsx)("input",{className:"w-16 rounded-md border px-2 py-1",inputMode:"numeric",value:null!==(s=e.number)&&void 0!==s?s:"",onChange:e=>J(l,{number:""===e.target.value?null:i(e.target.value)})})}),(0,a.jsx)("td",{className:"p-2",children:(0,a.jsx)("input",{className:"w-full rounded-md border px-2 py-1",value:e.name,onChange:e=>J(l,{name:e.target.value})})}),(0,a.jsx)("td",{className:"p-2",children:(0,a.jsx)("input",{className:"w-full rounded-md border px-2 py-1",value:null!==(d=e.position)&&void 0!==d?d:"",onChange:e=>J(l,{position:e.target.value}),placeholder:"Ej: MC"})}),(0,a.jsx)("td",{className:"p-2",children:(null===(t=e.video)||void 0===t?void 0:t.url)?(0,a.jsx)("a",{href:e.video.url,className:"underline",target:"_blank",rel:"noreferrer",children:e.video.title||e.video.url}):(0,a.jsx)("span",{className:"text-gray-500",children:"—"})}),(0,a.jsx)("td",{className:"p-2",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[(0,a.jsx)("input",{className:"rounded-md border px-2 py-1",placeholder:"T\xedtulo",value:null!==(o=null===(r=e.video)||void 0===r?void 0:r.title)&&void 0!==o?o:"",onChange:e=>M(l,{title:e.target.value})}),(0,a.jsx)("input",{className:"md:col-span-2 rounded-md border px-2 py-1",placeholder:"URL https://…",value:null!==(u=null===(n=e.video)||void 0===n?void 0:n.url)&&void 0!==u?u:"",onChange:e=>M(l,{url:e.target.value})})]})}),(0,a.jsx)("td",{className:"p-2",children:(0,a.jsx)("button",{onClick:()=>{m(e=>e.filter((e,t)=>t!==l))},className:"text-xs px-2 py-1 rounded-md border hover:bg-gray-50",children:"Borrar"})})]},l)})})]})}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["Tip: export\xe1 el listado actual con ",(0,a.jsx)("b",{children:"Exportar CSV"})," (respeta filtro/orden) y reimportalo cuando quieras."]})]})}}},function(e){e.O(0,[231,2971,7023,1744],function(){return e(e.s=3016)}),_N_E=e.O()}]);