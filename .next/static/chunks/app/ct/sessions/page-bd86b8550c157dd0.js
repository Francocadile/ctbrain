(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6128],{9540:function(e,t,n){Promise.resolve().then(n.bind(n,4609))},4609:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return u}});var r=n(7437),a=n(2265),s=n(1673);let i="NOMBRE SESI\xd3N",o=/^\[GRID:(morning|afternoon):(.+?)\]/i;function l(e,t,n){let r=function(e){let t=(e||"").trim();if(!t)return{};let n=t.match(o);return n?{turn:n[1],row:(n[2]||"").trim()}:{}}(e.description);return r.turn===t&&(r.row||"").toUpperCase()===n.toUpperCase()}function c(e){return new Date("".concat(e,"T00:00:00.000Z")).toLocaleDateString(void 0,{year:"numeric",month:"2-digit",day:"2-digit"})}function u(){let[e,t]=(0,a.useState)(()=>(0,s.$9)(new Date)),[n,o]=(0,a.useState)({}),[u,d]=(0,a.useState)(""),[m,h]=(0,a.useState)(""),[x,f]=(0,a.useState)(!0),[p,g]=(0,a.useState)("");async function y(e){f(!0);try{let t=(0,s.VA)((0,s.$9)(e)),n=await (0,s.tO)({start:t});o(n.days),d(n.weekStart),h(n.weekEnd)}catch(e){console.error(e),alert("No se pudieron cargar las sesiones.")}finally{f(!1)}}(0,a.useEffect)(()=>{y(e)},[e]);let w=(0,a.useMemo)(()=>{let e=[];if(!u)return e;for(let t of Array.from({length:7},(e,t)=>{let n=new Date("".concat(u,"T00:00:00.000Z"));return n.setUTCDate(n.getUTCDate()+t),(0,s.VA)(n)})){let r=n[t]||[];["morning","afternoon"].forEach(n=>{var a,s;let o=r.find(e=>l(e,n,i));if(!o)return;let c=((null===(a=r.find(e=>l(e,n,"LUGAR")))||void 0===a?void 0:a.title)||"").trim(),u=((null===(s=r.find(e=>l(e,n,"HORA")))||void 0===s?void 0:s.title)||"").trim();e.push({id:o.id,title:(o.title||"").trim()||"(Sin nombre)",ymd:t,turn:n,dateISO:o.date,lugar:c,hora:u})})}return e.sort((e,t)=>e.ymd!==t.ymd?e.ymd.localeCompare(t.ymd):e.turn!==t.turn?"morning"===e.turn?-1:1:0)},[n,u]),j=(0,a.useMemo)(()=>p?w.filter(e=>e.ymd===p):w,[w,p]);return(0,r.jsxs)("div",{className:"max-w-5xl mx-auto p-6 space-y-6",children:[(0,r.jsxs)("header",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"Sesiones"}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["Basadas en la fila “",i,"” del editor semanal."]}),(0,r.jsxs)("p",{className:"text-xs text-gray-400",children:["Semana ",u?c(u):"—"," →"," ",m?c(m):"—"," (Lun→Dom)"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("div",{className:"inline-flex rounded-xl border overflow-hidden",children:[(0,r.jsx)("button",{onClick:()=>t(e=>{let t=new Date(e);return t.setUTCDate(t.getUTCDate()-7),t}),className:"px-2.5 py-1.5 text-xs hover:bg-gray-50",title:"Semana anterior",children:"◀ Semana anterior"}),(0,r.jsx)("div",{className:"w-px bg-gray-200"}),(0,r.jsx)("button",{onClick:()=>t((0,s.$9)(new Date)),className:"px-2.5 py-1.5 text-xs hover:bg-gray-50",title:"Volver a esta semana",children:"Hoy"}),(0,r.jsx)("div",{className:"w-px bg-gray-200"}),(0,r.jsx)("button",{onClick:()=>t(e=>{let t=new Date(e);return t.setUTCDate(t.getUTCDate()+7),t}),className:"px-2.5 py-1.5 text-xs hover:bg-gray-50",title:"Semana siguiente ▶",children:"Semana siguiente ▶"})]}),(0,r.jsx)("input",{type:"date",value:p,onChange:e=>(function(e){if(g(e),!e)return;let n=new Date("".concat(e,"T00:00:00.000Z"));t((0,s.$9)(n))})(e.target.value),className:"rounded-xl border px-2 py-1.5 text-sm",title:"Filtrar por fecha"}),(0,r.jsx)("button",{onClick:()=>g(""),className:"text-sm px-3 py-1.5 rounded-xl border hover:bg-gray-50",disabled:!p,title:"Quitar filtro",children:"Limpiar"})]})]}),x?(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"Cargando sesiones…"}):0===j.length?(0,r.jsx)("div",{className:"rounded-lg border p-6 text-sm text-gray-600",children:"No hay sesiones para mostrar en esta semana/fecha."}):(0,r.jsx)("ul",{className:"space-y-3",children:j.map(e=>{let t="/ct/sessions/by-day/".concat(e.ymd,"/").concat(e.turn);return(0,r.jsxs)("li",{className:"rounded-xl border p-3 shadow-sm flex items-start justify-between bg-white",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-[15px]",children:(0,r.jsx)("a",{href:t,className:"hover:underline",title:"Abrir sesi\xf3n (d\xeda/turno)",children:e.title})}),(0,r.jsxs)("div",{className:"text-xs text-gray-500 mt-1 space-x-3",children:[(0,r.jsxs)("span",{children:["\uD83D\uDCC5 ",new Date(e.dateISO).toLocaleString()]}),(0,r.jsxs)("span",{children:["\uD83D\uDD51 ","morning"===e.turn?"Ma\xf1ana":"Tarde"]}),e.hora&&(0,r.jsxs)("span",{children:["⏰ ",e.hora]}),e.lugar&&(0,r.jsxs)("span",{children:["\uD83D\uDCCD ",e.lugar]})]})]}),(0,r.jsx)("a",{href:t,className:"text-xs px-3 py-1.5 rounded-lg border hover:bg-gray-50",title:"Ver sesi\xf3n (d\xeda/turno)",children:"Ver sesi\xf3n"})]},e.id)})})]})}},1673:function(e,t,n){"use strict";function r(e){let t=e.getUTCFullYear(),n=String(e.getUTCMonth()+1).padStart(2,"0"),r=String(e.getUTCDate()).padStart(2,"0");return"".concat(t,"-").concat(n,"-").concat(r)}function a(e){let t=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())),n=t.getUTCDay()||7;return 1!==n&&t.setUTCDate(t.getUTCDate()-(n-1)),t.setUTCHours(0,0,0,0),t}async function s(e){let{start:t}=e,n=await fetch("/api/sessions?start=".concat(encodeURIComponent(t)),{cache:"no-store"}),r=await n.json();if(!n.ok)throw Error((null==r?void 0:r.error)||"No se pudo cargar la semana");return r}async function i(e){let t=await fetch("/api/sessions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),n=await t.json();if(!t.ok)throw Error((null==n?void 0:n.error)||"Error al crear la sesi\xf3n");return n}async function o(e,t){let n=await fetch("/api/sessions/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await n.json();if(!n.ok)throw Error((null==r?void 0:r.error)||"Error al actualizar la sesi\xf3n");return r}async function l(e){let t=await fetch("/api/sessions/".concat(e),{method:"DELETE"}),n=await t.json();if(!t.ok)throw Error((null==n?void 0:n.error)||"Error al borrar la sesi\xf3n");return n}async function c(e){let t=await fetch("/api/sessions/".concat(e),{cache:"no-store"}),n=await t.json();if(!t.ok)throw Error((null==n?void 0:n.error)||"Sesi\xf3n no encontrada");return n}n.d(t,{$9:function(){return a},CT:function(){return o},SO:function(){return l},VA:function(){return r},ed:function(){return i},tO:function(){return s},y4:function(){return c}})}},function(e){e.O(0,[2971,7023,1744],function(){return e(e.s=9540)}),_N_E=e.O()}]);