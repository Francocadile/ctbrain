(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[383],{3847:function(e,t,a){Promise.resolve().then(a.bind(a,6637))},6637:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return p}});var n=a(7437),r=a(8059),c=a.n(r),i=a(2265),s=a(6463),o=a(1673),l=a(6344);let d="[EXERCISES]";async function u(e){try{let t=await fetch("/api/exercises/import?sessionId=".concat(encodeURIComponent(e)),{method:"POST"});if(!t.ok)return{ok:!1,created:0,updated:0};return await t.json()}catch(e){return{ok:!1,created:0,updated:0}}}function p(){let{id:e}=(0,s.useParams)(),[t,a]=(0,i.useState)(!0),[r,p]=(0,i.useState)(!1),[x,m]=(0,i.useState)(!0),[h,f]=(0,i.useState)(null),[y,g]=(0,i.useState)(""),[j,v]=(0,i.useState)([]),[b,N]=(0,i.useState)([]);(0,i.useEffect)(()=>{(async()=>N(await (0,l.H$)()))()},[]),(0,i.useEffect)(()=>{(async function(){if(e){a(!0);try{let t=await (0,o.y4)(e),a=(null==t?void 0:t.data)?t.data:t;f(a);let n=function(e){let t=(e||"").trimEnd(),a=t.lastIndexOf(d);if(-1===a)return{prefix:t,exercises:[]};let n=t.slice(0,a).trimEnd(),r=t.slice(a+d.length).trim().split(/\s+/)[0]||"";try{let e=function(e){try{let t=decodeURIComponent(escape(atob(e)));return JSON.parse(t)}catch(t){return JSON.parse(atob(e))}}(r);if(Array.isArray(e)){let t=e.map(e=>{var t,a,n,r,c,i,s;return{title:null!==(t=e.title)&&void 0!==t?t:"",kind:null!==(a=e.kind)&&void 0!==a?a:"",space:null!==(n=e.space)&&void 0!==n?n:"",players:null!==(r=e.players)&&void 0!==r?r:"",duration:null!==(c=e.duration)&&void 0!==c?c:"",description:null!==(i=e.description)&&void 0!==i?i:"",imageUrl:null!==(s=e.imageUrl)&&void 0!==s?s:""}});return{prefix:n,exercises:t}}}catch(e){}return{prefix:t,exercises:[]}}((null==a?void 0:a.description)||"");g(n.prefix),v(n.exercises.length?n.exercises:[{title:"",kind:"",space:"",players:"",duration:"",description:"",imageUrl:""}]),m(!0)}catch(e){console.error(e),f(null)}finally{a(!1)}}})()},[e]);let w=(0,i.useMemo)(()=>(function(e){let t=(e||"").trimStart().match(/^\[GRID:(morning|afternoon):(.+?)\]\s*\|\s*(\d{4}-\d{2}-\d{2})/i);return{turn:(null==t?void 0:t[1])||"",row:(null==t?void 0:t[2])||"",ymd:(null==t?void 0:t[3])||""}})("string"==typeof(null==h?void 0:h.description)?null==h?void 0:h.description:""),[null==h?void 0:h.description]);function S(e,t){v(a=>{let n=[...a];return n[e]={...n[e],...t},n})}async function C(){if(h){p(!0);try{var e;let t=function(e,t){let a=function(e){let t=JSON.stringify(e);try{return btoa(unescape(encodeURIComponent(t)))}catch(e){return btoa(t)}}(t),n=(e||"").trimEnd();return"".concat(n,"\n\n").concat(d," ").concat(a)}(y||h.description||"",j);await (0,o.CT)(h.id,{title:null!==(e=h.title)&&void 0!==e?e:"",description:t,date:h.date}),u(h.id).catch(()=>{}),m(!1),alert("Guardado")}catch(e){console.error(e),alert((null==e?void 0:e.message)||"No se pudo guardar")}finally{p(!1)}}}if(t)return(0,n.jsx)("div",{className:"p-6 text-gray-500",children:"Cargando…"});if(!h)return(0,n.jsx)("div",{className:"p-6",children:(0,n.jsx)("h1",{className:"text-xl font-semibold",children:"Sesi\xf3n no encontrada"})});let U=x?"":"bg-gray-50 text-gray-600 cursor-not-allowed";return(0,n.jsxs)("div",{id:"print-root",className:"jsx-54a3523ecaedcc0 p-4 md:p-6 space-y-4 print:!p-2",children:[(0,n.jsxs)("header",{className:"jsx-54a3523ecaedcc0 flex flex-col gap-2 md:flex-row md:items-center md:justify-between print:hidden",children:[(0,n.jsxs)("div",{className:"jsx-54a3523ecaedcc0",children:[(0,n.jsxs)("h1",{className:"jsx-54a3523ecaedcc0 text-lg md:text-xl font-bold",children:["Editor de ejercicio(s) — ",w.row||"Bloque"," \xb7"," ","morning"===w.turn?"Ma\xf1ana":"afternoon"===w.turn?"Tarde":"—"]}),(0,n.jsxs)("p",{className:"jsx-54a3523ecaedcc0 text-xs md:text-sm text-gray-500",children:["D\xeda: ",w.ymd||"—"," \xb7 Tipo: ",h.type]})]}),(0,n.jsxs)("div",{className:"jsx-54a3523ecaedcc0 flex items-center gap-2",children:[w.ymd&&w.turn&&(0,n.jsx)("a",{href:"/ct/sessions/by-day/".concat(w.ymd,"/").concat(w.turn,"?focus=").concat(encodeURIComponent(w.row||"")),className:"jsx-54a3523ecaedcc0 px-3 py-1.5 rounded-xl border hover:bg-gray-50 text-xs",children:"← Volver a sesi\xf3n"}),(0,n.jsx)("a",{href:"/ct/dashboard",className:"jsx-54a3523ecaedcc0 px-3 py-1.5 rounded-xl border hover:bg-gray-50 text-xs",children:"Dashboard"}),(0,n.jsx)("a",{href:"/ct/plan-semanal",className:"jsx-54a3523ecaedcc0 px-3 py-1.5 rounded-xl border hover:bg-gray-50 text-xs",children:"✏️ Editor semanal"}),x?(0,n.jsx)("button",{onClick:C,disabled:r,className:"jsx-54a3523ecaedcc0 "+"px-3 py-1.5 rounded-xl text-xs ".concat(r?"bg-gray-200 text-gray-500":"bg-black text-white hover:opacity-90"),children:r?"Guardando…":"Guardar y bloquear"}):(0,n.jsx)("button",{onClick:()=>m(!0),className:"jsx-54a3523ecaedcc0 px-3 py-1.5 rounded-xl border text-xs hover:bg-gray-50",children:"✏️ Editar"}),(0,n.jsx)("button",{onClick:()=>window.print(),title:"Imprimir",className:"jsx-54a3523ecaedcc0 px-3 py-1.5 rounded-xl border text-xs hover:bg-gray-50",children:"\uD83D\uDDA8️ Imprimir"})]})]}),(0,n.jsxs)("div",{className:"jsx-54a3523ecaedcc0 space-y-4",children:[j.map((e,t)=>(0,n.jsxs)("section",{id:"ex-".concat(t),className:"jsx-54a3523ecaedcc0 rounded-2xl border bg-white shadow-sm overflow-hidden print:page",children:[(0,n.jsxs)("div",{className:"jsx-54a3523ecaedcc0 flex items-center justify-between bg-gray-50 px-3 py-2 border-b",children:[(0,n.jsx)("input",{placeholder:"EJERCICIO #".concat(t+1," — T\xedtulo"),value:e.title,onChange:e=>S(t,{title:e.target.value}),disabled:!x,className:"jsx-54a3523ecaedcc0 "+"text-[12px] font-semibold uppercase tracking-wide w-full max-w-[360px] ".concat(U)}),x&&(0,n.jsx)("button",{type:"button",onClick:()=>{v(e=>e.filter((e,a)=>a!==t))},className:"jsx-54a3523ecaedcc0 ml-2 text-[11px] rounded-lg border px-2 py-0.5 hover:bg-gray-50",children:"Eliminar"})]}),(0,n.jsxs)("div",{className:"jsx-54a3523ecaedcc0 p-3 grid md:grid-cols-2 gap-3",children:[(0,n.jsxs)("div",{className:"jsx-54a3523ecaedcc0 space-y-2",children:[(0,n.jsx)("label",{className:"jsx-54a3523ecaedcc0 text-[11px] text-gray-500",children:"Tipo de ejercicio"}),(0,n.jsx)("div",{className:"jsx-54a3523ecaedcc0 flex items-center gap-1",children:(0,n.jsxs)("select",{value:e.kind||"",onChange:e=>{let a=e.target.value;if("__add__"===a){let e=function(){let e=prompt("Nuevo tipo de ejercicio:");if(!e)return;let t=e.trim();if(t)return(async()=>{N(await (0,l.hV)(t))})(),t}();e&&S(t,{kind:e});return}if("__manage__"===a){(async()=>{let e=prompt("Gestionar tipos (una l\xednea por opci\xf3n). Borr\xe1 para eliminar, edit\xe1 para renombrar:",b.join("\n"));if(null===e)return;let t=e.split("\n").map(e=>e.trim()).filter(Boolean);N(await (0,l.TL)(t))})();return}S(t,{kind:a})},disabled:!x,className:"jsx-54a3523ecaedcc0 "+"w-full rounded-md border px-2 py-1.5 text-sm ".concat(U),children:[(0,n.jsx)("option",{value:"",className:"jsx-54a3523ecaedcc0",children:"— Seleccionar —"}),b.map(e=>(0,n.jsx)("option",{value:e,className:"jsx-54a3523ecaedcc0",children:e},e)),(0,n.jsx)("option",{value:"__add__",className:"jsx-54a3523ecaedcc0",children:"➕ Agregar…"}),(0,n.jsx)("option",{value:"__manage__",className:"jsx-54a3523ecaedcc0",children:"⚙️ Gestionar…"})]})})]}),(0,n.jsxs)("div",{className:"jsx-54a3523ecaedcc0 space-y-2",children:[(0,n.jsx)("label",{className:"jsx-54a3523ecaedcc0 text-[11px] text-gray-500",children:"Espacio"}),(0,n.jsx)("input",{value:e.space,onChange:e=>S(t,{space:e.target.value}),placeholder:"Mitad de cancha",disabled:!x,className:"jsx-54a3523ecaedcc0 "+"w-full rounded-md border px-2 py-1.5 text-sm ".concat(U)})]}),(0,n.jsxs)("div",{className:"jsx-54a3523ecaedcc0 space-y-2",children:[(0,n.jsx)("label",{className:"jsx-54a3523ecaedcc0 text-[11px] text-gray-500",children:"N\xb0 de jugadores"}),(0,n.jsx)("input",{value:e.players,onChange:e=>S(t,{players:e.target.value}),placeholder:"22 jugadores",disabled:!x,className:"jsx-54a3523ecaedcc0 "+"w-full rounded-md border px-2 py-1.5 text-sm ".concat(U)})]}),(0,n.jsxs)("div",{className:"jsx-54a3523ecaedcc0 space-y-2",children:[(0,n.jsx)("label",{className:"jsx-54a3523ecaedcc0 text-[11px] text-gray-500",children:"Duraci\xf3n"}),(0,n.jsx)("input",{value:e.duration,onChange:e=>S(t,{duration:e.target.value}),placeholder:"10 minutos",disabled:!x,className:"jsx-54a3523ecaedcc0 "+"w-full rounded-md border px-2 py-1.5 text-sm ".concat(U)})]}),(0,n.jsxs)("div",{className:"jsx-54a3523ecaedcc0 space-y-2 md:col-span-2",children:[(0,n.jsx)("label",{className:"jsx-54a3523ecaedcc0 text-[11px] text-gray-500",children:"Descripci\xf3n"}),(0,n.jsx)("textarea",{value:e.description,onChange:e=>S(t,{description:e.target.value}),placeholder:"Consignas, series, repeticiones, variantes...",disabled:!x,className:"jsx-54a3523ecaedcc0 "+"w-full rounded-md border px-2 py-1.5 text-sm min-h-[120px] ".concat(U)})]}),(0,n.jsxs)("div",{className:"jsx-54a3523ecaedcc0 space-y-2 md:col-span-2",children:[(0,n.jsxs)("div",{className:"jsx-54a3523ecaedcc0 flex items-center justify-between",children:[(0,n.jsx)("label",{className:"jsx-54a3523ecaedcc0 text-[11px] text-gray-500",children:"Imagen (URL)"}),!x&&(0,n.jsx)("span",{className:"jsx-54a3523ecaedcc0 text-[10px] text-gray-400",children:"Bloqueado"})]}),(0,n.jsx)("input",{value:e.imageUrl,onChange:e=>S(t,{imageUrl:e.target.value}),placeholder:"https://...",disabled:!x,className:"jsx-54a3523ecaedcc0 "+"w-full rounded-md border px-2 py-1.5 text-sm ".concat(U)}),e.imageUrl?(0,n.jsx)("div",{className:"jsx-54a3523ecaedcc0 mt-2",children:(0,n.jsx)("img",{src:e.imageUrl,alt:"Vista previa",className:"jsx-54a3523ecaedcc0 max-h-80 rounded-lg border object-contain"})}):null]})]})]},t)),x&&(0,n.jsx)("div",{className:"jsx-54a3523ecaedcc0 print:hidden",children:(0,n.jsx)("button",{type:"button",onClick:function(){v(e=>[...e,{title:"",kind:"",space:"",players:"",duration:"",description:"",imageUrl:""}])},className:"jsx-54a3523ecaedcc0 rounded-xl border px-3 py-1.5 text-xs hover:bg-gray-50",children:"+ Agregar ejercicio"})})]}),(0,n.jsx)(c(),{id:"54a3523ecaedcc0",children:'@media print{@page{size:A4 portrait;margin:10mm}body{-webkit-print-color-adjust:exact;color-adjust:exact;print-color-adjust:exact}body *{visibility:hidden!important}#print-root,#print-root *{visibility:visible!important}#print-root{position:absolute;inset:0;margin:0!important;padding:0!important}nav,aside,header[role="banner"],.sidebar,.app-sidebar,.print\\\\:hidden{display:none!important}a[href]:after{content:""}.print\\\\:page{page-break-after:always}}'})]})}},1673:function(e,t,a){"use strict";function n(e){let t=e.getUTCFullYear(),a=String(e.getUTCMonth()+1).padStart(2,"0"),n=String(e.getUTCDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(n)}function r(e){let t=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())),a=t.getUTCDay()||7;return 1!==a&&t.setUTCDate(t.getUTCDate()-(a-1)),t.setUTCHours(0,0,0,0),t}async function c(e){let{start:t}=e,a=await fetch("/api/sessions?start=".concat(encodeURIComponent(t)),{cache:"no-store"}),n=await a.json();if(!a.ok)throw Error((null==n?void 0:n.error)||"No se pudo cargar la semana");return n}async function i(e){let t=await fetch("/api/sessions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await t.json();if(!t.ok)throw Error((null==a?void 0:a.error)||"Error al crear la sesi\xf3n");return a}async function s(e,t){let a=await fetch("/api/sessions/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=await a.json();if(!a.ok)throw Error((null==n?void 0:n.error)||"Error al actualizar la sesi\xf3n");return n}async function o(e){let t=await fetch("/api/sessions/".concat(e),{method:"DELETE"}),a=await t.json();if(!t.ok)throw Error((null==a?void 0:a.error)||"Error al borrar la sesi\xf3n");return a}async function l(e){let t=await fetch("/api/sessions/".concat(e),{cache:"no-store"}),a=await t.json();if(!t.ok)throw Error((null==a?void 0:a.error)||"Sesi\xf3n no encontrada");return a}a.d(t,{$9:function(){return r},CT:function(){return s},SO:function(){return o},VA:function(){return n},ed:function(){return i},tO:function(){return c},y4:function(){return l}})},6344:function(e,t,a){"use strict";a.d(t,{AA:function(){return u},H$:function(){return s},Om:function(){return p},TL:function(){return l},hV:function(){return o},oD:function(){return d}});let n="ct_exercise_kinds",r="ct_rivals",c=["Rueda de pases","Circuito t\xe9cnico","SSG","MSG","LSG"];async function i(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6e3;try{let n=window.location.origin,r=e.startsWith("http")?e:"".concat(n).concat(e),c=new AbortController,i=setTimeout(()=>c.abort(),a),s=await fetch(r,{...t,signal:c.signal,cache:"no-store"});if(clearTimeout(i),!s.ok)return null;return await s.json()}catch(e){return null}}async function s(){var e;let t=await i("/api/exercise-kinds");if(null==t?void 0:null===(e=t.data)||void 0===e?void 0:e.length){try{localStorage.setItem(n,JSON.stringify(t.data))}catch(e){}return t.data}try{let e=localStorage.getItem(n);if(e)return JSON.parse(e)}catch(e){}return c}async function o(e){var t;let a=(e||"").trim();if(!a)return s();let r=await i("/api/exercise-kinds",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a})});if(null==r?void 0:null===(t=r.data)||void 0===t?void 0:t.length){try{localStorage.setItem(n,JSON.stringify(r.data))}catch(e){}return r.data}let c=await s();c.includes(a)||c.push(a);try{localStorage.setItem(n,JSON.stringify(c))}catch(e){}return c}async function l(e){var t;let a=Array.from(new Set((e||[]).map(e=>e.trim()).filter(Boolean))),r=await i("/api/exercise-kinds",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({names:a})}),c=(null==r?void 0:null===(t=r.data)||void 0===t?void 0:t.length)?r.data:a;try{localStorage.setItem(n,JSON.stringify(c))}catch(e){}return c}async function d(){let e=await i("/api/ct/rivales");if(null==e?void 0:e.data){try{localStorage.setItem(r,JSON.stringify(e.data))}catch(e){}return e.data}try{let e=localStorage.getItem(r);if(e)return JSON.parse(e)}catch(e){}return[]}async function u(e){var t,a,n,c,s,o,l,u,p,x,m;let h={id:null!==(t=e.id)&&void 0!==t?t:null,name:e.name.trim(),logoUrl:null!==(a=e.logoUrl)&&void 0!==a?a:null,coach:null!==(n=e.coach)&&void 0!==n?n:null,baseSystem:null!==(c=e.baseSystem)&&void 0!==c?c:null,nextMatchDate:null!==(s=e.nextMatchDate)&&void 0!==s?s:null,nextMatchCompetition:null!==(o=e.nextMatchCompetition)&&void 0!==o?o:null},f=e.id?"/api/ct/rivales/".concat(encodeURIComponent(e.id)):"/api/ct/rivales",y=e.id?"PUT":"POST",g=await i(f,{method:y,headers:{"Content-Type":"application/json"},body:JSON.stringify(h)});if(null==g?void 0:g.data){let e=await d(),t=e.findIndex(e=>e.id===g.data.id);t>=0?e[t]=g.data:e.push(g.data);try{localStorage.setItem(r,JSON.stringify(e))}catch(e){}return g.data}let j=await d(),v=null!==(l=e.id)&&void 0!==l?l:"undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():"id_".concat(Date.now(),"_").concat(Math.random().toString(16).slice(2)),b={id:v,name:h.name,logoUrl:h.logoUrl,coach:null!==(u=h.coach)&&void 0!==u?u:null,baseSystem:null!==(p=h.baseSystem)&&void 0!==p?p:null,nextMatchDate:null!==(x=h.nextMatchDate)&&void 0!==x?x:null,nextMatchCompetition:null!==(m=h.nextMatchCompetition)&&void 0!==m?m:null},N=j.findIndex(e=>e.id===v);N>=0?j[N]=b:j.push(b);try{localStorage.setItem(r,JSON.stringify(j))}catch(e){}return b}async function p(e){let t=await i("/api/ct/rivales/".concat(encodeURIComponent(e)),{method:"DELETE"});if(null==t?void 0:t.ok){let t=(await d()).filter(t=>t.id!==e);try{localStorage.setItem(r,JSON.stringify(t))}catch(e){}return{ok:!0}}let a=(await d()).filter(t=>t.id!==e);try{localStorage.setItem(r,JSON.stringify(a))}catch(e){}return{ok:!0}}}},function(e){e.O(0,[8931,2971,7023,1744],function(){return e(e.s=3847)}),_N_E=e.O()}]);