(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8206],{5195:function(e,t,s){Promise.resolve().then(s.bind(s,8126))},8126:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return x}});var r=s(7437),a=s(2265);function l(e){return e.toISOString().slice(0,10)}function n(e,t){let s=new Date(e);return s.setDate(s.getDate()+t),s}function o(e){let t=new Date(e),s=t.getDay();return n(t,0===s?-6:1-s)}function c(e){return e<=1.5?"bg-red-50 text-red-700 border-red-200":e<=2.5?"bg-orange-50 text-orange-700 border-orange-200":e<=3.5?"bg-amber-50 text-amber-700 border-amber-200":e<=4.5?"bg-lime-50 text-lime-700 border-lime-200":"bg-emerald-50 text-emerald-700 border-emerald-200"}function d(e){let t=e/25;return t<.4?"bg-red-50 text-red-700 border-red-200":t<.6?"bg-orange-50 text-orange-700 border-orange-200":t<.8?"bg-amber-50 text-amber-700 border-amber-200":"bg-emerald-50 text-emerald-700 border-emerald-200"}function i(e){let{children:t,klass:s=""}=e;return(0,r.jsx)("span",{className:"inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-semibold ".concat(s),children:t})}function x(){let[e,t]=(0,a.useState)(()=>o(new Date)),[s,x]=(0,a.useState)(!1),[m,u]=(0,a.useState)([]),[h,p]=(0,a.useState)(""),g=(0,a.useMemo)(()=>Array.from({length:7},(t,s)=>l(n(e,s))),[e]);async function f(){x(!0);try{let s=g.map(e=>fetch("/api/metrics/wellness?date=".concat(e),{cache:"no-store"})),r=await Promise.all(s),a=[];for(let s of r){if(!s.ok)continue;let r=await s.json();if(Array.isArray(r))for(let s of r){var e,t;a.push({...s,userName:s.userName||(null===(e=s.user)||void 0===e?void 0:e.name)||(null===(t=s.user)||void 0===t?void 0:t.email)||s.playerKey||"—"})}}u(a)}finally{x(!1)}}(0,a.useEffect)(()=>{f()},[g.join(",")]);let b=(0,a.useMemo)(()=>{let e=new Map;for(let t of m){let s=t.userName||"—",r=e.get(s)||{c:0,sq:0,fa:0,ms:0,st:0,mo:0};e.set(s,{c:r.c+1,sq:r.sq+Number(t.sleepQuality||0),fa:r.fa+Number(t.fatigue||0),ms:r.ms+Number(t.muscleSoreness||0),st:r.st+Number(t.stress||0),mo:r.mo+Number(t.mood||0)})}let t=[];for(let[s,r]of e.entries()){if(0===r.c)continue;let e=r.sq/r.c,a=r.fa/r.c,l=r.ms/r.c,n=r.st/r.c,o=r.mo/r.c,c=e+a+l+n+o;t.push({userName:s,count:r.c,sleepQuality:e,fatigue:a,muscleSoreness:l,stress:n,mood:o,total:c})}return t.sort((e,t)=>e.total-t.total),t},[m]),j=(0,a.useMemo)(()=>{let e=h.trim().toLowerCase();return e?b.filter(t=>t.userName.toLowerCase().includes(e)):b},[b,h]),y=(0,a.useMemo)(()=>{if(!j.length)return{count:0,avgTotal:0};let e=j.reduce((e,t)=>e+t.total,0)/j.length;return{count:j.length,avgTotal:e}},[j]);function N(e){t(t=>n(t,7*e))}return(0,r.jsxs)("div",{className:"p-4 space-y-4",children:[(0,r.jsxs)("header",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-lg font-bold",children:"Wellness — Semana (CT)"}),(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:["Semana: ",(0,r.jsx)("b",{children:l(e)})," a ",(0,r.jsx)("b",{children:l(n(e,6))})," — ",m.length," registros"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("button",{onClick:()=>N(-1),className:"rounded-lg border px-2 py-1 text-sm hover:bg-gray-50",children:"← Semana anterior"}),(0,r.jsx)("input",{type:"date",className:"rounded-md border px-2 py-1.5 text-sm",value:l(e),onChange:e=>{t(o(new Date(e.target.value)))}}),(0,r.jsx)("button",{onClick:()=>N(1),className:"rounded-lg border px-2 py-1 text-sm hover:bg-gray-50",children:"Semana siguiente →"}),(0,r.jsx)("button",{onClick:f,className:"rounded-lg border px-2 py-1 text-sm hover:bg-gray-50",children:"Recargar"}),(0,r.jsx)("button",{onClick:function(){let t=[["Jugador","D\xedas con datos","Sue\xf1o(1-5)","Fatiga(1-5)","Dolor musc.(1-5)","Estr\xe9s(1-5)","\xc1nimo(1-5)","Total(0-25)","Semana (".concat(l(e)," a ").concat(l(n(e,6)),")")].join(",")];for(let e of j)t.push(['"'.concat(e.userName.replace(/"/g,'""'),'"'),e.count,e.sleepQuality.toFixed(2),e.fatigue.toFixed(2),e.muscleSoreness.toFixed(2),e.stress.toFixed(2),e.mood.toFixed(2),e.total.toFixed(2),""].join(","));let s=new Blob([t.join("\n")],{type:"text/csv;charset=utf-8"}),r=URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download="wellness_semana_".concat(l(e),".csv"),a.click(),URL.revokeObjectURL(r)},className:"rounded-lg bg-black text-white px-3 py-1.5 text-sm hover:opacity-90",children:"Exportar CSV"})]})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-white p-3 text-xs text-gray-600 flex flex-wrap gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("b",{children:"Promedio semanal (total):"})," ",(0,r.jsx)(i,{klass:d(y.avgTotal),children:y.count?y.avgTotal.toFixed(1):"—"})]}),(0,r.jsxs)("div",{className:"ml-auto text-gray-500",children:["Jugadores: ",(0,r.jsx)("b",{children:y.count})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{className:"w-full md:w-80 rounded-md border px-2 py-1.5 text-sm",placeholder:"Buscar jugador…",value:h,onChange:e=>p(e.target.value)}),(0,r.jsxs)("span",{className:"text-[12px] text-gray-500",children:[j.length," resultado(s)"]})]}),(0,r.jsxs)("section",{className:"rounded-2xl border bg-white overflow-hidden",children:[(0,r.jsx)("div",{className:"bg-gray-50 px-3 py-2 text-[12px] font-semibold uppercase",children:"Promedios por jugador"}),s?(0,r.jsx)("div",{className:"p-4 text-gray-500",children:"Cargando…"}):0===j.length?(0,r.jsx)("div",{className:"p-4 text-gray-500 italic",children:"Sin datos"}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full text-sm",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b bg-gray-50",children:[(0,r.jsx)("th",{className:"text-left px-3 py-2",children:"Jugador"}),(0,r.jsx)("th",{className:"text-left px-3 py-2",children:"D\xedas"}),(0,r.jsx)("th",{className:"text-left px-3 py-2",children:"Sue\xf1o"}),(0,r.jsx)("th",{className:"text-left px-3 py-2",children:"Fatiga"}),(0,r.jsx)("th",{className:"text-left px-3 py-2",children:"Dolor musc."}),(0,r.jsx)("th",{className:"text-left px-3 py-2",children:"Estr\xe9s"}),(0,r.jsx)("th",{className:"text-left px-3 py-2",children:"\xc1nimo"}),(0,r.jsx)("th",{className:"text-left px-3 py-2",children:"Total"})]})}),(0,r.jsx)("tbody",{children:j.map(e=>(0,r.jsxs)("tr",{className:"border-b last:border-0",children:[(0,r.jsx)("td",{className:"px-3 py-2 font-medium",children:e.userName}),(0,r.jsx)("td",{className:"px-3 py-2",children:e.count}),(0,r.jsx)("td",{className:"px-3 py-2",children:(0,r.jsx)(i,{klass:c(e.sleepQuality),children:e.sleepQuality.toFixed(1)})}),(0,r.jsx)("td",{className:"px-3 py-2",children:(0,r.jsx)(i,{klass:c(e.fatigue),children:e.fatigue.toFixed(1)})}),(0,r.jsx)("td",{className:"px-3 py-2",children:(0,r.jsx)(i,{klass:c(e.muscleSoreness),children:e.muscleSoreness.toFixed(1)})}),(0,r.jsx)("td",{className:"px-3 py-2",children:(0,r.jsx)(i,{klass:c(e.stress),children:e.stress.toFixed(1)})}),(0,r.jsx)("td",{className:"px-3 py-2",children:(0,r.jsx)(i,{klass:c(e.mood),children:e.mood.toFixed(1)})}),(0,r.jsx)("td",{className:"px-3 py-2",children:(0,r.jsx)(i,{klass:d(e.total),children:e.total.toFixed(1)})})]},e.userName))})]})})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-white p-3 text-xs text-gray-600",children:[(0,r.jsx)("b",{children:"Criterios r\xe1pidos:"})," totales < 15/25 o promedios < 3.0 suelen indicar alerta. Revisar fatiga/estr\xe9s y comparar con sesiones planificadas."]})]})}}},function(e){e.O(0,[2971,7023,1744],function(){return e(e.s=5195)}),_N_E=e.O()}]);