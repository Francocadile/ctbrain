(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[814],{4745:function(e,s,a){Promise.resolve().then(a.bind(a,6789))},6789:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return m},dynamic:function(){return d}});var t=a(7437),r=a(2265),l=a(6463),n=a(97),o=a(939),i=a(6163);let d="force-dynamic";function c(e){let{children:s,tone:a}=e;return(0,t.jsx)("span",{className:"inline-flex rounded-md border px-2 py-0.5 text-xs font-semibold ".concat({green:"bg-emerald-50 text-emerald-700 border-emerald-200",yellow:"bg-amber-50 text-amber-700 border-amber-200",lime:"bg-lime-50 text-lime-700 border-lime-200",orange:"bg-orange-50 text-orange-700 border-orange-200",red:"bg-red-50 text-red-700 border-red-200",gray:"bg-gray-100 text-gray-600 border-gray-200"}[a]),children:s})}function u(e){let{vals:s}=e;if(!s.length)return(0,t.jsx)("span",{className:"text-gray-400",children:"—"});let a=Math.min(...s),r=Math.max(1e-6,Math.max(...s)-a);return(0,t.jsx)("div",{className:"flex items-end gap-0.5 h-6",children:s.map((e,s)=>(0,t.jsx)("div",{className:"w-1.5 bg-gray-400/60 rounded-sm",style:{height:"".concat(6+Math.round((e-a)/r*16),"px")}},s))})}function x(){let e=(0,l.useSearchParams)().get("tab")||"respuestas",[s,a]=(0,r.useState)(e),[d,x]=(0,r.useState)((0,i.Op)(new Date)),[m,p]=(0,r.useState)([]),[h,j]=(0,r.useState)(!0),[y,v]=(0,r.useState)(""),[g,f]=(0,r.useState)([]),[N,b]=(0,r.useState)({}),[w,_]=(0,r.useState)({}),[S,k]=(0,r.useState)({}),[C,E]=(0,r.useState)({}),[R,O]=(0,r.useState)(7),[A,D]=(0,r.useState)(!1),[Z,M]=(0,r.useState)([]),[L,P]=(0,r.useState)([]),[F,I]=(0,r.useState)([0,0,0,0]),[U,W]=(0,r.useState)(!1),[z,H]=(0,r.useState)(null),[J,K]=(0,r.useState)(!1),[q,B]=(0,r.useState)([]),[T,V]=(0,r.useState)([]),Q=o.Z;async function G(e){let s=await fetch("/api/metrics/wellness?date=".concat(e),{cache:"no-store"});if(!s.ok)return[];let a=await s.json();return Array.isArray(a)?a:[]}async function X(e){let s=await fetch("/api/metrics/rpe?date=".concat(e),{cache:"no-store"});if(!s.ok)return[];let a=await s.json();return Array.isArray(a)?a.map(e=>{var s,a,t,r,l,n,o;let i=null!==(o=null!==(n=null!==(t=e.load)&&void 0!==t?t:e.srpe)&&void 0!==n?n:Number(null!==(r=e.rpe)&&void 0!==r?r:0)*Number(null!==(l=e.duration)&&void 0!==l?l:0))&&void 0!==o?o:0;return{userName:e.userName||e.playerKey||(null===(s=e.user)||void 0===s?void 0:s.name)||(null===(a=e.user)||void 0===a?void 0:a.email)||"Jugador",srpe:Number(i)}}):[]}async function Y(e){let s=await fetch("/api/injuries?date=".concat(e),{cache:"no-store"});if(!s.ok)return{};let a=await s.json(),t={};for(let e of Array.isArray(a)?a:[]){var r,l;let s=e.userName||(null===(r=e.user)||void 0===r?void 0:r.name)||(null===(l=e.user)||void 0===l?void 0:l.email)||"—";t[s]={userId:e.userId,userName:s,status:e.status}}return t}async function $(){var e,s,a,t;j(!0);let r=(await G(d)).map(e=>{var s,a;let t=e.userName||(null===(s=e.user)||void 0===s?void 0:s.name)||(null===(a=e.user)||void 0===a?void 0:a.email)||e.playerKey||"—";return{...e,_userName:t,_sdw:(0,i.bq)(e)}}),l=await Y(d),n=Array.from({length:21},(e,s)=>(0,i.Op)((0,i.E4)((0,i.lN)(d),-(s+1)))),o=await Promise.all(n.map(e=>G(e))),c={},u={};for(let a=0;a<o.length;a++)for(let t of o[a]){let r=t.userName||(null===(e=t.user)||void 0===e?void 0:e.name)||(null===(s=t.user)||void 0===s?void 0:s.email)||t.playerKey||"—",l=(0,i.bq)(t);c[r]||(c[r]=[]),c[r].push(l),a<7&&(u[r]||(u[r]=[]),u[r].push(l))}let x={};for(let[e,s]of Object.entries(c)){let a=s.filter(e=>e>0);x[e]={mean:(0,i.J6)(a),sd:(0,i.D1)(a),n:a.length}}let m=await X((0,i.Cv)(d)),h={};for(let e of m)h[e.userName]=e.srpe||0;let y=r.map(e=>{let s=x[e._userName],a=s&&s.n>=7&&s.sd>0?(e._sdw-s.mean)/s.sd:null,t=(0,i.HW)(a),r=(0,i.RW)(t,e);return{...e,_z:a,_color:r,_base:s||{mean:0,sd:0,n:0}}}),v=[];for(let e of y){let s=e._base,r=e._z,l=e._color,n=[];(null!==(a=e.sleepHours)&&void 0!==a?a:null)!==null&&e.sleepHours<4&&n.push("Sue\xf1o <4h"),e.muscleSoreness<=2&&n.push("Dolor muscular ≤2"),e.stress<=2&&n.push("Estr\xe9s ≤2");let o=null!==(t=w[e._userName])&&void 0!==t?t:0;"red"===l?v.push({kind:"CRITICO",reason:null!==r&&r<-1&&s.n>=7?"SDW rojo (Z=".concat(r.toFixed(2),")"):n[0]?"Override: ".concat(n.join(", ")):"SDW rojo",userName:e._userName,priority:1}):"yellow"===l&&v.push({kind:"AMARILLO",reason:null!==r&&r<-.5&&s.n>=7?"Descenso leve (Z=".concat(r.toFixed(2),")"):n[0]?"Override leve: ".concat(n.join(", ")):"Atenci\xf3n",userName:e._userName,priority:5}),o>900&&"red"===l&&v.push({kind:"CRITICO",reason:"sRPE ayer ".concat(Math.round(o)," AU + SDW rojo"),userName:e._userName,priority:0})}v.sort((e,s)=>e.priority-s.priority),p(y),E(x),b(u),_(h),f(v),k(l),j(!1)}(0,r.useEffect)(()=>{$()},[d]),(0,r.useMemo)(()=>{let e=m.length,s=m.map(e=>Number(e._sdw||0)).filter(e=>e>0),a=s.length?(0,i.J6)(s):0,t=0,r=0,l=0,n=[];for(let e of m){let s=e._color;"red"===s?t++:"yellow"===s?r++:l++,null!=e._z&&n.push(Number(e._z))}return{n:e,sdwAvg:a,reds:t,yellows:r,greens:l,zAvg:n.length?(0,i.J6)(n):null,dist:e?{red:Math.round(t/e*100),yellow:Math.round(r/e*100),green:Math.round(l/e*100)}:{red:0,yellow:0,green:0}}},[m]);let[ee,es]=(0,r.useState)([]);(0,r.useEffect)(()=>es(m),[m]);let ea=(0,r.useMemo)(()=>{let e=y.trim().toLowerCase();return e?ee.filter(s=>s._userName.toLowerCase().includes(e)||(s.comment||"").toLowerCase().includes(e)):ee},[ee,y]);async function et(e){H(e),W(!0),K(!0);try{var s,a;let t=[null!==(a=null===(s=m.find(s=>s._userName===e))||void 0===s?void 0:s._sdw)&&void 0!==a?a:0,...N[e]||[]];B(t);let r=Array.from({length:7},(e,s)=>(0,i.Op)((0,i.E4)((0,i.lN)(d),-s))),l=await Promise.all(r.map(e=>X(e))),n=[];for(let s=0;s<r.length;s++){let a=r[s];for(let t of l[s]||[])if(t.userName===e){n.push({date:a,au:t.srpe||0});break}}V(n)}finally{K(!1)}}return(0,r.useEffect)(()=>{"kpis"===s&&(async()=>{D(!0);try{let a=Array.from({length:R},(e,s)=>(0,i.Op)((0,i.E4)((0,i.lN)(d),-s))),t=await Promise.all(a.map(e=>G(e))),r=new Set;for(let a of t)for(let t of a){var e,s;let a=t.userName||(null===(e=t.user)||void 0===e?void 0:e.name)||(null===(s=t.user)||void 0===s?void 0:s.email)||t.playerKey||"—";r.add(a)}let l=r.size||1,n=t.map(e=>{let s=e.map(e=>(0,i.bq)(e)).filter(e=>e>0);return s.length?Number((0,i.J6)(s).toFixed(2)):0}),o=t.map(e=>Math.round((e.length||0)/l*100)),c=t.flatMap(e=>e.map(e=>(0,i.bq)(e)).filter(e=>e>0)),u=[0,0,0,0];for(let e of c)e<=2?u[0]++:e<=3?u[1]++:e<=4?u[2]++:u[3]++;M(n),P(o),I(u)}finally{D(!1)}})()},[d,R,s]),(0,t.jsxs)("div",{className:"p-4 space-y-4",children:[(0,t.jsxs)("header",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"text-lg font-bold",children:["Wellness — D\xeda (CT)"," ",(0,t.jsx)(n.Z,{text:"Vista operativa del d\xeda. Calcula SDW, compara vs baseline (21d) y aplica sem\xe1foro con overrides cl\xednicos."})]}),(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:[m.length," registros • Baseline: ventana 21 d\xedas previos (min 7 d\xedas v\xe1lidos)"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"date",className:"rounded-md border px-2 py-1.5 text-sm",value:d,onChange:e=>x(e.target.value)}),(0,t.jsx)("button",{onClick:$,className:"rounded-lg border px-2 py-1 text-sm hover:bg-gray-50",children:"Recargar"}),(0,t.jsx)("button",{onClick:function(){let e=["Jugador,Fecha,Sue\xf1o_calidad,Horas_sue\xf1o,Fatiga,Dolor_muscular,Estr\xe9s,\xc1nimo,Total_diario,Comentario,Color,Semana_ISO"];for(let a of ea){var s;let t=a.date,r=a._color;e.push(['"'.concat(a._userName.replace(/"/g,'""'),'"'),a.date,a.sleepQuality,null!==(s=a.sleepHours)&&void 0!==s?s:"",a.fatigue,a.muscleSoreness,a.stress,a.mood,a._sdw.toFixed(2),'"'.concat((a.comment||"").replace(/"/g,'""'),'"'),r.toUpperCase(),t].join(","))}let a=new Blob([e.join("\n")],{type:"text/csv;charset=utf-8"}),t=URL.createObjectURL(a),r=document.createElement("a");r.href=t,r.download="wellness_dia_".concat(d,".csv"),r.click(),URL.revokeObjectURL(t)},className:"rounded-lg bg-black text-white px-3 py-1.5 text-sm hover:opacity-90",children:"Exportar CSV"})]})]}),(0,t.jsx)("nav",{className:"rounded-xl border bg-white p-1 flex gap-1",children:[{key:"respuestas",label:"Respuestas"},{key:"kpis",label:"KPIs"},{key:"reportes",label:"Reportes"}].map(e=>{let r=s===e.key;return(0,t.jsx)("button",{onClick:()=>(function(e){a(e);let s=new URL(window.location.href);s.searchParams.set("tab",e),window.history.replaceState(null,"",s.toString())})(e.key),className:"flex-1 rounded-lg px-3 py-2 text-sm font-medium transition ".concat(r?"bg-black text-white":"hover:bg-gray-50"),children:e.label},e.key)})}),"respuestas"===s&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("section",{className:"rounded-xl border bg-white p-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"text-[12px] font-semibold uppercase",children:["Alertas ",(0,t.jsx)(n.Z,{text:"Ordenadas por severidad. Rojo: atender hoy; Amarillo: monitoreo/ajuste leve."})]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:[g.length," alerta(s)"]})]}),h?(0,t.jsx)("div",{className:"p-2 text-gray-500",children:"Cargando…"}):0===g.length?(0,t.jsx)("div",{className:"p-2 text-gray-500 italic",children:"Sin alertas"}):(0,t.jsx)("ul",{className:"mt-2 space-y-1",children:g.map((e,s)=>(0,t.jsxs)("li",{className:"flex items-center justify-between rounded-lg border px-2 py-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:["CRITICO"===e.kind?(0,t.jsx)(c,{tone:"red",children:"Rojo"}):(0,t.jsx)(c,{tone:"orange",children:"Amarillo"}),(0,t.jsx)("span",{className:"font-medium",children:e.userName}),(0,t.jsxs)("span",{className:"text-sm text-gray-700",children:["— ",e.reason]})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)("button",{onClick:()=>et(e.userName),className:"rounded-md border px-2 py-0.5 text-xs hover:bg-gray-50",children:"Ver"})})]},s))})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{className:"w-full md:w-80 rounded-md border px-2 py-1.5 text-sm",placeholder:"Buscar por jugador o comentario…",value:y,onChange:e=>v(e.target.value)}),(0,t.jsxs)("span",{className:"text-[12px] text-gray-500",children:[ea.length," resultado(s)"]})]}),(0,t.jsxs)("section",{className:"rounded-2xl border bg-white overflow-hidden",children:[(0,t.jsx)("div",{className:"bg-gray-50 px-3 py-2 text-[12px] font-semibold uppercase",children:"Entradas (d\xeda)"}),h?(0,t.jsx)("div",{className:"p-4 text-gray-500",children:"Cargando…"}):0===ea.length?(0,t.jsx)("div",{className:"p-4 text-gray-500 italic",children:"Sin datos"}):(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"min-w-full text-sm",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"border-b bg-gray-50",children:[(0,t.jsx)("th",{className:"text-left px-3 py-2",children:"Jugador"}),(0,t.jsxs)("th",{className:"text-left px-3 py-2",children:["SDW (1–5) ",(0,t.jsx)(n.Z,{text:"Promedio de los 5 \xedtems (1–5); 5=mejor. Base para Z y color."})]}),(0,t.jsxs)("th",{className:"text-left px-3 py-2",children:["Baseline (μ\xb1σ) ",(0,t.jsx)(n.Z,{text:"Media y desv\xedo de SDW en 21 d\xedas v\xe1lidos. Requiere ≥7 d\xedas para Z."})]}),(0,t.jsxs)("th",{className:"text-left px-3 py-2",children:["Z ",(0,t.jsx)(n.Z,{text:"(SDW_hoy − μ_baseline)/σ_baseline. Verde ≥ −0.5; Amarillo [−1.0, −0.5); Rojo < −1.0."})]}),(0,t.jsxs)("th",{className:"text-left px-3 py-2",children:["Color ",(0,t.jsx)(n.Z,{text:"Sem\xe1foro por Z con overrides: Sue\xf1o <4h ⇒ ≥ amarillo; Dolor ≤2 ⇒ rojo; Estr\xe9s ≤2 ⇒ ≥ amarillo."})]}),(0,t.jsxs)("th",{className:"text-left px-3 py-2",children:["Sue\xf1o (h) ",(0,t.jsx)(n.Z,{text:"Horas de sue\xf1o reportadas. <4h eleva la severidad al menos a Amarillo."})]}),(0,t.jsxs)("th",{className:"text-left px-3 py-2",children:["Peores \xedtems ",(0,t.jsx)(n.Z,{text:"Los dos \xedtems con menor puntaje del d\xeda: gu\xeda r\xe1pida para intervenci\xf3n."})]}),(0,t.jsxs)("th",{className:"text-left px-3 py-2",children:["sRPE ayer ",(0,t.jsx)(n.Z,{text:"Carga interna del d\xeda previo (RPE\xd7min). >900 AU + SDW rojo ⇒ alerta cr\xedtica."})]}),(0,t.jsxs)("th",{className:"text-left px-3 py-2",children:["Spark 7d ",(0,t.jsx)(n.Z,{text:"Mini-tendencia de SDW (ayer → hace 7 d\xedas). M\xe1s alto = mejor."})]}),(0,t.jsxs)("th",{className:"text-left px-3 py-2",children:["Comentario ",(0,t.jsx)(n.Z,{text:"Texto libre del jugador para contexto cualitativo."})]}),(0,t.jsx)("th",{className:"text-right px-3 py-2",children:"Acciones"})]})}),(0,t.jsx)("tbody",{children:ea.slice().sort((e,s)=>{let a=e=>"red"===e?0:"yellow"===e?1:2,t=e._color,r=s._color;if(a(t)!==a(r))return a(t)-a(r);let l=e._z,n=s._z;return null!=l&&null!=n?l-n:0}).map(e=>{var s,a;let r=e._base,l=e._z,n=e._color,o=[{k:"Sue\xf1o",v:e.sleepQuality},{k:"Fatiga",v:e.fatigue},{k:"Dolor",v:e.muscleSoreness},{k:"Estr\xe9s",v:e.stress},{k:"\xc1nimo",v:e.mood}].sort((e,s)=>e.v-s.v).slice(0,2),i=(N[e._userName]||[]).slice().reverse(),d=null!==(s=w[e._userName])&&void 0!==s?s:null,x=S[e._userName]||null;return(0,t.jsxs)("tr",{className:"border-b last:border-0 align-top",children:[(0,t.jsxs)("td",{className:"px-3 py-2 font-medium",children:[e._userName," ",x&&(0,t.jsx)("span",{className:"ml-1",children:(0,t.jsx)(c,{tone:"gray",children:"LESIONADO"})})]}),(0,t.jsx)("td",{className:"px-3 py-2",children:e._sdw.toFixed(2)}),(0,t.jsx)("td",{className:"px-3 py-2 text-xs text-gray-700",children:r.n>=7?"".concat(r.mean.toFixed(2)," \xb1 ").concat(r.sd.toFixed(2)," (n=").concat(r.n,")"):(0,t.jsx)("span",{className:"text-gray-400",children:"insuficiente"})}),(0,t.jsx)("td",{className:"px-3 py-2",children:null!=l?l.toFixed(2):"—"}),(0,t.jsx)("td",{className:"px-3 py-2",children:(0,t.jsx)(c,{tone:n,children:n.toUpperCase()})}),(0,t.jsx)("td",{className:"px-3 py-2",children:null!==(a=e.sleepHours)&&void 0!==a?a:"—"}),(0,t.jsx)("td",{className:"px-3 py-2 text-xs",children:o.map(e=>(0,t.jsxs)("div",{children:[e.k,": ",(0,t.jsx)("b",{children:e.v})]},e.k))}),(0,t.jsx)("td",{className:"px-3 py-2",children:null!=d?"".concat(Math.round(d)," AU"):"—"}),(0,t.jsx)("td",{className:"px-3 py-2",children:(0,t.jsx)(u,{vals:i})}),(0,t.jsx)("td",{className:"px-3 py-2",children:(0,t.jsx)("span",{className:"text-gray-600",children:e.comment||"—"})}),(0,t.jsx)("td",{className:"px-3 py-2",children:(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)("button",{onClick:()=>et(e._userName),className:"rounded-md border px-2 py-1 text-xs hover:bg-gray-50",children:"Ver"})})})]},e.id)})})]})})]})]}),"kpis"===s&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("section",{className:"rounded-2xl border bg-white px-4 py-3",children:(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3"})}),(0,t.jsx)("section",{className:"rounded-2xl border bg-white px-4 py-3",children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)("div",{className:"text-[12px] font-semibold uppercase",children:["KPIs \xfaltimos"," ",(0,t.jsxs)("select",{className:"ml-1 border rounded-md px-1 py-0.5 text-xs",value:R,onChange:e=>O(Number(e.target.value)),children:[(0,t.jsx)("option",{value:7,children:"7"}),(0,t.jsx)("option",{value:14,children:"14"}),(0,t.jsx)("option",{value:21,children:"21"})]})," ","d\xedas",(0,t.jsx)(n.Z,{text:"Se calcula en cliente llamando al endpoint por d\xeda. 'Participaci\xf3n' usa el universo de jugadores que reportaron al menos una vez en el rango."})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{onClick:function(){let e=(0,i.Op)((0,i.E4)((0,i.lN)(d),-(R-1))),s=["Fecha,SDW_promedio_d\xeda,Participaci\xf3n_%"];for(let e=0;e<R;e++){var a,t;let r=(0,i.Op)((0,i.E4)((0,i.lN)(d),-e)),l=null!==(a=Z[e])&&void 0!==a?a:"",n=null!==(t=L[e])&&void 0!==t?t:"";s.push([r,l,n].join(","))}let r=new Blob([s.join("\n")],{type:"text/csv;charset=utf-8"}),l=URL.createObjectURL(r),n=document.createElement("a");n.href=l,n.download="wellness_kpis_".concat(e,"_a_").concat(d,".csv"),n.click(),URL.revokeObjectURL(l)},className:"rounded-lg border px-2 py-1 text-xs hover:bg-gray-50",children:"Exportar KPIs (rango)"}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:A?"Calculando…":"".concat(Z.length," d\xeda(s)")})]})]})})]}),(0,t.jsxs)("div",{className:"rounded-xl border bg-white p-3 text-xs text-gray-600",children:[(0,t.jsx)("b",{children:"Sem\xe1foro por Z:"})," verde ≥ −0.5, amarillo [−1.0, −0.5), rojo < −1.0. Overrides: Sue\xf1o <4h ⇒ ≥ amarillo; Dolor ≤2 ⇒ rojo; Estr\xe9s ≤2 ⇒ ≥ amarillo."]}),z&&(0,t.jsx)(Q,{open:U,onClose:()=>W(!1),loading:J,playerName:z,date:d,sdw7:q,rpeRecent:T,context:{injuriesToday:S}})]})}function m(){return(0,t.jsx)(r.Suspense,{fallback:(0,t.jsx)("div",{className:"p-4 text-gray-500",children:"Cargando…"}),children:(0,t.jsx)(x,{})})}}},function(e){e.O(0,[1337,2971,7023,1744],function(){return e(e.s=4745)}),_N_E=e.O()}]);