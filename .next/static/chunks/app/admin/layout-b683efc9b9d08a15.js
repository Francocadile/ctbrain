(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9091],{6908:function(e,t,n){Promise.resolve().then(n.t.bind(n,231,23)),Promise.resolve().then(n.bind(n,8516))},6463:function(e,t,n){"use strict";var a=n(1169);n.o(a,"useParams")&&n.d(t,{useParams:function(){return a.useParams}}),n.o(a,"usePathname")&&n.d(t,{usePathname:function(){return a.usePathname}}),n.o(a,"useRouter")&&n.d(t,{useRouter:function(){return a.useRouter}}),n.o(a,"useSearchParams")&&n.d(t,{useSearchParams:function(){return a.useSearchParams}})},8516:function(e,t,n){"use strict";n.d(t,{default:function(){return i}});var a=n(7437),r=n(2265),o=n(998),l=n(6463);function i(e){var t,n,i;let{className:u,label:s="Equipo"}=e,{data:d,status:c,update:m}=(0,o.useSession)(),v=(0,l.useRouter)(),f=(0,r.useMemo)(()=>{var e,t;return null!==(t=null==d?void 0:null===(e=d.user)||void 0===e?void 0:e.teamIds)&&void 0!==t?t:[]},[null==d?void 0:null===(t=d.user)||void 0===t?void 0:t.teamIds]),h=null!==(i=null==d?void 0:null===(n=d.user)||void 0===n?void 0:n.currentTeamId)&&void 0!==i?i:null,[p,x]=(0,r.useState)([]),[S,g]=(0,r.useState)(""),[y,b]=(0,r.useState)(!1),[P,j]=(0,r.useState)(!1),[w,E]=(0,r.useState)(null),N=f.length>0,k=(0,r.useMemo)(()=>N?[...f].sort().join("|"):"",[N,f]);if((0,r.useEffect)(()=>{if(!N){x([]),g("");return}let e=!1;return b(!0),E(null),fetch("/api/session/team",{cache:"no-store"}).then(async e=>{if(!e.ok){let t=await e.json().catch(()=>null);throw Error((null==t?void 0:t.error)||"Error ".concat(e.status))}return e.json()}).then(t=>{var n,a,r;if(e)return;let o=Array.isArray(null==t?void 0:t.teams)?t.teams.map(e=>{var t,n,a;return{id:String(null!==(t=null==e?void 0:e.id)&&void 0!==t?t:"").trim(),name:String(null!==(n=null==e?void 0:e.name)&&void 0!==n?n:"").trim()||String(null!==(a=null==e?void 0:e.id)&&void 0!==a?a:"").trim()}}).filter(e=>!!e.id):[],l=o.length>0?o:f.map(e=>({id:e,name:e}));x(l),g((null==t?void 0:t.currentTeamId)&&(null===(n=l.find(e=>e.id===t.currentTeamId))||void 0===n?void 0:n.id)||h&&(null===(a=l.find(e=>e.id===h))||void 0===a?void 0:a.id)||(null===(r=l[0])||void 0===r?void 0:r.id)||"")}).catch(()=>{e||(x(f.map(e=>({id:e,name:e}))),E("No se pudieron cargar los equipos."))}).finally(()=>{e||b(!1)}),()=>{e=!0}},[k,h,N,f]),(0,r.useEffect)(()=>{h&&g(h)},[h]),"loading"===c||!N)return null;let I="https:"===window.location.protocol?"; Secure":"";async function _(e){let t=e.target.value;if(t&&t!==S){g(t),j(!0),E(null);try{document.cookie="ctb_team=".concat(encodeURIComponent(t),"; path=/; max-age=").concat(2592e3,"; SameSite=Lax").concat(I);let e=await fetch("/api/session/team",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({teamId:t})});if(!e.ok){let t=await e.json().catch(()=>null);throw Error((null==t?void 0:t.error)||"Error ".concat(e.status))}await (null==m?void 0:m()),v.refresh()}catch(e){g(S),E((null==e?void 0:e.message)||"No se pudo cambiar de equipo.")}finally{j(!1)}}}let C=["flex flex-col gap-1 text-xs",u].filter(Boolean).join(" ");return 0===p.length?null:(0,a.jsxs)("div",{className:C,children:[(0,a.jsx)("label",{className:"text-[10px] font-semibold uppercase text-gray-500",children:s}),(0,a.jsx)("select",{value:S,onChange:_,disabled:y||P,className:"w-full rounded-md border px-2 py-1.5 text-sm disabled:opacity-60",children:p.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))}),w?(0,a.jsx)("span",{className:"text-[11px] text-red-600",children:w}):null]})}}},function(e){e.O(0,[231,998,2971,7023,1744],function(){return e(e.s=6908)}),_N_E=e.O()}]);