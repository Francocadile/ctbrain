"use strict";(()=>{var e={};e.id=2205,e.ids=[2205],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},34335:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>w,patchFetch:()=>y,requestAsyncStorage:()=>h,routeModule:()=>g,serverHooks:()=>N,staticGenerationAsyncStorage:()=>x});var s={};t.r(s),t.d(s,{GET:()=>c,POST:()=>l,dynamic:()=>d});var n=t(49303),a=t(88716),i=t(60670),u=t(87070),o=t(53524);let d="force-dynamic",m=new o.PrismaClient;function p(e){let r=new Date(`${e}T00:00:00.000Z`);if(Number.isNaN(r.getTime()))throw Error("Fecha inv\xe1lida");return r}async function c(e){try{let{searchParams:r}=new URL(e.url),t=r.get("date")||"",s=r.get("userId")||void 0,n=r.get("session")?Number(r.get("session")):void 0;if(t){let e=p(t),r=function(e){let r=new Date(e);return r.setUTCDate(r.getUTCDate()+1),r}(e),a=(await m.rPEEntry.findMany({where:{date:{gte:e,lt:r},...s?{userId:s}:{},...n?{session:n}:{}},include:{user:{select:{name:!0,email:!0}}},orderBy:[{date:"desc"},{session:"asc"}]})).map(e=>({...e,userName:e.user?.name??e.user?.email??"—"}));return u.NextResponse.json(a)}let a=(await m.rPEEntry.findMany({include:{user:{select:{name:!0,email:!0}}},orderBy:[{date:"desc"},{session:"asc"}],take:30})).map(e=>({...e,userName:e.user?.name??e.user?.email??"—"}));return u.NextResponse.json(a)}catch(e){return new u.NextResponse(e?.message||"Error",{status:500})}}async function l(e){try{let r=await e.json(),t=String(r?.userId||"").trim(),s=String(r?.date||"").trim(),n=Number.isInteger(r?.session)?Number(r.session):1;if(!t||!s)return new u.NextResponse("userId y date requeridos",{status:400});let a=p(s),i=function(e){let r=Math.round(Number(e??0));return Number.isFinite(r)?Math.max(0,Math.min(10,r)):0}(r?.rpe),o=r?.duration!=null?Math.max(0,Number(r.duration)):null,d=null!=o?i*o:null,c=await m.rPEEntry.upsert({where:{userId_date_session:{userId:t,date:a,session:n}},update:{rpe:i,duration:o,load:d},create:{userId:t,date:a,session:n,rpe:i,duration:o,load:d},include:{user:{select:{name:!0,email:!0}}}});return u.NextResponse.json({...c,userName:c.user?.name??c.user?.email??"—"})}catch(e){return new u.NextResponse(e?.message||"Error",{status:500})}}let g=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/metrics/rpe/route",pathname:"/api/metrics/rpe",filename:"route",bundlePath:"app/api/metrics/rpe/route"},resolvedPagePath:"/Users/Fran/ctbrain-14/src/app/api/metrics/rpe/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:x,serverHooks:N}=g,w="/api/metrics/rpe/route";function y(){return(0,i.patchFetch)({serverHooks:N,staticGenerationAsyncStorage:x})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[8948,5972],()=>t(34335));module.exports=s})();