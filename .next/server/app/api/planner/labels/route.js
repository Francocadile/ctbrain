"use strict";(()=>{var e={};e.id=6948,e.ids=[6948],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9993:(e,a,r)=>{r.r(a),r.d(a,{originalPathname:()=>h,patchFetch:()=>y,requestAsyncStorage:()=>m,routeModule:()=>w,serverHooks:()=>b,staticGenerationAsyncStorage:()=>f});var t={};r.r(t),r.d(t,{DELETE:()=>d,GET:()=>c,POST:()=>u});var n=r(49303),s=r(88716),i=r(60670),l=r(87070),o=r(13538);async function p(){let e=await o.Z.user.findFirst({select:{id:!0},orderBy:{createdAt:"asc"}});if(!e)throw Error("No hay usuarios en la base");return e.id}async function c(){let e=await p(),a=await o.Z.plannerPrefs.findUnique({where:{userId:e}}),r=await o.Z.place.findMany({select:{name:!0},orderBy:{name:"asc"}});return l.NextResponse.json({rowLabels:a?.rowLabels??null,places:r.map(e=>e.name)})}async function u(e){let a=await p(),r=await e.json().catch(()=>({}));await o.Z.$transaction(async e=>{if(r.rowLabels&&await e.plannerPrefs.upsert({where:{userId:a},update:{rowLabels:r.rowLabels},create:{userId:a,rowLabels:r.rowLabels}}),Array.isArray(r.places)){let a=Array.from(new Set((r.places||[]).map(e=>(e??"").trim()).filter(Boolean))),t=await e.place.findMany({select:{id:!0,name:!0}}),n=new Set(t.map(e=>e.name)),s=t.filter(e=>!a.includes(e.name)).map(e=>e.id);s.length&&await e.place.deleteMany({where:{id:{in:s}}});let i=a.filter(e=>!n.has(e)).map(e=>({name:e}));i.length&&await e.place.createMany({data:i,skipDuplicates:!0})}});let t=await o.Z.place.findMany({select:{name:!0},orderBy:{name:"asc"}});return l.NextResponse.json({ok:!0,places:t.map(e=>e.name)})}async function d(){let e=await p();return await o.Z.plannerPrefs.upsert({where:{userId:e},update:{rowLabels:{}},create:{userId:e,rowLabels:{}}}),l.NextResponse.json({ok:!0})}let w=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/planner/labels/route",pathname:"/api/planner/labels",filename:"route",bundlePath:"app/api/planner/labels/route"},resolvedPagePath:"/Users/Fran/ctbrain-14/src/app/api/planner/labels/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:b}=w,h="/api/planner/labels/route";function y(){return(0,i.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:f})}},13538:(e,a,r)=>{r.d(a,{Z:()=>s,_:()=>n});var t=r(53524);let n=globalThis.prisma??new t.PrismaClient({log:["error"]}),s=n}};var a=require("../../../../webpack-runtime.js");a.C(e);var r=e=>a(a.s=e),t=a.X(0,[8948,5972],()=>r(9993));module.exports=t})();