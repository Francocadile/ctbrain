"use strict";(()=>{var e={};e.id=5937,e.ids=[5937],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},41874:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>b,requestAsyncStorage:()=>f,routeModule:()=>h,serverHooks:()=>g,staticGenerationAsyncStorage:()=>T});var s={};r.r(s),r.d(s,{GET:()=>l,POST:()=>x});var a=r(49303),n=r(88716),i=r(60670),o=r(87070),u=r(20330),p=r(7410),m=r(13538);let d=p.z.object({teamId:p.z.string().min(1)});function c(){let e=process.env.NEXTAUTH_SECRET;if(!e)throw Error("NEXTAUTH_SECRET no configurado.");return e}async function l(e){let t=c(),r=await (0,u.getToken)({req:e,secret:t});if(!r?.sub)return o.NextResponse.json({error:"Unauthorized"},{status:401});let s=(await m.Z.userTeam.findMany({where:{userId:r.sub},include:{team:{select:{id:!0,name:!0}}},orderBy:[{team:{name:"asc"}}]})).map(e=>({id:e.teamId,name:e.team?.name??e.teamId}));return o.NextResponse.json({teams:s,currentTeamId:r.currentTeamId??null})}async function x(e){let t=c(),r=await (0,u.getToken)({req:e,secret:t});if(!r?.sub)return o.NextResponse.json({error:"Unauthorized"},{status:401});let s=await e.json().catch(()=>null),a=d.safeParse(s);if(!a.success)return o.NextResponse.json({error:"teamId inv\xe1lido"},{status:400});let{teamId:n}=a.data,i=await m.Z.userTeam.findFirst({where:{userId:r.sub,teamId:n},include:{team:{select:{id:!0,name:!0}}}});if(!i)return o.NextResponse.json({error:"Forbidden"},{status:403});let p=Array.from(new Set((await m.Z.userTeam.findMany({where:{userId:r.sub},select:{teamId:!0}})).map(e=>e.teamId))),l={...r,teamIds:p,currentTeamId:n};delete l.exp,delete l.iat,delete l.jti;let x=await (0,u.encode)({token:l,secret:t,maxAge:2592e3}),h=o.NextResponse.json({success:!0,currentTeamId:n,teamName:i.team?.name??n});return h.cookies.set("__Secure-next-auth.session-token",x,{httpOnly:!0,secure:!0,sameSite:"lax",path:"/",maxAge:2592e3}),h.cookies.set("ctb_team",n,{sameSite:"lax",path:"/",maxAge:2592e3}),h}let h=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/session/team/route",pathname:"/api/session/team",filename:"route",bundlePath:"app/api/session/team/route"},resolvedPagePath:"/Users/Fran/ctbrain-14/src/app/api/session/team/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:T,serverHooks:g}=h,w="/api/session/team/route";function b(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:T})}},13538:(e,t,r)=>{r.d(t,{Z:()=>n,_:()=>a});var s=r(53524);let a=globalThis.prisma??new s.PrismaClient({log:["error"]}),n=a}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,330,7410],()=>r(41874));module.exports=s})();