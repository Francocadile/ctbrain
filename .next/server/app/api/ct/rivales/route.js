"use strict";(()=>{var e={};e.id=228,e.ids=[228],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},92768:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>v,requestAsyncStorage:()=>g,routeModule:()=>h,serverHooks:()=>f,staticGenerationAsyncStorage:()=>y});var a={};r.r(a),r.d(a,{GET:()=>m,POST:()=>x,dynamic:()=>p});var n=r(49303),s=r(88716),i=r(60670),l=r(87070),o=r(53524),u=r(47339),c=r(73644);let p="force-dynamic",d=globalThis.__prisma__??new o.PrismaClient;async function m(e){try{let t=await (0,u.A)(e),r=(await d.rival.findMany((0,c.ee)(t,{orderBy:[{name:"asc"}]}))).map(e=>({id:e.id,name:e.name,logoUrl:e.logoUrl??null,coach:e.coach??null,baseSystem:e.baseSystem??null,nextMatchDate:e.nextMatchDate?e.nextMatchDate.toISOString():null,nextMatchCompetition:e.nextMatchCompetition??null}));return l.NextResponse.json({data:r})}catch(e){return new l.NextResponse(e?.message||"Error",{status:500})}}async function x(e){try{let t=await (0,u.A)(e),r=await e.json(),a=String(r?.name||"").trim();if(!a)return new l.NextResponse("name requerido",{status:400});let n=r?.logoUrl??null,s=r?.coach??null,i=r?.baseSystem??null,o=r?.nextMatchDate?new Date(r.nextMatchDate):null,c=r?.nextMatchCompetition??null,p=await d.rival.upsert({where:{teamId_name:{teamId:t,name:a}},update:{logoUrl:n,coach:s,baseSystem:i,nextMatchDate:o,nextMatchCompetition:c},create:{teamId:t,name:a,logoUrl:n,coach:s,baseSystem:i,nextMatchDate:o,nextMatchCompetition:c}}),m={id:p.id,name:p.name,logoUrl:p.logoUrl??null,coach:p.coach??null,baseSystem:p.baseSystem??null,nextMatchDate:p.nextMatchDate?p.nextMatchDate.toISOString():null,nextMatchCompetition:p.nextMatchCompetition??null};return l.NextResponse.json({data:m})}catch(e){return new l.NextResponse(e?.message||"Error",{status:500})}}let h=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/ct/rivales/route",pathname:"/api/ct/rivales",filename:"route",bundlePath:"app/api/ct/rivales/route"},resolvedPagePath:"/Users/Fran/ctbrain-14/src/app/api/ct/rivales/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:y,serverHooks:f}=h,w="/api/ct/rivales/route";function v(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:y})}},53797:(e,t)=>{t.Z=function(e){return{id:"credentials",name:"Credentials",type:"credentials",credentials:{},authorize:()=>null,options:e}}},38238:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ReflectAdapter",{enumerable:!0,get:function(){return r}});class r{static get(e,t,r){let a=Reflect.get(e,t,r);return"function"==typeof a?a.bind(e):a}static set(e,t,r,a){return Reflect.set(e,t,r,a)}static has(e,t){return Reflect.has(e,t)}static deleteProperty(e,t){return Reflect.deleteProperty(e,t)}}},95456:(e,t,r)=>{r.d(t,{L:()=>o});var a=r(53797),n=r(53524),s=r(42023),i=r.n(s);let l=new n.PrismaClient,o={session:{strategy:"jwt"},providers:[(0,a.Z)({name:"credentials",credentials:{email:{label:"Email",type:"text"},password:{label:"Password",type:"password"}},async authorize(e){let t=(e?.email||"").trim().toLowerCase(),r=(e?.password||"").toString();if(!t)return null;let a=await l.user.findUnique({where:{email:t},select:{id:!0,email:!0,name:!0,role:!0,isApproved:!0,passwordHash:!0}});if(!a||!a.passwordHash||!await i().compare(r,a.passwordHash))return null;let n=(await l.userTeam.findMany({where:{userId:a.id},select:{teamId:!0}})).map(e=>e.teamId),s=n.length>0?n[0]:null;return{id:a.id,email:a.email,name:a.name??a.email,role:a.role,isApproved:a.isApproved,teamIds:n,currentTeamId:s}}})],pages:{signIn:"/login"},callbacks:{async jwt({token:e,user:t}){if(t){let{role:r,isApproved:a,teamIds:n=[],currentTeamId:s=null}=t;e.role=r,e.isApproved=a,e.teamIds=n,e.currentTeamId=s??(n.length>0?n[0]:null)}else e.teamIds=e.teamIds??[],e.currentTeamId=e.currentTeamId??null;return e},async session({session:e,token:t}){e.user=e.user||{},e.user.id=t.sub,e.user.role=t.role,e.user.isApproved=t.isApproved??null;let r=Array.isArray(t.teamIds)?t.teamIds:[];return e.user.teamIds=r,e.user.currentTeamId=t.currentTeamId??null,e}}}},73644:(e,t,r)=>{function a(e,t){return{...t??{},teamId:e}}function n(e,t={}){return{...t,where:a(e,t?.where)}}function s(e,t){return{...t,data:{...t.data,teamId:e}}}r.d(t,{ED:()=>a,ee:()=>n,x9:()=>s})},47339:(e,t,r)=>{r.d(t,{A:()=>s});var a=r(75571),n=r(95456);async function s(e){let t=e.headers.get("x-team")?.trim();if(t)return t;let r=function(e){let t=e?.user?.currentTeamId;return"string"==typeof t&&t.trim().length>0?t:null}(await (0,a.getServerSession)(n.L));if(r)return r;let s=Error("Team selection required");throw s.status=428,s}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,5972,330,2023,5571],()=>r(92768));module.exports=a})();