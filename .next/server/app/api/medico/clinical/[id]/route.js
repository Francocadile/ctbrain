"use strict";(()=>{var e={};e.id=381,e.ids=[381],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},77369:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>R,patchFetch:()=>N,requestAsyncStorage:()=>C,routeModule:()=>D,serverHooks:()=>h,staticGenerationAsyncStorage:()=>S});var i={};o.r(i),o.d(i,{DELETE:()=>f,GET:()=>x,PATCH:()=>g,dynamic:()=>c,revalidate:()=>p,runtime:()=>u});var r=o(49303),s=o(88716),n=o(60670),a=o(87070),l=o(13538),d=o(20330);let u="nodejs",c="force-dynamic",p=0;function v(e){let t=new Date(e);return t.setHours(0,0,0,0),t.toISOString().slice(0,10)}function m(e){if(!e)return null;let t=/^(\d{4})-(\d{2})-(\d{2})$/.exec(e);if(!t)return null;let[o,i,r,s]=t,n=new Date(Number(i),Number(r)-1,Number(s));return isNaN(n.getTime())?null:n}let y=e=>Object.fromEntries(Object.entries(e).filter(([,e])=>void 0!==e));async function x(e,t){let o=await (0,d.getToken)({req:e,secret:process.env.NEXTAUTH_SECRET}),i=o?.role;if(!o||!["MEDICO","CT","ADMIN"].includes(i??""))return a.NextResponse.json({error:"Unauthorized"},{status:401});let r=t.params.id,s=await l._.clinicalEntry.findUnique({where:{id:r},include:{user:{select:{name:!0,email:!0}}}});return s?a.NextResponse.json({id:s.id,userId:s.userId,userName:s.user?.name||s.user?.email||"â€”",date:v(s.date),status:s.status,leaveStage:s.leaveStage,leaveKind:s.leaveKind,diagnosis:s.diagnosis,bodyPart:s.bodyPart,laterality:s.laterality,mechanism:s.mechanism,severity:s.severity,illSystem:s.illSystem,illSymptoms:s.illSymptoms,illContagious:s.illContagious,illIsolationDays:s.illIsolationDays,illAptitude:s.illAptitude,feverMax:s.feverMax,startDate:s.startDate?v(s.startDate):null,daysMin:s.daysMin??null,daysMax:s.daysMax??null,expectedReturn:s.expectedReturn?v(s.expectedReturn):null,expectedReturnManual:s.expectedReturnManual,capMinutes:s.capMinutes,noSprint:s.noSprint,noChangeOfDirection:s.noChangeOfDirection,gymOnly:s.gymOnly,noContact:s.noContact,notes:s.notes,medSignature:s.medSignature,protocolObjectives:s.protocolObjectives,protocolTasks:s.protocolTasks,protocolControls:s.protocolControls,protocolCriteria:s.protocolCriteria,createdAt:s.createdAt,updatedAt:s.updatedAt}):a.NextResponse.json({error:"Not found"},{status:404})}async function g(e,t){let o=await (0,d.getToken)({req:e,secret:process.env.NEXTAUTH_SECRET}),i=o?.role;if(!o||!["MEDICO","ADMIN"].includes(i??""))return a.NextResponse.json({error:"Unauthorized"},{status:401});let r=t.params.id,s=await e.json().catch(()=>({})),n=void 0===s.expectedReturn?void 0:m(s.expectedReturn)??(s.expectedReturn?new Date(s.expectedReturn):null),u=s.expectedReturnManual;if(void 0===n){let e=void 0===s.startDate?void 0:m(s.startDate)??(s.startDate?new Date(s.startDate):null),t="number"==typeof s.daysEstimated?s.daysEstimated:"number"==typeof s.daysMax?s.daysMax:null;if(e&&Number.isInteger(t)){let o=new Date(e);o.setDate(o.getDate()+Number(t)),n=o,void 0===u&&(u=!1)}}let c=y({status:void 0===s.status?void 0:{set:s.status},leaveStage:void 0===s.leaveStage?void 0:{set:s.leaveStage??null},leaveKind:void 0===s.leaveKind?void 0:{set:s.leaveKind??null},diagnosis:void 0===s.diagnosis?void 0:{set:s.diagnosis??null},bodyPart:void 0===s.bodyPart?void 0:{set:s.bodyPart??null},laterality:void 0===s.laterality?void 0:{set:s.laterality??null},mechanism:void 0===s.mechanism?void 0:{set:s.mechanism??null},severity:void 0===s.severity?void 0:{set:s.severity??null},illSystem:void 0===s.illSystem?void 0:{set:s.illSystem??null},illSymptoms:void 0===s.illSymptoms?void 0:{set:s.illSymptoms??null},illContagious:void 0===s.illContagious?void 0:{set:s.illContagious??null},illIsolationDays:void 0===s.illIsolationDays?void 0:{set:s.illIsolationDays??null},illAptitude:void 0===s.illAptitude?void 0:{set:s.illAptitude??null},feverMax:void 0===s.feverMax?void 0:{set:s.feverMax??null},startDate:void 0===s.startDate?void 0:{set:m(s.startDate)??(s.startDate?new Date(s.startDate):null)},expectedReturn:void 0===n?void 0:{set:n},expectedReturnManual:void 0===u?void 0:{set:u},capMinutes:void 0===s.capMinutes?void 0:{set:s.capMinutes??null},noSprint:void 0===s.noSprint?void 0:{set:!!s.noSprint},noChangeOfDirection:void 0===s.noChangeOfDirection?void 0:{set:!!s.noChangeOfDirection},gymOnly:void 0===s.gymOnly?void 0:{set:!!s.gymOnly},noContact:void 0===s.noContact?void 0:{set:!!s.noContact},notes:void 0===s.notes?void 0:{set:s.notes??null},medSignature:void 0===s.medSignature?void 0:{set:s.medSignature??null},protocolObjectives:void 0===s.protocolObjectives?void 0:{set:s.protocolObjectives??null},protocolTasks:void 0===s.protocolTasks?void 0:{set:s.protocolTasks??null},protocolControls:void 0===s.protocolControls?void 0:{set:s.protocolControls??null},protocolCriteria:void 0===s.protocolCriteria?void 0:{set:s.protocolCriteria??null}});try{let e=await l._.clinicalEntry.update({where:{id:r},data:c,select:{id:!0,date:!0,status:!0}});return a.NextResponse.json({ok:!0,id:e.id,date:v(e.date),status:e.status},{status:200})}catch(e){if(e?.code==="P2025")return a.NextResponse.json({error:"Not found"},{status:404});return console.error("PATCH /api/medico/clinical/[id] error:",e),a.NextResponse.json({error:"Update error"},{status:500})}}async function f(e,t){let o=await (0,d.getToken)({req:e,secret:process.env.NEXTAUTH_SECRET}),i=o?.role;if(!o||!["ADMIN"].includes(i??""))return a.NextResponse.json({error:"Forbidden"},{status:403});try{return await l._.clinicalEntry.delete({where:{id:t.params.id}}),a.NextResponse.json({ok:!0})}catch(e){if(e?.code==="P2025")return a.NextResponse.json({error:"Not found"},{status:404});return console.error("DELETE /api/medico/clinical/[id] error:",e),a.NextResponse.json({error:"Delete error"},{status:500})}}let D=new r.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/medico/clinical/[id]/route",pathname:"/api/medico/clinical/[id]",filename:"route",bundlePath:"app/api/medico/clinical/[id]/route"},resolvedPagePath:"/Users/Fran/ctbrain-14/src/app/api/medico/clinical/[id]/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:C,staticGenerationAsyncStorage:S,serverHooks:h}=D,R="/api/medico/clinical/[id]/route";function N(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:S})}},13538:(e,t,o)=>{o.d(t,{Z:()=>s,_:()=>r});var i=o(53524);let r=globalThis.prisma??new i.PrismaClient({log:["error"]}),s=r}};var t=require("../../../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),i=t.X(0,[8948,5972,330],()=>o(77369));module.exports=i})();