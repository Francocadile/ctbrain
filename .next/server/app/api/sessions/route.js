"use strict";(()=>{var e={};e.id=1772,e.ids=[1772],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},18574:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>A,patchFetch:()=>C,requestAsyncStorage:()=>T,routeModule:()=>h,serverHooks:()=>v,staticGenerationAsyncStorage:()=>R});var s={};r.r(s),r.d(s,{GET:()=>y,POST:()=>x});var a=r(49303),n=r(88716),i=r(60670),o=r(87070),l=r(7410),u=r(13538),d=r(70528),c=r(53524);function p(e){let t=e.getUTCFullYear(),r=String(e.getUTCMonth()+1).padStart(2,"0"),s=String(e.getUTCDate()).padStart(2,"0");return`${t}-${r}-${s}`}function m(e,t){let r=new Date(e);return r.setUTCDate(r.getUTCDate()+t),r}let f=/^\[DAYFLAG:(morning|afternoon)\]/i,g={id:!0,title:!0,description:!0,date:!0,type:!0,createdAt:!0,updatedAt:!0,createdBy:!0,user:{select:{id:!0,name:!0,email:!0,role:!0}}},w=l.z.object({title:l.z.string().optional().nullable(),description:l.z.string().optional().nullable(),date:l.z.string().datetime({message:"Fecha inv\xe1lida (usar ISO, ej: 2025-08-27T12:00:00Z)"}),type:l.z.enum(["GENERAL","FUERZA","TACTICA","AEROBICO","RECUPERACION"]).optional()}).superRefine((e,t)=>{!function(e){let t=(e||"").trim();return!!t&&f.test(t)}(e.description)&&(e.title||"").trim().length<2&&t.addIssue({code:l.z.ZodIssueCode.custom,message:"T\xedtulo muy corto",path:["title"]})});async function y(e){try{await (0,d.m)();let t=new URL(e.url).searchParams.get("start");if(t){let e=new Date(`${t}T00:00:00.000Z`);if(Number.isNaN(e.valueOf()))return o.NextResponse.json({error:"start inv\xe1lido (YYYY-MM-DD)"},{status:400});let r=function(e){let t=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())),r=t.getUTCDay()||7;return 1!==r&&t.setUTCDate(t.getUTCDate()-(r-1)),t.setUTCHours(0,0,0,0),t}(e),s=m(r,7),a=await u.Z.session.findMany({where:{date:{gte:r,lt:s}},orderBy:[{date:"asc"},{createdAt:"asc"}],select:g}),n={};for(let e=0;e<7;e++)n[p(m(r,e))]=[];for(let e of a){let t=p(new Date(e.date));n[t]||(n[t]=[]),n[t].push(e)}return o.NextResponse.json({days:n,weekStart:p(r),weekEnd:p(m(r,6))})}let r=await u.Z.session.findMany({orderBy:[{date:"desc"},{createdAt:"desc"}],select:g,take:50});return o.NextResponse.json({data:r})}catch(e){if(e instanceof Response)return e;return console.error("GET /api/sessions error:",e),o.NextResponse.json({error:"Error al listar sesiones"},{status:500})}}async function x(e){try{let t=await (0,d.V)([c.Role.CT,c.Role.ADMIN]),r=await e.json(),s=w.safeParse(r);if(!s.success)return o.NextResponse.json({error:"Datos inv\xe1lidos",details:s.error.flatten()},{status:400});let{title:a,description:n,date:i,type:l}=s.data,p=await u.Z.session.create({data:{title:(a??"").trim(),description:n??null,date:new Date(i),type:l??"GENERAL",createdBy:t.user.id},select:g});return o.NextResponse.json({data:p},{status:201})}catch(e){if(e instanceof Response)return e;return console.error("POST /api/sessions error:",{message:e?.message,stack:e?.stack,error:e}),o.NextResponse.json({error:"Error al crear la sesi\xf3n",details:e?.message||e},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/sessions/route",pathname:"/api/sessions",filename:"route",bundlePath:"app/api/sessions/route"},resolvedPagePath:"/Users/Fran/ctbrain-14/src/app/api/sessions/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:T,staticGenerationAsyncStorage:R,serverHooks:v}=h,A="/api/sessions/route";function C(){return(0,i.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:R})}},53797:(e,t)=>{t.Z=function(e){return{id:"credentials",name:"Credentials",type:"credentials",credentials:{},authorize:()=>null,options:e}}},38238:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ReflectAdapter",{enumerable:!0,get:function(){return r}});class r{static get(e,t,r){let s=Reflect.get(e,t,r);return"function"==typeof s?s.bind(e):s}static set(e,t,r,s){return Reflect.set(e,t,r,s)}static has(e,t){return Reflect.has(e,t)}static deleteProperty(e,t){return Reflect.deleteProperty(e,t)}}},70528:(e,t,r)=>{r.d(t,{V:()=>n,m:()=>i});var s=r(75571),a=r(95456);async function n(e){let t=await (0,s.getServerSession)(a.L);if(!t?.user?.id)throw new Response("No autenticado",{status:401});let r=t.user.role;if(!r||!e.includes(r))throw new Response("No autorizado",{status:403});return t}async function i(){let e=await (0,s.getServerSession)(a.L);if(!e?.user?.id)throw new Response("No autenticado",{status:401});return e}},95456:(e,t,r)=>{r.d(t,{L:()=>l});var s=r(53797),a=r(53524),n=r(42023),i=r.n(n);let o=new a.PrismaClient,l={session:{strategy:"jwt"},providers:[(0,s.Z)({name:"credentials",credentials:{email:{label:"Email",type:"text"},password:{label:"Password",type:"password"}},async authorize(e){let t=(e?.email||"").trim().toLowerCase(),r=(e?.password||"").toString();if(!t)return null;let s=await o.user.findUnique({where:{email:t},select:{id:!0,email:!0,name:!0,role:!0,isApproved:!0,passwordHash:!0}});if(!s||!s.passwordHash||!await i().compare(r,s.passwordHash))return null;let a=(await o.userTeam.findMany({where:{userId:s.id},select:{teamId:!0}})).map(e=>e.teamId),n=a.length>0?a[0]:null;return{id:s.id,email:s.email,name:s.name??s.email,role:s.role,isApproved:s.isApproved,teamIds:a,currentTeamId:n}}})],pages:{signIn:"/login"},callbacks:{async jwt({token:e,user:t}){if(t){let{role:r,isApproved:s,teamIds:a=[],currentTeamId:n=null}=t;e.role=r,e.isApproved=s,e.teamIds=a,e.currentTeamId=n??(a.length>0?a[0]:null)}else e.teamIds=e.teamIds??[],e.currentTeamId=e.currentTeamId??null;return e},async session({session:e,token:t}){e.user=e.user||{},e.user.id=t.sub,e.user.role=t.role,e.user.isApproved=t.isApproved??null;let r=Array.isArray(t.teamIds)?t.teamIds:[];return e.user.teamIds=r,e.user.currentTeamId=t.currentTeamId??null,e}}}},13538:(e,t,r)=>{r.d(t,{Z:()=>n,_:()=>a});var s=r(53524);let a=globalThis.prisma??new s.PrismaClient({log:["error"]}),n=a}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,330,2023,5571,7410],()=>r(18574));module.exports=s})();