"use strict";(()=>{var e={};e.id=5241,e.ids=[5241],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},25600:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>A,patchFetch:()=>q,requestAsyncStorage:()=>g,routeModule:()=>h,serverHooks:()=>v,staticGenerationAsyncStorage:()=>R});var s={};r.r(s),r.d(s,{DELETE:()=>y,GET:()=>w,PUT:()=>x});var n=r(49303),i=r(88716),a=r(60670),o=r(87070),l=r(7410),u=r(13538),d=r(70528),p=r(53524);let c=/^\[DAYFLAG:(morning|afternoon)\]/i,m={id:!0,title:!0,description:!0,date:!0,type:!0,createdAt:!0,updatedAt:!0,createdBy:!0,user:{select:{id:!0,name:!0,email:!0,role:!0}}},f=l.z.object({title:l.z.string().optional().nullable(),description:l.z.string().optional().nullable(),date:l.z.string().datetime().optional(),type:l.z.enum(["GENERAL","FUERZA","TACTICA","AEROBICO","RECUPERACION"]).optional()}).superRefine((e,t)=>{if(!function(e){let t=(e||"").trim();return!!t&&c.test(t)}(e.description)&&void 0!==e.title){let r=(e.title||"").trim().length;r>0&&r<2&&t.addIssue({code:l.z.ZodIssueCode.custom,message:"T\xedtulo muy corto",path:["title"]})}});async function w(e,{params:t}){try{await (0,d.m)();let e=await u.Z.session.findUnique({where:{id:t.id},select:m});if(!e)return o.NextResponse.json({error:"Sesi\xf3n no encontrada"},{status:404});return o.NextResponse.json({data:e})}catch(e){if(e instanceof Response)return e;return console.error("GET /api/sessions/[id] error:",e),o.NextResponse.json({error:"Error al obtener sesi\xf3n"},{status:500})}}async function x(e,{params:t}){try{await (0,d.V)([p.Role.CT,p.Role.ADMIN]);let r=await e.json(),s=f.safeParse(r);if(!s.success)return o.NextResponse.json({error:"Datos inv\xe1lidos",details:s.error.flatten()},{status:400});let n=s.data,i=await u.Z.session.update({where:{id:t.id},data:{...void 0!==n.title?{title:(n.title??"").trim()}:{},...void 0!==n.description?{description:n.description}:{},...n.date?{date:new Date(n.date)}:{},...n.type?{type:n.type}:{}},select:m});return o.NextResponse.json({data:i})}catch(e){if(e instanceof Response)return e;return console.error("PUT /api/sessions/[id] error:",e),o.NextResponse.json({error:"Error al actualizar sesi\xf3n"},{status:500})}}async function y(e,{params:t}){try{return await (0,d.V)([p.Role.CT,p.Role.ADMIN]),await u.Z.session.delete({where:{id:t.id}}),o.NextResponse.json({ok:!0})}catch(e){if(e instanceof Response)return e;return console.error("DELETE /api/sessions/[id] error:",e),o.NextResponse.json({error:"Error al borrar sesi\xf3n"},{status:500})}}let h=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/sessions/[id]/route",pathname:"/api/sessions/[id]",filename:"route",bundlePath:"app/api/sessions/[id]/route"},resolvedPagePath:"/Users/Fran/ctbrain-14/src/app/api/sessions/[id]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:R,serverHooks:v}=h,A="/api/sessions/[id]/route";function q(){return(0,a.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:R})}},53797:(e,t)=>{t.Z=function(e){return{id:"credentials",name:"Credentials",type:"credentials",credentials:{},authorize:()=>null,options:e}}},38238:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ReflectAdapter",{enumerable:!0,get:function(){return r}});class r{static get(e,t,r){let s=Reflect.get(e,t,r);return"function"==typeof s?s.bind(e):s}static set(e,t,r,s){return Reflect.set(e,t,r,s)}static has(e,t){return Reflect.has(e,t)}static deleteProperty(e,t){return Reflect.deleteProperty(e,t)}}},70528:(e,t,r)=>{r.d(t,{V:()=>i,m:()=>a});var s=r(75571),n=r(95456);async function i(e){let t=await (0,s.getServerSession)(n.L);if(!t?.user?.id)throw new Response("No autenticado",{status:401});let r=t.user.role;if(!r||!e.includes(r))throw new Response("No autorizado",{status:403});return t}async function a(){let e=await (0,s.getServerSession)(n.L);if(!e?.user?.id)throw new Response("No autenticado",{status:401});return e}},95456:(e,t,r)=>{r.d(t,{L:()=>l});var s=r(53797),n=r(53524),i=r(42023),a=r.n(i);let o=new n.PrismaClient,l={session:{strategy:"jwt"},providers:[(0,s.Z)({name:"credentials",credentials:{email:{label:"Email",type:"text"},password:{label:"Password",type:"password"}},async authorize(e){let t=(e?.email||"").trim().toLowerCase(),r=(e?.password||"").toString();if(!t)return null;let s=await o.user.findUnique({where:{email:t},select:{id:!0,email:!0,name:!0,role:!0,isApproved:!0,passwordHash:!0}});if(!s||!s.passwordHash||!await a().compare(r,s.passwordHash))return null;let n=(await o.userTeam.findMany({where:{userId:s.id},select:{teamId:!0}})).map(e=>e.teamId),i=n.length>0?n[0]:null;return{id:s.id,email:s.email,name:s.name??s.email,role:s.role,isApproved:s.isApproved,teamIds:n,currentTeamId:i}}})],pages:{signIn:"/login"},callbacks:{async jwt({token:e,user:t}){if(t){let{role:r,isApproved:s,teamIds:n=[],currentTeamId:i=null}=t;e.role=r,e.isApproved=s,e.teamIds=n,e.currentTeamId=i??(n.length>0?n[0]:null)}else e.teamIds=e.teamIds??[],e.currentTeamId=e.currentTeamId??null;return e},async session({session:e,token:t}){e.user=e.user||{},e.user.id=t.sub,e.user.role=t.role,e.user.isApproved=t.isApproved??null;let r=Array.isArray(t.teamIds)?t.teamIds:[];return e.user.teamIds=r,e.user.currentTeamId=t.currentTeamId??null,e}}}},13538:(e,t,r)=>{r.d(t,{Z:()=>i,_:()=>n});var s=r(53524);let n=globalThis.prisma??new s.PrismaClient({log:["error"]}),i=n}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,330,2023,5571,7410],()=>r(25600));module.exports=s})();