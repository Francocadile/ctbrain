(()=>{var e={};e.id=8552,e.ids=[8552],e.modules={53524:e=>{"use strict";e.exports=require("@prisma/client")},47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},63477:e=>{"use strict";e.exports=require("querystring")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},26214:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>d,pages:()=>c,routeModule:()=>p,tree:()=>u}),t(28262),t(69242),t(15495),t(35866);var s=t(23191),a=t(88716),n=t(37922),i=t.n(n),o=t(95231),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);t.d(r,l);let u=["",{children:["medico",{children:["protocolos",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,28262)),"/Users/Fran/ctbrain-14/src/app/medico/protocolos/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,69242)),"/Users/Fran/ctbrain-14/src/app/medico/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,15495)),"/Users/Fran/ctbrain-14/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,35866,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/Fran/ctbrain-14/src/app/medico/protocolos/page.tsx"],d="/medico/protocolos/page",m={require:t,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/medico/protocolos/page",pathname:"/medico/protocolos",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:u}})},54630:(e,r,t)=>{Promise.resolve().then(t.t.bind(t,12994,23)),Promise.resolve().then(t.t.bind(t,96114,23)),Promise.resolve().then(t.t.bind(t,9727,23)),Promise.resolve().then(t.t.bind(t,79671,23)),Promise.resolve().then(t.t.bind(t,41868,23)),Promise.resolve().then(t.t.bind(t,84759,23))},14497:(e,r,t)=>{Promise.resolve().then(t.bind(t,42126))},26668:(e,r,t)=>{Promise.resolve().then(t.bind(t,43291))},35303:()=>{},35047:(e,r,t)=>{"use strict";var s=t(77389);t.o(s,"useParams")&&t.d(r,{useParams:function(){return s.useParams}}),t.o(s,"usePathname")&&t.d(r,{usePathname:function(){return s.usePathname}}),t.o(s,"useRouter")&&t.d(r,{useRouter:function(){return s.useRouter}}),t.o(s,"useSearchParams")&&t.d(r,{useSearchParams:function(){return s.useSearchParams}})},43291:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>o});var s=t(10326),a=t(77109);function n(){let{status:e}=(0,a.useSession)();return"authenticated"!==e?null:s.jsx("button",{onClick:()=>(0,a.signOut)({callbackUrl:"/login"}),className:"fixed right-4 top-4 rounded-md border px-3 py-1 text-sm hover:bg-gray-50","aria-label":"Cerrar sesi\xf3n",children:"Salir"})}var i=t(82152);function o({children:e}){return(0,s.jsxs)("div",{className:"min-h-screen relative",children:[s.jsx("div",{className:"absolute left-4 top-4 z-40",children:s.jsx(i.default,{className:"min-w-[160px]"})}),s.jsx(n,{}),e]})}},42126:(e,r,t)=>{"use strict";t.d(r,{default:()=>n});var s=t(10326),a=t(77109);function n({children:e}){return s.jsx(a.SessionProvider,{children:e})}},82152:(e,r,t)=>{"use strict";t.d(r,{default:()=>o});var s=t(10326),a=t(17577),n=t(77109),i=t(35047);function o({className:e,label:r="Equipo"}){let{data:t,status:o,update:l}=(0,n.useSession)(),u=(0,i.useRouter)(),c=(0,a.useMemo)(()=>t?.user?.teamIds??[],[t?.user?.teamIds]);t?.user?.currentTeamId;let[d,m]=(0,a.useState)([]),[p,x]=(0,a.useState)(""),[h,g]=(0,a.useState)(!1),[f,b]=(0,a.useState)(!1),[v,y]=(0,a.useState)(null),P=c.length>0;if((0,a.useMemo)(()=>P?[...c].sort().join("|"):"",[P,c]),"loading"===o||!P)return null;async function j(e){let r=e.target.value;if(r&&r!==p){x(r),b(!0),y(null);try{document.cookie=`ctb_team=${encodeURIComponent(r)}; path=/; max-age=2592000; SameSite=Lax`;let e=await fetch("/api/session/team",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({teamId:r})});if(!e.ok){let r=await e.json().catch(()=>null);throw Error(r?.error||`Error ${e.status}`)}await l?.(),u.refresh()}catch(e){x(p),y(e?.message||"No se pudo cambiar de equipo.")}finally{b(!1)}}}let w=["flex flex-col gap-1 text-xs",e].filter(Boolean).join(" ");return 0===d.length?null:(0,s.jsxs)("div",{className:w,children:[s.jsx("label",{className:"text-[10px] font-semibold uppercase text-gray-500",children:r}),s.jsx("select",{value:p,onChange:j,disabled:h||f,className:"w-full rounded-md border px-2 py-1.5 text-sm disabled:opacity-60",children:d.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))}),v?s.jsx("span",{className:"text-[11px] text-red-600",children:v}):null]})}},15495:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>c,metadata:()=>u});var s=t(19510);t(5023);var a=t(68570);let n=(0,a.createProxy)(String.raw`/Users/Fran/ctbrain-14/src/app/providers.tsx`),{__esModule:i,$$typeof:o}=n;n.default;let l=(0,a.createProxy)(String.raw`/Users/Fran/ctbrain-14/src/app/providers.tsx#default`),u={title:"ctbrain",description:"App"};function c({children:e}){return s.jsx("html",{lang:"es",children:s.jsx("body",{children:s.jsx(l,{children:e})})})}},69242:(e,r,t)=>{"use strict";t.r(r),t.d(r,{$$typeof:()=>i,__esModule:()=>n,default:()=>o});var s=t(68570);let a=(0,s.createProxy)(String.raw`/Users/Fran/ctbrain-14/src/app/medico/layout.tsx`),{__esModule:n,$$typeof:i}=a;a.default;let o=(0,s.createProxy)(String.raw`/Users/Fran/ctbrain-14/src/app/medico/layout.tsx#default`)},28262:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>n});var s=t(19510),a=t(35209);function n(){return s.jsx(a.Z,{allow:["MEDICO"],children:(0,s.jsxs)("main",{className:"p-6 space-y-3",children:[s.jsx("h1",{className:"text-xl font-bold",children:"Protocolos â€” M\xe9dico"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Pr\xf3ximamente."})]})})}},35209:(e,r,t)=>{"use strict";t.d(r,{Z:()=>o});var s=t(19510),a=t(95456),n=t(75571),i=t(58585);async function o({allow:e,requireTeam:r=!1,children:t}){let o=await (0,n.getServerSession)(a.L);o?.user?.id||(console.info("[RoleGate] deny",{reason:"no-session",allow:e,requireTeam:r}),(0,i.redirect)("/login"));let l=o.user.role;return(l&&e.includes(l)||(console.info("[RoleGate] deny",{reason:"role-mismatch",allow:e,requireTeam:r,role:l,userId:o.user.id}),(0,i.redirect)(function(e){switch(e){case"SUPERADMIN":return"/superadmin";case"ADMIN":return"/admin";case"CT":return"/ct";case"MEDICO":return"/medico";case"JUGADOR":return"/jugador";case"DIRECTIVO":return"/directivo";default:return"/login"}}(l))),!r||("string"==typeof o.user.currentTeamId?o.user.currentTeamId:null))?s.jsx(s.Fragment,{children:t}):(console.info("[RoleGate] deny",{reason:"missing-team",allow:e,role:l,requireTeam:r,userId:o.user.id}),s.jsx("main",{className:"min-h-[60vh] bg-gray-50 px-6 py-10",children:(0,s.jsxs)("div",{className:"mx-auto max-w-lg rounded-2xl border bg-white p-6 text-center shadow-sm space-y-4",children:[s.jsx("h1",{className:"text-xl font-semibold",children:"Seleccion\xe1 un equipo"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Eleg\xed un equipo activo desde el selector del dashboard."}),s.jsx("a",{href:"/ct",className:"inline-flex items-center justify-center rounded-lg border px-4 py-2 text-sm font-medium hover:bg-gray-50",children:"Ir al dashboard"})]})}))}},95456:(e,r,t)=>{"use strict";t.d(r,{L:()=>l});var s=t(53797),a=t(53524),n=t(42023),i=t.n(n);let o=new a.PrismaClient,l={session:{strategy:"jwt"},providers:[(0,s.Z)({name:"credentials",credentials:{email:{label:"Email",type:"text"},password:{label:"Password",type:"password"}},async authorize(e){let r=(e?.email||"").trim().toLowerCase(),t=(e?.password||"").toString();if(!r)return null;let s=await o.user.findUnique({where:{email:r},select:{id:!0,email:!0,name:!0,role:!0,isApproved:!0,passwordHash:!0}});if(!s||!s.passwordHash||!await i().compare(t,s.passwordHash))return null;let a=(await o.userTeam.findMany({where:{userId:s.id},select:{teamId:!0}})).map(e=>e.teamId),n=a.length>0?a[0]:null;return{id:s.id,email:s.email,name:s.name??s.email,role:s.role,isApproved:s.isApproved,teamIds:a,currentTeamId:n}}})],pages:{signIn:"/login"},callbacks:{async jwt({token:e,user:r}){if(r){let{role:t,isApproved:s,teamIds:a=[],currentTeamId:n=null}=r;e.role=t,e.isApproved=s,e.teamIds=a,e.currentTeamId=n??(a.length>0?a[0]:null)}else e.teamIds=e.teamIds??[],e.currentTeamId=e.currentTeamId??null;return e},async session({session:e,token:r}){e.user=e.user||{},e.user.id=r.sub,e.user.role=r.role,e.user.isApproved=r.isApproved??null;let t=Array.isArray(r.teamIds)?r.teamIds:[];return e.user.teamIds=t,e.user.currentTeamId=r.currentTeamId??null,e}}}},5023:()=>{}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[8948,1159,330,2023,5571,4689],()=>t(26214));module.exports=s})();