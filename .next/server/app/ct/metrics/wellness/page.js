(()=>{var e={};e.id=814,e.ids=[814],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},20564:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>x,pages:()=>c,routeModule:()=>m,tree:()=>d}),t(11973),t(66382),t(15495),t(35866);var r=t(23191),a=t(88716),l=t(37922),n=t.n(l),o=t(95231),i={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>o[e]);t.d(s,i);let d=["",{children:["ct",{children:["metrics",{children:["wellness",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,11973)),"/Users/Fran/ctbrain-14/src/app/ct/metrics/wellness/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,66382)),"/Users/Fran/ctbrain-14/src/app/ct/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,15495)),"/Users/Fran/ctbrain-14/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,35866,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/Fran/ctbrain-14/src/app/ct/metrics/wellness/page.tsx"],x="/ct/metrics/wellness/page",u={require:t,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/ct/metrics/wellness/page",pathname:"/ct/metrics/wellness",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},70561:(e,s,t)=>{Promise.resolve().then(t.bind(t,506))},506:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>m,dynamic:()=>d});var r=t(10326),a=t(17577),l=t(35047),n=t(82882),o=t(96599),i=t(92420);let d="force-dynamic";function c({children:e,tone:s}){return r.jsx("span",{className:`inline-flex rounded-md border px-2 py-0.5 text-xs font-semibold ${{green:"bg-emerald-50 text-emerald-700 border-emerald-200",yellow:"bg-amber-50 text-amber-700 border-amber-200",lime:"bg-lime-50 text-lime-700 border-lime-200",orange:"bg-orange-50 text-orange-700 border-orange-200",red:"bg-red-50 text-red-700 border-red-200",gray:"bg-gray-100 text-gray-600 border-gray-200"}[s]}`,children:e})}function x({vals:e}){if(!e.length)return r.jsx("span",{className:"text-gray-400",children:"—"});let s=Math.min(...e),t=Math.max(1e-6,Math.max(...e)-s);return r.jsx("div",{className:"flex items-end gap-0.5 h-6",children:e.map((e,a)=>r.jsx("div",{className:"w-1.5 bg-gray-400/60 rounded-sm",style:{height:`${6+Math.round((e-s)/t*16)}px`}},a))})}function u(){let e=(0,l.useSearchParams)().get("tab")||"respuestas",[s,t]=(0,a.useState)(e),[d,u]=(0,a.useState)((0,i.Op)(new Date)),[m,p]=(0,a.useState)([]),[h,g]=(0,a.useState)(!0),[j,y]=(0,a.useState)(""),[b,N]=(0,a.useState)([]),[f,v]=(0,a.useState)({}),[w,_]=(0,a.useState)({}),[S,k]=(0,a.useState)({}),[C,P]=(0,a.useState)({}),[A,R]=(0,a.useState)(7),[$,E]=(0,a.useState)(!1),[O,U]=(0,a.useState)([]),[D,F]=(0,a.useState)([]),[Z,M]=(0,a.useState)([0,0,0,0]),[L,q]=(0,a.useState)(!1),[I,W]=(0,a.useState)(null),[z,H]=(0,a.useState)(!1),[T,B]=(0,a.useState)([]),[J,K]=(0,a.useState)([]),V=o.Z;async function G(e){let s=await fetch(`/api/metrics/wellness?date=${e}`,{cache:"no-store"});if(!s.ok)return[];let t=await s.json();return Array.isArray(t)?t:[]}async function Q(e){let s=await fetch(`/api/metrics/rpe?date=${e}`,{cache:"no-store"});if(!s.ok)return[];let t=await s.json();return Array.isArray(t)?t.map(e=>{let s=e.load??e.srpe??Number(e.rpe??0)*Number(e.duration??0)??0;return{userName:e.userName||e.playerKey||e.user?.name||e.user?.email||"Jugador",srpe:Number(s)}}):[]}async function X(e){let s=await fetch(`/api/injuries?date=${e}`,{cache:"no-store"});if(!s.ok)return{};let t=await s.json(),r={};for(let e of Array.isArray(t)?t:[]){let s=e.userName||e.user?.name||e.user?.email||"—";r[s]={userId:e.userId,userName:s,status:e.status}}return r}async function Y(){g(!0);let e=(await G(d)).map(e=>{let s=e.userName||e.user?.name||e.user?.email||e.playerKey||"—";return{...e,_userName:s,_sdw:(0,i.bq)(e)}}),s=await X(d),t=Array.from({length:21},(e,s)=>(0,i.Op)((0,i.E4)((0,i.lN)(d),-(s+1)))),r=await Promise.all(t.map(e=>G(e))),a={},l={};for(let e=0;e<r.length;e++)for(let s of r[e]){let t=s.userName||s.user?.name||s.user?.email||s.playerKey||"—",r=(0,i.bq)(s);a[t]||(a[t]=[]),a[t].push(r),e<7&&(l[t]||(l[t]=[]),l[t].push(r))}let n={};for(let[e,s]of Object.entries(a)){let t=s.filter(e=>e>0);n[e]={mean:(0,i.J6)(t),sd:(0,i.D1)(t),n:t.length}}let o=await Q((0,i.Cv)(d)),c={};for(let e of o)c[e.userName]=e.srpe||0;let x=e.map(e=>{let s=n[e._userName],t=s&&s.n>=7&&s.sd>0?(e._sdw-s.mean)/s.sd:null,r=(0,i.HW)(t),a=(0,i.RW)(r,e);return{...e,_z:t,_color:a,_base:s||{mean:0,sd:0,n:0}}}),u=[];for(let e of x){let s=e._base,t=e._z,r=e._color,a=[];(e.sleepHours??null)!==null&&e.sleepHours<4&&a.push("Sue\xf1o <4h"),e.muscleSoreness<=2&&a.push("Dolor muscular ≤2"),e.stress<=2&&a.push("Estr\xe9s ≤2");let l=w[e._userName]??0;"red"===r?u.push({kind:"CRITICO",reason:null!==t&&t<-1&&s.n>=7?`SDW rojo (Z=${t.toFixed(2)})`:a[0]?`Override: ${a.join(", ")}`:"SDW rojo",userName:e._userName,priority:1}):"yellow"===r&&u.push({kind:"AMARILLO",reason:null!==t&&t<-.5&&s.n>=7?`Descenso leve (Z=${t.toFixed(2)})`:a[0]?`Override leve: ${a.join(", ")}`:"Atenci\xf3n",userName:e._userName,priority:5}),l>900&&"red"===r&&u.push({kind:"CRITICO",reason:`sRPE ayer ${Math.round(l)} AU + SDW rojo`,userName:e._userName,priority:0})}u.sort((e,s)=>e.priority-s.priority),p(x),P(n),v(l),_(c),N(u),k(s),g(!1)}(0,a.useMemo)(()=>{let e=m.length,s=m.map(e=>Number(e._sdw||0)).filter(e=>e>0),t=s.length?(0,i.J6)(s):0,r=0,a=0,l=0,n=[];for(let e of m){let s=e._color;"red"===s?r++:"yellow"===s?a++:l++,null!=e._z&&n.push(Number(e._z))}return{n:e,sdwAvg:t,reds:r,yellows:a,greens:l,zAvg:n.length?(0,i.J6)(n):null,dist:e?{red:Math.round(r/e*100),yellow:Math.round(a/e*100),green:Math.round(l/e*100)}:{red:0,yellow:0,green:0}}},[m]);let[ee,es]=(0,a.useState)([]),et=(0,a.useMemo)(()=>{let e=j.trim().toLowerCase();return e?ee.filter(s=>s._userName.toLowerCase().includes(e)||(s.comment||"").toLowerCase().includes(e)):ee},[ee,j]);async function er(e){W(e),q(!0),H(!0);try{let s=[m.find(s=>s._userName===e)?._sdw??0,...f[e]||[]];B(s);let t=Array.from({length:7},(e,s)=>(0,i.Op)((0,i.E4)((0,i.lN)(d),-s))),r=await Promise.all(t.map(e=>Q(e))),a=[];for(let s=0;s<t.length;s++){let l=t[s];for(let t of r[s]||[])if(t.userName===e){a.push({date:l,au:t.srpe||0});break}}K(a)}finally{H(!1)}}return(0,r.jsxs)("div",{className:"p-4 space-y-4",children:[(0,r.jsxs)("header",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h1",{className:"text-lg font-bold",children:["Wellness — D\xeda (CT)"," ",r.jsx(n.Z,{text:"Vista operativa del d\xeda. Calcula SDW, compara vs baseline (21d) y aplica sem\xe1foro con overrides cl\xednicos."})]}),(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:[m.length," registros • Baseline: ventana 21 d\xedas previos (min 7 d\xedas v\xe1lidos)"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"date",className:"rounded-md border px-2 py-1.5 text-sm",value:d,onChange:e=>u(e.target.value)}),r.jsx("button",{onClick:Y,className:"rounded-lg border px-2 py-1 text-sm hover:bg-gray-50",children:"Recargar"}),r.jsx("button",{onClick:function(){let e=["Jugador,Fecha,Sue\xf1o_calidad,Horas_sue\xf1o,Fatiga,Dolor_muscular,Estr\xe9s,\xc1nimo,Total_diario,Comentario,Color,Semana_ISO"];for(let s of et){let t=s.date,r=s._color;e.push([`"${s._userName.replace(/"/g,'""')}"`,s.date,s.sleepQuality,s.sleepHours??"",s.fatigue,s.muscleSoreness,s.stress,s.mood,s._sdw.toFixed(2),`"${(s.comment||"").replace(/"/g,'""')}"`,r.toUpperCase(),t].join(","))}let s=new Blob([e.join("\n")],{type:"text/csv;charset=utf-8"}),t=URL.createObjectURL(s),r=document.createElement("a");r.href=t,r.download=`wellness_dia_${d}.csv`,r.click(),URL.revokeObjectURL(t)},className:"rounded-lg bg-black text-white px-3 py-1.5 text-sm hover:opacity-90",children:"Exportar CSV"})]})]}),r.jsx("nav",{className:"rounded-xl border bg-white p-1 flex gap-1",children:[{key:"respuestas",label:"Respuestas"},{key:"kpis",label:"KPIs"},{key:"reportes",label:"Reportes"}].map(e=>{let a=s===e.key;return r.jsx("button",{onClick:()=>(function(e){t(e);let s=new URL(window.location.href);s.searchParams.set("tab",e),window.history.replaceState(null,"",s.toString())})(e.key),className:`flex-1 rounded-lg px-3 py-2 text-sm font-medium transition ${a?"bg-black text-white":"hover:bg-gray-50"}`,children:e.label},e.key)})}),"respuestas"===s&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("section",{className:"rounded-xl border bg-white p-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"text-[12px] font-semibold uppercase",children:["Alertas ",r.jsx(n.Z,{text:"Ordenadas por severidad. Rojo: atender hoy; Amarillo: monitoreo/ajuste leve."})]}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:[b.length," alerta(s)"]})]}),h?r.jsx("div",{className:"p-2 text-gray-500",children:"Cargando…"}):0===b.length?r.jsx("div",{className:"p-2 text-gray-500 italic",children:"Sin alertas"}):r.jsx("ul",{className:"mt-2 space-y-1",children:b.map((e,s)=>(0,r.jsxs)("li",{className:"flex items-center justify-between rounded-lg border px-2 py-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:["CRITICO"===e.kind?r.jsx(c,{tone:"red",children:"Rojo"}):r.jsx(c,{tone:"orange",children:"Amarillo"}),r.jsx("span",{className:"font-medium",children:e.userName}),(0,r.jsxs)("span",{className:"text-sm text-gray-700",children:["— ",e.reason]})]}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsx("button",{onClick:()=>er(e.userName),className:"rounded-md border px-2 py-0.5 text-xs hover:bg-gray-50",children:"Ver"})})]},s))})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("input",{className:"w-full md:w-80 rounded-md border px-2 py-1.5 text-sm",placeholder:"Buscar por jugador o comentario…",value:j,onChange:e=>y(e.target.value)}),(0,r.jsxs)("span",{className:"text-[12px] text-gray-500",children:[et.length," resultado(s)"]})]}),(0,r.jsxs)("section",{className:"rounded-2xl border bg-white overflow-hidden",children:[r.jsx("div",{className:"bg-gray-50 px-3 py-2 text-[12px] font-semibold uppercase",children:"Entradas (d\xeda)"}),h?r.jsx("div",{className:"p-4 text-gray-500",children:"Cargando…"}):0===et.length?r.jsx("div",{className:"p-4 text-gray-500 italic",children:"Sin datos"}):r.jsx("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full text-sm",children:[r.jsx("thead",{children:(0,r.jsxs)("tr",{className:"border-b bg-gray-50",children:[r.jsx("th",{className:"text-left px-3 py-2",children:"Jugador"}),(0,r.jsxs)("th",{className:"text-left px-3 py-2",children:["SDW (1–5) ",r.jsx(n.Z,{text:"Promedio de los 5 \xedtems (1–5); 5=mejor. Base para Z y color."})]}),(0,r.jsxs)("th",{className:"text-left px-3 py-2",children:["Baseline (μ\xb1σ) ",r.jsx(n.Z,{text:"Media y desv\xedo de SDW en 21 d\xedas v\xe1lidos. Requiere ≥7 d\xedas para Z."})]}),(0,r.jsxs)("th",{className:"text-left px-3 py-2",children:["Z ",r.jsx(n.Z,{text:"(SDW_hoy − μ_baseline)/σ_baseline. Verde ≥ −0.5; Amarillo [−1.0, −0.5); Rojo < −1.0."})]}),(0,r.jsxs)("th",{className:"text-left px-3 py-2",children:["Color ",r.jsx(n.Z,{text:"Sem\xe1foro por Z con overrides: Sue\xf1o <4h ⇒ ≥ amarillo; Dolor ≤2 ⇒ rojo; Estr\xe9s ≤2 ⇒ ≥ amarillo."})]}),(0,r.jsxs)("th",{className:"text-left px-3 py-2",children:["Sue\xf1o (h) ",r.jsx(n.Z,{text:"Horas de sue\xf1o reportadas. <4h eleva la severidad al menos a Amarillo."})]}),(0,r.jsxs)("th",{className:"text-left px-3 py-2",children:["Peores \xedtems ",r.jsx(n.Z,{text:"Los dos \xedtems con menor puntaje del d\xeda: gu\xeda r\xe1pida para intervenci\xf3n."})]}),(0,r.jsxs)("th",{className:"text-left px-3 py-2",children:["sRPE ayer ",r.jsx(n.Z,{text:"Carga interna del d\xeda previo (RPE\xd7min). >900 AU + SDW rojo ⇒ alerta cr\xedtica."})]}),(0,r.jsxs)("th",{className:"text-left px-3 py-2",children:["Spark 7d ",r.jsx(n.Z,{text:"Mini-tendencia de SDW (ayer → hace 7 d\xedas). M\xe1s alto = mejor."})]}),(0,r.jsxs)("th",{className:"text-left px-3 py-2",children:["Comentario ",r.jsx(n.Z,{text:"Texto libre del jugador para contexto cualitativo."})]}),r.jsx("th",{className:"text-right px-3 py-2",children:"Acciones"})]})}),r.jsx("tbody",{children:et.slice().sort((e,s)=>{let t=e=>"red"===e?0:"yellow"===e?1:2,r=e._color,a=s._color;if(t(r)!==t(a))return t(r)-t(a);let l=e._z,n=s._z;return null!=l&&null!=n?l-n:0}).map(e=>{let s=e._base,t=e._z,a=e._color,l=[{k:"Sue\xf1o",v:e.sleepQuality},{k:"Fatiga",v:e.fatigue},{k:"Dolor",v:e.muscleSoreness},{k:"Estr\xe9s",v:e.stress},{k:"\xc1nimo",v:e.mood}].sort((e,s)=>e.v-s.v).slice(0,2),n=(f[e._userName]||[]).slice().reverse(),o=w[e._userName]??null,i=S[e._userName]||null;return(0,r.jsxs)("tr",{className:"border-b last:border-0 align-top",children:[(0,r.jsxs)("td",{className:"px-3 py-2 font-medium",children:[e._userName," ",i&&r.jsx("span",{className:"ml-1",children:r.jsx(c,{tone:"gray",children:"LESIONADO"})})]}),r.jsx("td",{className:"px-3 py-2",children:e._sdw.toFixed(2)}),r.jsx("td",{className:"px-3 py-2 text-xs text-gray-700",children:s.n>=7?`${s.mean.toFixed(2)} \xb1 ${s.sd.toFixed(2)} (n=${s.n})`:r.jsx("span",{className:"text-gray-400",children:"insuficiente"})}),r.jsx("td",{className:"px-3 py-2",children:null!=t?t.toFixed(2):"—"}),r.jsx("td",{className:"px-3 py-2",children:r.jsx(c,{tone:a,children:a.toUpperCase()})}),r.jsx("td",{className:"px-3 py-2",children:e.sleepHours??"—"}),r.jsx("td",{className:"px-3 py-2 text-xs",children:l.map(e=>(0,r.jsxs)("div",{children:[e.k,": ",r.jsx("b",{children:e.v})]},e.k))}),r.jsx("td",{className:"px-3 py-2",children:null!=o?`${Math.round(o)} AU`:"—"}),r.jsx("td",{className:"px-3 py-2",children:r.jsx(x,{vals:n})}),r.jsx("td",{className:"px-3 py-2",children:r.jsx("span",{className:"text-gray-600",children:e.comment||"—"})}),r.jsx("td",{className:"px-3 py-2",children:r.jsx("div",{className:"flex justify-end",children:r.jsx("button",{onClick:()=>er(e._userName),className:"rounded-md border px-2 py-1 text-xs hover:bg-gray-50",children:"Ver"})})})]},e.id)})})]})})]})]}),"kpis"===s&&(0,r.jsxs)(r.Fragment,{children:[r.jsx("section",{className:"rounded-2xl border bg-white px-4 py-3",children:r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3"})}),r.jsx("section",{className:"rounded-2xl border bg-white px-4 py-3",children:(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,r.jsxs)("div",{className:"text-[12px] font-semibold uppercase",children:["KPIs \xfaltimos"," ",(0,r.jsxs)("select",{className:"ml-1 border rounded-md px-1 py-0.5 text-xs",value:A,onChange:e=>R(Number(e.target.value)),children:[r.jsx("option",{value:7,children:"7"}),r.jsx("option",{value:14,children:"14"}),r.jsx("option",{value:21,children:"21"})]})," ","d\xedas",r.jsx(n.Z,{text:"Se calcula en cliente llamando al endpoint por d\xeda. 'Participaci\xf3n' usa el universo de jugadores que reportaron al menos una vez en el rango."})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:function(){let e=(0,i.Op)((0,i.E4)((0,i.lN)(d),-(A-1))),s=["Fecha,SDW_promedio_d\xeda,Participaci\xf3n_%"];for(let e=0;e<A;e++){let t=(0,i.Op)((0,i.E4)((0,i.lN)(d),-e)),r=O[e]??"",a=D[e]??"";s.push([t,r,a].join(","))}let t=new Blob([s.join("\n")],{type:"text/csv;charset=utf-8"}),r=URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download=`wellness_kpis_${e}_a_${d}.csv`,a.click(),URL.revokeObjectURL(r)},className:"rounded-lg border px-2 py-1 text-xs hover:bg-gray-50",children:"Exportar KPIs (rango)"}),r.jsx("div",{className:"text-xs text-gray-500",children:$?"Calculando…":`${O.length} d\xeda(s)`})]})]})})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-white p-3 text-xs text-gray-600",children:[r.jsx("b",{children:"Sem\xe1foro por Z:"})," verde ≥ −0.5, amarillo [−1.0, −0.5), rojo < −1.0. Overrides: Sue\xf1o <4h ⇒ ≥ amarillo; Dolor ≤2 ⇒ rojo; Estr\xe9s ≤2 ⇒ ≥ amarillo."]}),I&&r.jsx(V,{open:L,onClose:()=>q(!1),loading:z,playerName:I,date:d,sdw7:T,rpeRecent:J,context:{injuriesToday:S}})]})}function m(){return r.jsx(a.Suspense,{fallback:r.jsx("div",{className:"p-4 text-gray-500",children:"Cargando…"}),children:r.jsx(u,{})})}},11973:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>n,__esModule:()=>l,default:()=>i,dynamic:()=>o});var r=t(68570);let a=(0,r.createProxy)(String.raw`/Users/Fran/ctbrain-14/src/app/ct/metrics/wellness/page.tsx`),{__esModule:l,$$typeof:n}=a;a.default;let o=(0,r.createProxy)(String.raw`/Users/Fran/ctbrain-14/src/app/ct/metrics/wellness/page.tsx#dynamic`),i=(0,r.createProxy)(String.raw`/Users/Fran/ctbrain-14/src/app/ct/metrics/wellness/page.tsx#default`)}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[8948,1159,9404,3404],()=>t(20564));module.exports=r})();